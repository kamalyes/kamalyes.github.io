<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>源码级深度理解 Java SPI | 学习巴</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/viewerjs/1.10.5/viewer.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/viewerjs/1.10.5/viewer.min.js"></script>
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="referrer" content="no-referrer">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.be581667.css" as="style"><link rel="preload" href="/assets/js/app.1c8f7f3c.js" as="script"><link rel="preload" href="/assets/js/2.16d814aa.js" as="script"><link rel="preload" href="/assets/js/219.9844c3ab.js" as="script"><link rel="prefetch" href="/assets/js/10.7657f2b9.js"><link rel="prefetch" href="/assets/js/100.290bf684.js"><link rel="prefetch" href="/assets/js/101.8132205d.js"><link rel="prefetch" href="/assets/js/102.b257d567.js"><link rel="prefetch" href="/assets/js/103.ad593218.js"><link rel="prefetch" href="/assets/js/104.21eca532.js"><link rel="prefetch" href="/assets/js/105.c9592d36.js"><link rel="prefetch" href="/assets/js/106.08ecd2cb.js"><link rel="prefetch" href="/assets/js/107.16ce78a0.js"><link rel="prefetch" href="/assets/js/108.303f7781.js"><link rel="prefetch" href="/assets/js/109.0fe278fc.js"><link rel="prefetch" href="/assets/js/11.178c7464.js"><link rel="prefetch" href="/assets/js/110.a68d1336.js"><link rel="prefetch" href="/assets/js/111.417c1ed4.js"><link rel="prefetch" href="/assets/js/112.30fa2de5.js"><link rel="prefetch" href="/assets/js/113.06c438dc.js"><link rel="prefetch" href="/assets/js/114.9cff4313.js"><link rel="prefetch" href="/assets/js/115.92e8c999.js"><link rel="prefetch" href="/assets/js/116.31c33389.js"><link rel="prefetch" href="/assets/js/117.4c9cd222.js"><link rel="prefetch" href="/assets/js/118.497dd511.js"><link rel="prefetch" href="/assets/js/119.02a7bacc.js"><link rel="prefetch" href="/assets/js/12.ba363078.js"><link rel="prefetch" href="/assets/js/120.c7978846.js"><link rel="prefetch" href="/assets/js/121.6e540df0.js"><link rel="prefetch" href="/assets/js/122.ad0af8f3.js"><link rel="prefetch" href="/assets/js/123.48c19f33.js"><link rel="prefetch" href="/assets/js/124.66c37008.js"><link rel="prefetch" href="/assets/js/125.791dc2ca.js"><link rel="prefetch" href="/assets/js/126.3d216669.js"><link rel="prefetch" href="/assets/js/127.b13fc3aa.js"><link rel="prefetch" href="/assets/js/128.deacf83c.js"><link rel="prefetch" href="/assets/js/129.4dafea85.js"><link rel="prefetch" href="/assets/js/13.d5f27b35.js"><link rel="prefetch" href="/assets/js/130.274c9011.js"><link rel="prefetch" href="/assets/js/131.464c60e4.js"><link rel="prefetch" href="/assets/js/132.ff6f4907.js"><link rel="prefetch" href="/assets/js/133.af9c3458.js"><link rel="prefetch" href="/assets/js/134.baeb5906.js"><link rel="prefetch" href="/assets/js/135.b196a7b7.js"><link rel="prefetch" href="/assets/js/136.70cde86c.js"><link rel="prefetch" href="/assets/js/137.be92a73f.js"><link rel="prefetch" href="/assets/js/138.5853271d.js"><link rel="prefetch" href="/assets/js/139.73076700.js"><link rel="prefetch" href="/assets/js/14.dcb6289c.js"><link rel="prefetch" href="/assets/js/140.407c0c1b.js"><link rel="prefetch" href="/assets/js/141.e2f1e60e.js"><link rel="prefetch" href="/assets/js/142.e7ec6fb2.js"><link rel="prefetch" href="/assets/js/143.1b8558f2.js"><link rel="prefetch" href="/assets/js/144.790a79d5.js"><link rel="prefetch" href="/assets/js/145.9276e94d.js"><link rel="prefetch" href="/assets/js/146.033fe3bd.js"><link rel="prefetch" href="/assets/js/147.ea412374.js"><link rel="prefetch" href="/assets/js/148.6498a27f.js"><link rel="prefetch" href="/assets/js/149.b417d04a.js"><link rel="prefetch" href="/assets/js/15.73d96fab.js"><link rel="prefetch" href="/assets/js/150.b84baeee.js"><link rel="prefetch" href="/assets/js/151.b9dc696c.js"><link rel="prefetch" href="/assets/js/152.13c51757.js"><link rel="prefetch" href="/assets/js/153.913e48a0.js"><link rel="prefetch" href="/assets/js/154.fb0e0756.js"><link rel="prefetch" href="/assets/js/155.8365dbc8.js"><link rel="prefetch" href="/assets/js/156.47fde8b5.js"><link rel="prefetch" href="/assets/js/157.a57ecb52.js"><link rel="prefetch" href="/assets/js/158.6ea1ea0a.js"><link rel="prefetch" href="/assets/js/159.7e52d94c.js"><link rel="prefetch" href="/assets/js/16.01c2fdfb.js"><link rel="prefetch" href="/assets/js/160.1e218090.js"><link rel="prefetch" href="/assets/js/161.70966e8e.js"><link rel="prefetch" href="/assets/js/162.86479515.js"><link rel="prefetch" href="/assets/js/163.291344f7.js"><link rel="prefetch" href="/assets/js/164.877b18da.js"><link rel="prefetch" href="/assets/js/165.661a67fa.js"><link rel="prefetch" href="/assets/js/166.28057e04.js"><link rel="prefetch" href="/assets/js/167.75a9d5d9.js"><link rel="prefetch" href="/assets/js/168.02bc5da0.js"><link rel="prefetch" href="/assets/js/169.634307fb.js"><link rel="prefetch" href="/assets/js/17.9bb2ee1b.js"><link rel="prefetch" href="/assets/js/170.dc8efe2f.js"><link rel="prefetch" href="/assets/js/171.1758d80f.js"><link rel="prefetch" href="/assets/js/172.fba0d2d6.js"><link rel="prefetch" href="/assets/js/173.4217f685.js"><link rel="prefetch" href="/assets/js/174.d0cd5814.js"><link rel="prefetch" href="/assets/js/175.0d270b13.js"><link rel="prefetch" href="/assets/js/176.b93c814d.js"><link rel="prefetch" href="/assets/js/177.cb3e531b.js"><link rel="prefetch" href="/assets/js/178.0abb6f45.js"><link rel="prefetch" href="/assets/js/179.5f8c2771.js"><link rel="prefetch" href="/assets/js/18.da348060.js"><link rel="prefetch" href="/assets/js/180.40300fba.js"><link rel="prefetch" href="/assets/js/181.46d8d8eb.js"><link rel="prefetch" href="/assets/js/182.93bf469f.js"><link rel="prefetch" href="/assets/js/183.306b6c7f.js"><link rel="prefetch" href="/assets/js/184.43fcc7b8.js"><link rel="prefetch" href="/assets/js/185.60854a02.js"><link rel="prefetch" href="/assets/js/186.9b1e59bd.js"><link rel="prefetch" href="/assets/js/187.21758c54.js"><link rel="prefetch" href="/assets/js/188.b5902b66.js"><link rel="prefetch" href="/assets/js/189.c7f5b805.js"><link rel="prefetch" href="/assets/js/19.e8eef044.js"><link rel="prefetch" href="/assets/js/190.28841bb5.js"><link rel="prefetch" href="/assets/js/191.897528f3.js"><link rel="prefetch" href="/assets/js/192.4c764c2f.js"><link rel="prefetch" href="/assets/js/193.c5d347cb.js"><link rel="prefetch" href="/assets/js/194.3c3b1098.js"><link rel="prefetch" href="/assets/js/195.a56099d0.js"><link rel="prefetch" href="/assets/js/196.41a615bf.js"><link rel="prefetch" href="/assets/js/197.b151e370.js"><link rel="prefetch" href="/assets/js/198.b743bea3.js"><link rel="prefetch" href="/assets/js/199.0bdf1d2e.js"><link rel="prefetch" href="/assets/js/20.54696dea.js"><link rel="prefetch" href="/assets/js/200.8e01fd8e.js"><link rel="prefetch" href="/assets/js/201.8f3e1795.js"><link rel="prefetch" href="/assets/js/202.76c137f5.js"><link rel="prefetch" href="/assets/js/203.502ce78a.js"><link rel="prefetch" href="/assets/js/204.6f7644a0.js"><link rel="prefetch" href="/assets/js/205.83675693.js"><link rel="prefetch" href="/assets/js/206.76fb20d4.js"><link rel="prefetch" href="/assets/js/207.10895b3a.js"><link rel="prefetch" href="/assets/js/208.dd6b1373.js"><link rel="prefetch" href="/assets/js/209.e3918b99.js"><link rel="prefetch" href="/assets/js/21.3d9983d7.js"><link rel="prefetch" href="/assets/js/210.6978fe39.js"><link rel="prefetch" href="/assets/js/211.ebae97c2.js"><link rel="prefetch" href="/assets/js/212.b9b799a3.js"><link rel="prefetch" href="/assets/js/213.18816cf1.js"><link rel="prefetch" href="/assets/js/214.57333746.js"><link rel="prefetch" href="/assets/js/215.c2cde8c4.js"><link rel="prefetch" href="/assets/js/216.f85567e9.js"><link rel="prefetch" href="/assets/js/217.c6e49770.js"><link rel="prefetch" href="/assets/js/218.205e82ba.js"><link rel="prefetch" href="/assets/js/22.51807966.js"><link rel="prefetch" href="/assets/js/220.60c06adb.js"><link rel="prefetch" href="/assets/js/221.c51ea0bf.js"><link rel="prefetch" href="/assets/js/222.8ccdcb8f.js"><link rel="prefetch" href="/assets/js/223.5357dab4.js"><link rel="prefetch" href="/assets/js/224.6b502522.js"><link rel="prefetch" href="/assets/js/225.852e59ff.js"><link rel="prefetch" href="/assets/js/226.331e1014.js"><link rel="prefetch" href="/assets/js/227.acff797d.js"><link rel="prefetch" href="/assets/js/228.fcec7cda.js"><link rel="prefetch" href="/assets/js/229.4a545939.js"><link rel="prefetch" href="/assets/js/23.b3447aad.js"><link rel="prefetch" href="/assets/js/230.12e897ff.js"><link rel="prefetch" href="/assets/js/231.54068979.js"><link rel="prefetch" href="/assets/js/232.ba877d5e.js"><link rel="prefetch" href="/assets/js/233.479d0738.js"><link rel="prefetch" href="/assets/js/234.c9e687db.js"><link rel="prefetch" href="/assets/js/235.2c5f80d2.js"><link rel="prefetch" href="/assets/js/236.f83d4278.js"><link rel="prefetch" href="/assets/js/237.82c0a293.js"><link rel="prefetch" href="/assets/js/238.7c5cd98f.js"><link rel="prefetch" href="/assets/js/239.d6f25c56.js"><link rel="prefetch" href="/assets/js/24.50dfeb2b.js"><link rel="prefetch" href="/assets/js/240.9cec37cc.js"><link rel="prefetch" href="/assets/js/241.67ce6304.js"><link rel="prefetch" href="/assets/js/242.dd7edeca.js"><link rel="prefetch" href="/assets/js/243.3195cf5a.js"><link rel="prefetch" href="/assets/js/244.970bd161.js"><link rel="prefetch" href="/assets/js/245.f1f4d312.js"><link rel="prefetch" href="/assets/js/246.a72fafcb.js"><link rel="prefetch" href="/assets/js/247.b654c569.js"><link rel="prefetch" href="/assets/js/248.ff5b017c.js"><link rel="prefetch" href="/assets/js/249.2249c0b8.js"><link rel="prefetch" href="/assets/js/25.9c2ee2f7.js"><link rel="prefetch" href="/assets/js/250.237b1e8c.js"><link rel="prefetch" href="/assets/js/251.9314e5de.js"><link rel="prefetch" href="/assets/js/252.bf7a2973.js"><link rel="prefetch" href="/assets/js/253.8f8d1501.js"><link rel="prefetch" href="/assets/js/254.864587c8.js"><link rel="prefetch" href="/assets/js/255.9db8e189.js"><link rel="prefetch" href="/assets/js/256.adef4f24.js"><link rel="prefetch" href="/assets/js/257.175942f9.js"><link rel="prefetch" href="/assets/js/258.483371fa.js"><link rel="prefetch" href="/assets/js/259.9e8f0bf1.js"><link rel="prefetch" href="/assets/js/26.c0a0a21b.js"><link rel="prefetch" href="/assets/js/260.fb6566de.js"><link rel="prefetch" href="/assets/js/261.b45c07c5.js"><link rel="prefetch" href="/assets/js/262.7bacea14.js"><link rel="prefetch" href="/assets/js/263.e55e49ea.js"><link rel="prefetch" href="/assets/js/264.69a2e5fc.js"><link rel="prefetch" href="/assets/js/265.c6ded0bc.js"><link rel="prefetch" href="/assets/js/266.778b08d4.js"><link rel="prefetch" href="/assets/js/267.712818ba.js"><link rel="prefetch" href="/assets/js/268.9c93d8cb.js"><link rel="prefetch" href="/assets/js/269.be09c8ce.js"><link rel="prefetch" href="/assets/js/27.9e91a37c.js"><link rel="prefetch" href="/assets/js/270.b7fbeedf.js"><link rel="prefetch" href="/assets/js/271.9ec9c0e5.js"><link rel="prefetch" href="/assets/js/272.a8bf22d3.js"><link rel="prefetch" href="/assets/js/273.b426ef89.js"><link rel="prefetch" href="/assets/js/274.6c6f2d51.js"><link rel="prefetch" href="/assets/js/275.7563cfd0.js"><link rel="prefetch" href="/assets/js/276.a47754ee.js"><link rel="prefetch" href="/assets/js/277.acbe18a4.js"><link rel="prefetch" href="/assets/js/278.a6158a81.js"><link rel="prefetch" href="/assets/js/279.eb2931d0.js"><link rel="prefetch" href="/assets/js/28.cac7eec4.js"><link rel="prefetch" href="/assets/js/280.2a10e65f.js"><link rel="prefetch" href="/assets/js/281.58ec7dbd.js"><link rel="prefetch" href="/assets/js/282.38697cf5.js"><link rel="prefetch" href="/assets/js/283.6fa7b5c6.js"><link rel="prefetch" href="/assets/js/284.003170d1.js"><link rel="prefetch" href="/assets/js/285.5c3cf6fb.js"><link rel="prefetch" href="/assets/js/286.600238ea.js"><link rel="prefetch" href="/assets/js/287.b521930c.js"><link rel="prefetch" href="/assets/js/288.3e91cc35.js"><link rel="prefetch" href="/assets/js/289.d8a5fb40.js"><link rel="prefetch" href="/assets/js/29.d4fb0baa.js"><link rel="prefetch" href="/assets/js/290.d272758e.js"><link rel="prefetch" href="/assets/js/291.136de44a.js"><link rel="prefetch" href="/assets/js/292.9d70b4a3.js"><link rel="prefetch" href="/assets/js/293.6075b193.js"><link rel="prefetch" href="/assets/js/294.6750e797.js"><link rel="prefetch" href="/assets/js/295.3cbe9f4e.js"><link rel="prefetch" href="/assets/js/296.feee6cd8.js"><link rel="prefetch" href="/assets/js/297.2a5090eb.js"><link rel="prefetch" href="/assets/js/298.7d252612.js"><link rel="prefetch" href="/assets/js/299.274f870e.js"><link rel="prefetch" href="/assets/js/3.9e9b5e25.js"><link rel="prefetch" href="/assets/js/30.22e3d275.js"><link rel="prefetch" href="/assets/js/300.aeafd07f.js"><link rel="prefetch" href="/assets/js/301.41a49fbe.js"><link rel="prefetch" href="/assets/js/302.2fb22049.js"><link rel="prefetch" href="/assets/js/303.961a164e.js"><link rel="prefetch" href="/assets/js/304.0bc4bdd7.js"><link rel="prefetch" href="/assets/js/305.3cc92c93.js"><link rel="prefetch" href="/assets/js/306.28938683.js"><link rel="prefetch" href="/assets/js/307.c6b6e684.js"><link rel="prefetch" href="/assets/js/308.5e863f51.js"><link rel="prefetch" href="/assets/js/309.91faac64.js"><link rel="prefetch" href="/assets/js/31.92bfcd9a.js"><link rel="prefetch" href="/assets/js/310.189c8362.js"><link rel="prefetch" href="/assets/js/311.17af387d.js"><link rel="prefetch" href="/assets/js/312.ebb768e9.js"><link rel="prefetch" href="/assets/js/313.bfec160b.js"><link rel="prefetch" href="/assets/js/314.56edf5ef.js"><link rel="prefetch" href="/assets/js/315.d1379302.js"><link rel="prefetch" href="/assets/js/316.0e3d3e8d.js"><link rel="prefetch" href="/assets/js/317.5f850650.js"><link rel="prefetch" href="/assets/js/318.ad4d6df5.js"><link rel="prefetch" href="/assets/js/319.1b9cde42.js"><link rel="prefetch" href="/assets/js/32.be2b19b3.js"><link rel="prefetch" href="/assets/js/320.7773afd2.js"><link rel="prefetch" href="/assets/js/321.c210c5d6.js"><link rel="prefetch" href="/assets/js/322.e39d776d.js"><link rel="prefetch" href="/assets/js/323.dae550ce.js"><link rel="prefetch" href="/assets/js/324.6fc82e96.js"><link rel="prefetch" href="/assets/js/325.410713ee.js"><link rel="prefetch" href="/assets/js/326.49d5c616.js"><link rel="prefetch" href="/assets/js/327.141aa003.js"><link rel="prefetch" href="/assets/js/328.e300cb65.js"><link rel="prefetch" href="/assets/js/329.96703a1d.js"><link rel="prefetch" href="/assets/js/33.57c1de90.js"><link rel="prefetch" href="/assets/js/330.372f3364.js"><link rel="prefetch" href="/assets/js/331.30566d73.js"><link rel="prefetch" href="/assets/js/332.653ca2a9.js"><link rel="prefetch" href="/assets/js/333.768265fe.js"><link rel="prefetch" href="/assets/js/334.28270783.js"><link rel="prefetch" href="/assets/js/335.73b590c1.js"><link rel="prefetch" href="/assets/js/336.a4c4761f.js"><link rel="prefetch" href="/assets/js/337.2254aca1.js"><link rel="prefetch" href="/assets/js/338.47fc622c.js"><link rel="prefetch" href="/assets/js/339.2dd5f2d1.js"><link rel="prefetch" href="/assets/js/34.fcf10f7f.js"><link rel="prefetch" href="/assets/js/340.6c61fee5.js"><link rel="prefetch" href="/assets/js/341.1da9a6e9.js"><link rel="prefetch" href="/assets/js/342.968f26fc.js"><link rel="prefetch" href="/assets/js/343.77f7340e.js"><link rel="prefetch" href="/assets/js/344.4342d868.js"><link rel="prefetch" href="/assets/js/345.5b128dde.js"><link rel="prefetch" href="/assets/js/346.b0b0f4bf.js"><link rel="prefetch" href="/assets/js/347.5c03a71a.js"><link rel="prefetch" href="/assets/js/348.4b9f6ec1.js"><link rel="prefetch" href="/assets/js/349.97318690.js"><link rel="prefetch" href="/assets/js/35.1a6d30d9.js"><link rel="prefetch" href="/assets/js/350.7e34f068.js"><link rel="prefetch" href="/assets/js/351.ebfa01e7.js"><link rel="prefetch" href="/assets/js/352.90ca92e4.js"><link rel="prefetch" href="/assets/js/353.2086a731.js"><link rel="prefetch" href="/assets/js/354.6713f7d9.js"><link rel="prefetch" href="/assets/js/355.fb969207.js"><link rel="prefetch" href="/assets/js/356.d2e3e330.js"><link rel="prefetch" href="/assets/js/357.a3f26186.js"><link rel="prefetch" href="/assets/js/358.d449e911.js"><link rel="prefetch" href="/assets/js/359.1e4b6182.js"><link rel="prefetch" href="/assets/js/36.cd2a99ce.js"><link rel="prefetch" href="/assets/js/360.c7515b95.js"><link rel="prefetch" href="/assets/js/361.02a24694.js"><link rel="prefetch" href="/assets/js/362.9a353aba.js"><link rel="prefetch" href="/assets/js/363.ec71efc5.js"><link rel="prefetch" href="/assets/js/364.7201072c.js"><link rel="prefetch" href="/assets/js/365.d9f3e285.js"><link rel="prefetch" href="/assets/js/366.36855902.js"><link rel="prefetch" href="/assets/js/367.997ffb7f.js"><link rel="prefetch" href="/assets/js/368.b715970b.js"><link rel="prefetch" href="/assets/js/369.9fe9db6e.js"><link rel="prefetch" href="/assets/js/37.3bb2e28f.js"><link rel="prefetch" href="/assets/js/370.8f0ee176.js"><link rel="prefetch" href="/assets/js/371.cb9350ee.js"><link rel="prefetch" href="/assets/js/372.0659edbb.js"><link rel="prefetch" href="/assets/js/373.14db078b.js"><link rel="prefetch" href="/assets/js/374.f48797e9.js"><link rel="prefetch" href="/assets/js/375.1460ed5d.js"><link rel="prefetch" href="/assets/js/376.ac28c284.js"><link rel="prefetch" href="/assets/js/377.17c107a3.js"><link rel="prefetch" href="/assets/js/378.c65f4d24.js"><link rel="prefetch" href="/assets/js/379.bbb14c7e.js"><link rel="prefetch" href="/assets/js/38.cec7bd1d.js"><link rel="prefetch" href="/assets/js/380.c6fdc5b2.js"><link rel="prefetch" href="/assets/js/381.cbd08714.js"><link rel="prefetch" href="/assets/js/382.ea81a93c.js"><link rel="prefetch" href="/assets/js/383.fea3dc2f.js"><link rel="prefetch" href="/assets/js/384.39e6cb28.js"><link rel="prefetch" href="/assets/js/385.5c148cdb.js"><link rel="prefetch" href="/assets/js/386.9ea8b696.js"><link rel="prefetch" href="/assets/js/387.075be1b7.js"><link rel="prefetch" href="/assets/js/388.3bb3e594.js"><link rel="prefetch" href="/assets/js/389.d21efa19.js"><link rel="prefetch" href="/assets/js/39.6f89d924.js"><link rel="prefetch" href="/assets/js/390.abceb1db.js"><link rel="prefetch" href="/assets/js/391.81d54013.js"><link rel="prefetch" href="/assets/js/392.e016f0d9.js"><link rel="prefetch" href="/assets/js/393.597bd7db.js"><link rel="prefetch" href="/assets/js/394.0badf15c.js"><link rel="prefetch" href="/assets/js/395.c165c190.js"><link rel="prefetch" href="/assets/js/396.615d7cc0.js"><link rel="prefetch" href="/assets/js/397.21824763.js"><link rel="prefetch" href="/assets/js/398.7ca1a1c1.js"><link rel="prefetch" href="/assets/js/399.4fe09ef7.js"><link rel="prefetch" href="/assets/js/4.621d8344.js"><link rel="prefetch" href="/assets/js/40.d47700a6.js"><link rel="prefetch" href="/assets/js/400.102f18b9.js"><link rel="prefetch" href="/assets/js/401.f5de4c2d.js"><link rel="prefetch" href="/assets/js/402.2da21ceb.js"><link rel="prefetch" href="/assets/js/403.2b1428cb.js"><link rel="prefetch" href="/assets/js/404.a7f33885.js"><link rel="prefetch" href="/assets/js/405.37bb534a.js"><link rel="prefetch" href="/assets/js/406.19fadc50.js"><link rel="prefetch" href="/assets/js/407.7b8357d3.js"><link rel="prefetch" href="/assets/js/408.3c663d59.js"><link rel="prefetch" href="/assets/js/409.b9bed587.js"><link rel="prefetch" href="/assets/js/41.11c231fb.js"><link rel="prefetch" href="/assets/js/410.72f116bb.js"><link rel="prefetch" href="/assets/js/411.c87bab56.js"><link rel="prefetch" href="/assets/js/412.a2db9ff4.js"><link rel="prefetch" href="/assets/js/413.e59fcd73.js"><link rel="prefetch" href="/assets/js/414.6a4e284d.js"><link rel="prefetch" href="/assets/js/415.7492a0ee.js"><link rel="prefetch" href="/assets/js/416.2b2af04f.js"><link rel="prefetch" href="/assets/js/417.3298af1a.js"><link rel="prefetch" href="/assets/js/418.6ac7189f.js"><link rel="prefetch" href="/assets/js/419.8253b2c6.js"><link rel="prefetch" href="/assets/js/42.b5d1c19f.js"><link rel="prefetch" href="/assets/js/420.990ebd95.js"><link rel="prefetch" href="/assets/js/421.350b3282.js"><link rel="prefetch" href="/assets/js/422.8c2c0962.js"><link rel="prefetch" href="/assets/js/423.52065c9a.js"><link rel="prefetch" href="/assets/js/424.3b49f119.js"><link rel="prefetch" href="/assets/js/425.96db89e0.js"><link rel="prefetch" href="/assets/js/426.b3453f64.js"><link rel="prefetch" href="/assets/js/427.445fa3a8.js"><link rel="prefetch" href="/assets/js/428.a7f73e61.js"><link rel="prefetch" href="/assets/js/429.5f77ea47.js"><link rel="prefetch" href="/assets/js/43.7f9a712d.js"><link rel="prefetch" href="/assets/js/430.edd4aebb.js"><link rel="prefetch" href="/assets/js/431.9fa7cd9a.js"><link rel="prefetch" href="/assets/js/432.52104d64.js"><link rel="prefetch" href="/assets/js/433.968d9d94.js"><link rel="prefetch" href="/assets/js/434.cf8110a7.js"><link rel="prefetch" href="/assets/js/435.6140fac8.js"><link rel="prefetch" href="/assets/js/436.5254801d.js"><link rel="prefetch" href="/assets/js/437.ed5b23a0.js"><link rel="prefetch" href="/assets/js/438.e34faaba.js"><link rel="prefetch" href="/assets/js/439.4fe90a5c.js"><link rel="prefetch" href="/assets/js/44.00c9dce7.js"><link rel="prefetch" href="/assets/js/440.38aa47ae.js"><link rel="prefetch" href="/assets/js/441.ca06d7c8.js"><link rel="prefetch" href="/assets/js/442.77a49e2a.js"><link rel="prefetch" href="/assets/js/443.7782dae7.js"><link rel="prefetch" href="/assets/js/444.5bbfd9b3.js"><link rel="prefetch" href="/assets/js/445.6354800f.js"><link rel="prefetch" href="/assets/js/446.bb8c4cee.js"><link rel="prefetch" href="/assets/js/447.3e8adc74.js"><link rel="prefetch" href="/assets/js/448.698dd064.js"><link rel="prefetch" href="/assets/js/449.2b54096e.js"><link rel="prefetch" href="/assets/js/45.2fdac889.js"><link rel="prefetch" href="/assets/js/450.cba02e9e.js"><link rel="prefetch" href="/assets/js/451.b6075d18.js"><link rel="prefetch" href="/assets/js/452.69e3a0ae.js"><link rel="prefetch" href="/assets/js/453.9cd03c82.js"><link rel="prefetch" href="/assets/js/454.29ada77d.js"><link rel="prefetch" href="/assets/js/455.33fb6e76.js"><link rel="prefetch" href="/assets/js/456.ee23f655.js"><link rel="prefetch" href="/assets/js/457.2ce83ac3.js"><link rel="prefetch" href="/assets/js/458.619b6da6.js"><link rel="prefetch" href="/assets/js/459.b3db485a.js"><link rel="prefetch" href="/assets/js/46.b251cb55.js"><link rel="prefetch" href="/assets/js/460.ec15fda2.js"><link rel="prefetch" href="/assets/js/461.0c5800c1.js"><link rel="prefetch" href="/assets/js/462.be64cfb5.js"><link rel="prefetch" href="/assets/js/463.62a0ddf2.js"><link rel="prefetch" href="/assets/js/464.4ad2c9b4.js"><link rel="prefetch" href="/assets/js/465.47cd559a.js"><link rel="prefetch" href="/assets/js/466.3926c25f.js"><link rel="prefetch" href="/assets/js/467.634b8765.js"><link rel="prefetch" href="/assets/js/468.4eb35493.js"><link rel="prefetch" href="/assets/js/469.5d53207f.js"><link rel="prefetch" href="/assets/js/47.f1efed91.js"><link rel="prefetch" href="/assets/js/470.b3f2f04a.js"><link rel="prefetch" href="/assets/js/471.b7d10a12.js"><link rel="prefetch" href="/assets/js/472.162fa248.js"><link rel="prefetch" href="/assets/js/473.778237bc.js"><link rel="prefetch" href="/assets/js/474.001710a5.js"><link rel="prefetch" href="/assets/js/475.a8501822.js"><link rel="prefetch" href="/assets/js/476.3c1702cd.js"><link rel="prefetch" href="/assets/js/477.9ad56062.js"><link rel="prefetch" href="/assets/js/478.66c13a3f.js"><link rel="prefetch" href="/assets/js/479.a28a8a0b.js"><link rel="prefetch" href="/assets/js/48.f1c2fda1.js"><link rel="prefetch" href="/assets/js/480.3e4609e5.js"><link rel="prefetch" href="/assets/js/481.ad360a4e.js"><link rel="prefetch" href="/assets/js/482.6b37e8e7.js"><link rel="prefetch" href="/assets/js/483.a258f2ba.js"><link rel="prefetch" href="/assets/js/484.8abe13f7.js"><link rel="prefetch" href="/assets/js/485.f3289881.js"><link rel="prefetch" href="/assets/js/486.5b528f65.js"><link rel="prefetch" href="/assets/js/487.53eedb39.js"><link rel="prefetch" href="/assets/js/488.0ec812d2.js"><link rel="prefetch" href="/assets/js/489.b65f7364.js"><link rel="prefetch" href="/assets/js/49.a98cdb8e.js"><link rel="prefetch" href="/assets/js/490.c567a461.js"><link rel="prefetch" href="/assets/js/491.c67701d5.js"><link rel="prefetch" href="/assets/js/492.679e81a6.js"><link rel="prefetch" href="/assets/js/493.7140b651.js"><link rel="prefetch" href="/assets/js/494.5a623215.js"><link rel="prefetch" href="/assets/js/495.ba753696.js"><link rel="prefetch" href="/assets/js/496.9745f271.js"><link rel="prefetch" href="/assets/js/497.f8b3ed8e.js"><link rel="prefetch" href="/assets/js/498.c18e16ff.js"><link rel="prefetch" href="/assets/js/499.ad35c923.js"><link rel="prefetch" href="/assets/js/5.268c9d85.js"><link rel="prefetch" href="/assets/js/50.4330d907.js"><link rel="prefetch" href="/assets/js/500.4f62541a.js"><link rel="prefetch" href="/assets/js/501.bf504e2b.js"><link rel="prefetch" href="/assets/js/502.31f6d3cd.js"><link rel="prefetch" href="/assets/js/503.a6fcb563.js"><link rel="prefetch" href="/assets/js/504.2317876c.js"><link rel="prefetch" href="/assets/js/505.b066052c.js"><link rel="prefetch" href="/assets/js/506.aa75ec9c.js"><link rel="prefetch" href="/assets/js/507.db28c0dc.js"><link rel="prefetch" href="/assets/js/508.96dea733.js"><link rel="prefetch" href="/assets/js/509.751121a9.js"><link rel="prefetch" href="/assets/js/51.04796fd5.js"><link rel="prefetch" href="/assets/js/510.2b53ed1e.js"><link rel="prefetch" href="/assets/js/511.6ab2a2f1.js"><link rel="prefetch" href="/assets/js/512.0138ec47.js"><link rel="prefetch" href="/assets/js/513.0b551945.js"><link rel="prefetch" href="/assets/js/514.c48ab4d1.js"><link rel="prefetch" href="/assets/js/515.05b141f2.js"><link rel="prefetch" href="/assets/js/516.ceeb1b20.js"><link rel="prefetch" href="/assets/js/517.e8121350.js"><link rel="prefetch" href="/assets/js/518.02658c5c.js"><link rel="prefetch" href="/assets/js/519.06f2f6fa.js"><link rel="prefetch" href="/assets/js/52.1fa5db81.js"><link rel="prefetch" href="/assets/js/520.198378c0.js"><link rel="prefetch" href="/assets/js/521.583b04ef.js"><link rel="prefetch" href="/assets/js/522.f16bf3e6.js"><link rel="prefetch" href="/assets/js/523.2407b56e.js"><link rel="prefetch" href="/assets/js/524.82232300.js"><link rel="prefetch" href="/assets/js/525.4a1a7ae9.js"><link rel="prefetch" href="/assets/js/526.9532a8e5.js"><link rel="prefetch" href="/assets/js/527.49ed3462.js"><link rel="prefetch" href="/assets/js/528.2ae46c9e.js"><link rel="prefetch" href="/assets/js/529.53d56865.js"><link rel="prefetch" href="/assets/js/53.ae276191.js"><link rel="prefetch" href="/assets/js/530.83b479f2.js"><link rel="prefetch" href="/assets/js/531.40db975f.js"><link rel="prefetch" href="/assets/js/532.922ca632.js"><link rel="prefetch" href="/assets/js/533.5f93b309.js"><link rel="prefetch" href="/assets/js/534.e0179c7b.js"><link rel="prefetch" href="/assets/js/535.aeb8b946.js"><link rel="prefetch" href="/assets/js/536.6c586178.js"><link rel="prefetch" href="/assets/js/537.d55698f4.js"><link rel="prefetch" href="/assets/js/538.6c956d5b.js"><link rel="prefetch" href="/assets/js/539.56b08be6.js"><link rel="prefetch" href="/assets/js/54.e72619e6.js"><link rel="prefetch" href="/assets/js/540.2dd7c8d5.js"><link rel="prefetch" href="/assets/js/541.1936a7e4.js"><link rel="prefetch" href="/assets/js/542.ebf92ca5.js"><link rel="prefetch" href="/assets/js/543.745a0af2.js"><link rel="prefetch" href="/assets/js/544.4ba048c8.js"><link rel="prefetch" href="/assets/js/545.e7b61f2f.js"><link rel="prefetch" href="/assets/js/546.5e0a5a74.js"><link rel="prefetch" href="/assets/js/547.fac117dc.js"><link rel="prefetch" href="/assets/js/548.b46ba823.js"><link rel="prefetch" href="/assets/js/549.79c0ddc7.js"><link rel="prefetch" href="/assets/js/55.47fa70d1.js"><link rel="prefetch" href="/assets/js/550.c117524d.js"><link rel="prefetch" href="/assets/js/551.37422c83.js"><link rel="prefetch" href="/assets/js/552.8934e1a5.js"><link rel="prefetch" href="/assets/js/553.f8cf3d48.js"><link rel="prefetch" href="/assets/js/554.1744de3c.js"><link rel="prefetch" href="/assets/js/555.4769a5a8.js"><link rel="prefetch" href="/assets/js/556.07599664.js"><link rel="prefetch" href="/assets/js/557.19721467.js"><link rel="prefetch" href="/assets/js/558.4cd1b1a9.js"><link rel="prefetch" href="/assets/js/559.4b658ebd.js"><link rel="prefetch" href="/assets/js/56.d9a038e8.js"><link rel="prefetch" href="/assets/js/560.a015d3ab.js"><link rel="prefetch" href="/assets/js/561.3ff395d4.js"><link rel="prefetch" href="/assets/js/562.0f00f1bc.js"><link rel="prefetch" href="/assets/js/563.2ee9f5cf.js"><link rel="prefetch" href="/assets/js/564.e93f5628.js"><link rel="prefetch" href="/assets/js/565.77023710.js"><link rel="prefetch" href="/assets/js/566.1236889b.js"><link rel="prefetch" href="/assets/js/567.2cbb844f.js"><link rel="prefetch" href="/assets/js/568.da51ef66.js"><link rel="prefetch" href="/assets/js/569.cb598a74.js"><link rel="prefetch" href="/assets/js/57.3af65d56.js"><link rel="prefetch" href="/assets/js/570.d099510a.js"><link rel="prefetch" href="/assets/js/571.e1f759b3.js"><link rel="prefetch" href="/assets/js/572.8d062a2c.js"><link rel="prefetch" href="/assets/js/573.7a53c230.js"><link rel="prefetch" href="/assets/js/574.1fdea0b5.js"><link rel="prefetch" href="/assets/js/575.c686a880.js"><link rel="prefetch" href="/assets/js/576.e7543694.js"><link rel="prefetch" href="/assets/js/577.8d3f106a.js"><link rel="prefetch" href="/assets/js/578.b74e5dae.js"><link rel="prefetch" href="/assets/js/579.0af0725d.js"><link rel="prefetch" href="/assets/js/58.d00577a0.js"><link rel="prefetch" href="/assets/js/580.e269a0d4.js"><link rel="prefetch" href="/assets/js/581.e8922172.js"><link rel="prefetch" href="/assets/js/582.317f7c79.js"><link rel="prefetch" href="/assets/js/583.815698b1.js"><link rel="prefetch" href="/assets/js/584.38169f21.js"><link rel="prefetch" href="/assets/js/585.2acab684.js"><link rel="prefetch" href="/assets/js/586.63671945.js"><link rel="prefetch" href="/assets/js/587.9f0f7c13.js"><link rel="prefetch" href="/assets/js/588.9eddc668.js"><link rel="prefetch" href="/assets/js/589.61fff007.js"><link rel="prefetch" href="/assets/js/59.eea159cf.js"><link rel="prefetch" href="/assets/js/590.504d39aa.js"><link rel="prefetch" href="/assets/js/591.4d2a8847.js"><link rel="prefetch" href="/assets/js/592.7a7b838a.js"><link rel="prefetch" href="/assets/js/593.00bfe351.js"><link rel="prefetch" href="/assets/js/594.32cfaa6a.js"><link rel="prefetch" href="/assets/js/595.c2a861d0.js"><link rel="prefetch" href="/assets/js/596.e7d4b818.js"><link rel="prefetch" href="/assets/js/597.ff46f054.js"><link rel="prefetch" href="/assets/js/598.ce751357.js"><link rel="prefetch" href="/assets/js/599.b3a59b40.js"><link rel="prefetch" href="/assets/js/6.cd5e5955.js"><link rel="prefetch" href="/assets/js/60.b16f58e4.js"><link rel="prefetch" href="/assets/js/600.693b6242.js"><link rel="prefetch" href="/assets/js/601.3930bcbf.js"><link rel="prefetch" href="/assets/js/602.d402ce69.js"><link rel="prefetch" href="/assets/js/603.d69517ec.js"><link rel="prefetch" href="/assets/js/604.8c653f7d.js"><link rel="prefetch" href="/assets/js/605.6d031870.js"><link rel="prefetch" href="/assets/js/606.60679442.js"><link rel="prefetch" href="/assets/js/607.707b8918.js"><link rel="prefetch" href="/assets/js/608.3428fc51.js"><link rel="prefetch" href="/assets/js/609.f29daf26.js"><link rel="prefetch" href="/assets/js/61.74044625.js"><link rel="prefetch" href="/assets/js/610.b4f827d0.js"><link rel="prefetch" href="/assets/js/611.e01fb58f.js"><link rel="prefetch" href="/assets/js/612.c40f0cca.js"><link rel="prefetch" href="/assets/js/613.302f4905.js"><link rel="prefetch" href="/assets/js/614.b1220bce.js"><link rel="prefetch" href="/assets/js/615.83c642f0.js"><link rel="prefetch" href="/assets/js/616.2a887ef3.js"><link rel="prefetch" href="/assets/js/617.ad64d98d.js"><link rel="prefetch" href="/assets/js/618.745233f0.js"><link rel="prefetch" href="/assets/js/619.4c62a95b.js"><link rel="prefetch" href="/assets/js/62.a74bdbf4.js"><link rel="prefetch" href="/assets/js/620.18b97efe.js"><link rel="prefetch" href="/assets/js/621.08de4bbe.js"><link rel="prefetch" href="/assets/js/622.c2e0ec39.js"><link rel="prefetch" href="/assets/js/623.5893ebb1.js"><link rel="prefetch" href="/assets/js/624.9b743f0b.js"><link rel="prefetch" href="/assets/js/625.eac9d9e9.js"><link rel="prefetch" href="/assets/js/626.5491ae26.js"><link rel="prefetch" href="/assets/js/627.c7069907.js"><link rel="prefetch" href="/assets/js/628.e110f9d1.js"><link rel="prefetch" href="/assets/js/629.80f57e0f.js"><link rel="prefetch" href="/assets/js/63.516d6648.js"><link rel="prefetch" href="/assets/js/630.fc65bf18.js"><link rel="prefetch" href="/assets/js/631.67071505.js"><link rel="prefetch" href="/assets/js/632.cb1ccd74.js"><link rel="prefetch" href="/assets/js/633.5eee70cf.js"><link rel="prefetch" href="/assets/js/634.736bdb04.js"><link rel="prefetch" href="/assets/js/635.72b7b37c.js"><link rel="prefetch" href="/assets/js/636.d6af8977.js"><link rel="prefetch" href="/assets/js/637.1aff4054.js"><link rel="prefetch" href="/assets/js/638.a6064a9d.js"><link rel="prefetch" href="/assets/js/639.45f81169.js"><link rel="prefetch" href="/assets/js/64.4eca6498.js"><link rel="prefetch" href="/assets/js/640.6b59a69c.js"><link rel="prefetch" href="/assets/js/641.a0bbc56a.js"><link rel="prefetch" href="/assets/js/642.da48d725.js"><link rel="prefetch" href="/assets/js/643.fdd9b765.js"><link rel="prefetch" href="/assets/js/644.5e27220c.js"><link rel="prefetch" href="/assets/js/645.33388183.js"><link rel="prefetch" href="/assets/js/646.61f4fff5.js"><link rel="prefetch" href="/assets/js/647.fcab3a4a.js"><link rel="prefetch" href="/assets/js/648.50ed7cd6.js"><link rel="prefetch" href="/assets/js/649.2b0c5236.js"><link rel="prefetch" href="/assets/js/65.8374a5ba.js"><link rel="prefetch" href="/assets/js/650.d2dfd936.js"><link rel="prefetch" href="/assets/js/651.6ba7b1af.js"><link rel="prefetch" href="/assets/js/652.5628597e.js"><link rel="prefetch" href="/assets/js/653.dd415e1e.js"><link rel="prefetch" href="/assets/js/654.ac3c785d.js"><link rel="prefetch" href="/assets/js/655.bb9998ea.js"><link rel="prefetch" href="/assets/js/656.94a5df91.js"><link rel="prefetch" href="/assets/js/657.bf71f1ae.js"><link rel="prefetch" href="/assets/js/658.a8861db2.js"><link rel="prefetch" href="/assets/js/659.2246dd3a.js"><link rel="prefetch" href="/assets/js/66.ed93a8fd.js"><link rel="prefetch" href="/assets/js/660.ca699aab.js"><link rel="prefetch" href="/assets/js/661.a1ff464e.js"><link rel="prefetch" href="/assets/js/662.0b026a59.js"><link rel="prefetch" href="/assets/js/663.06eb07d6.js"><link rel="prefetch" href="/assets/js/664.dc54e3c5.js"><link rel="prefetch" href="/assets/js/665.d3739c12.js"><link rel="prefetch" href="/assets/js/666.50d06d9c.js"><link rel="prefetch" href="/assets/js/667.3c84c2ac.js"><link rel="prefetch" href="/assets/js/668.930772d5.js"><link rel="prefetch" href="/assets/js/669.1125dbcd.js"><link rel="prefetch" href="/assets/js/67.edb06971.js"><link rel="prefetch" href="/assets/js/670.24dfd401.js"><link rel="prefetch" href="/assets/js/671.15785c2b.js"><link rel="prefetch" href="/assets/js/672.bd1c9cc4.js"><link rel="prefetch" href="/assets/js/673.57699de5.js"><link rel="prefetch" href="/assets/js/674.d8ed426d.js"><link rel="prefetch" href="/assets/js/675.b9743bf5.js"><link rel="prefetch" href="/assets/js/676.b0df0458.js"><link rel="prefetch" href="/assets/js/677.9c8a1e2a.js"><link rel="prefetch" href="/assets/js/678.445548bc.js"><link rel="prefetch" href="/assets/js/679.f22557b1.js"><link rel="prefetch" href="/assets/js/68.43c87e29.js"><link rel="prefetch" href="/assets/js/680.03c70d5e.js"><link rel="prefetch" href="/assets/js/681.c89aedea.js"><link rel="prefetch" href="/assets/js/682.a5dc7062.js"><link rel="prefetch" href="/assets/js/683.f5a7823a.js"><link rel="prefetch" href="/assets/js/684.c34f49cf.js"><link rel="prefetch" href="/assets/js/685.95c8385a.js"><link rel="prefetch" href="/assets/js/686.c13775a6.js"><link rel="prefetch" href="/assets/js/687.6bdf1a90.js"><link rel="prefetch" href="/assets/js/688.baaf8cc2.js"><link rel="prefetch" href="/assets/js/689.208238ae.js"><link rel="prefetch" href="/assets/js/69.3681504d.js"><link rel="prefetch" href="/assets/js/690.20267076.js"><link rel="prefetch" href="/assets/js/691.a09f6653.js"><link rel="prefetch" href="/assets/js/692.a7e8d3c4.js"><link rel="prefetch" href="/assets/js/693.2ba5a6b1.js"><link rel="prefetch" href="/assets/js/694.d1cba334.js"><link rel="prefetch" href="/assets/js/695.beddc3b5.js"><link rel="prefetch" href="/assets/js/696.4b0081b3.js"><link rel="prefetch" href="/assets/js/697.c71c2d08.js"><link rel="prefetch" href="/assets/js/698.0f822efc.js"><link rel="prefetch" href="/assets/js/699.b5e81149.js"><link rel="prefetch" href="/assets/js/7.c415ef02.js"><link rel="prefetch" href="/assets/js/70.b88bd921.js"><link rel="prefetch" href="/assets/js/700.65e71a00.js"><link rel="prefetch" href="/assets/js/701.a4a40795.js"><link rel="prefetch" href="/assets/js/702.6b4855f1.js"><link rel="prefetch" href="/assets/js/703.5bc07aeb.js"><link rel="prefetch" href="/assets/js/704.7baa9aca.js"><link rel="prefetch" href="/assets/js/705.9f168e7c.js"><link rel="prefetch" href="/assets/js/706.2ee29295.js"><link rel="prefetch" href="/assets/js/707.41591dd3.js"><link rel="prefetch" href="/assets/js/708.fc4759f0.js"><link rel="prefetch" href="/assets/js/709.4df2d1ba.js"><link rel="prefetch" href="/assets/js/71.2cebd421.js"><link rel="prefetch" href="/assets/js/710.573f33f8.js"><link rel="prefetch" href="/assets/js/711.80a10756.js"><link rel="prefetch" href="/assets/js/712.38a86826.js"><link rel="prefetch" href="/assets/js/713.790ebf7e.js"><link rel="prefetch" href="/assets/js/714.a82ffd7d.js"><link rel="prefetch" href="/assets/js/715.c5d9908b.js"><link rel="prefetch" href="/assets/js/716.974d82ae.js"><link rel="prefetch" href="/assets/js/717.2149d4da.js"><link rel="prefetch" href="/assets/js/718.7c011064.js"><link rel="prefetch" href="/assets/js/719.81e007c5.js"><link rel="prefetch" href="/assets/js/72.f0df14a7.js"><link rel="prefetch" href="/assets/js/720.e8db7f50.js"><link rel="prefetch" href="/assets/js/721.0e5ec0ef.js"><link rel="prefetch" href="/assets/js/722.db6868ea.js"><link rel="prefetch" href="/assets/js/723.b18a4810.js"><link rel="prefetch" href="/assets/js/724.10b56b68.js"><link rel="prefetch" href="/assets/js/725.6ae74df4.js"><link rel="prefetch" href="/assets/js/726.18eb6c23.js"><link rel="prefetch" href="/assets/js/727.be4c55ec.js"><link rel="prefetch" href="/assets/js/728.49151280.js"><link rel="prefetch" href="/assets/js/729.4e983537.js"><link rel="prefetch" href="/assets/js/73.8db32394.js"><link rel="prefetch" href="/assets/js/730.6f0e888e.js"><link rel="prefetch" href="/assets/js/731.0b21016c.js"><link rel="prefetch" href="/assets/js/732.68d9caf9.js"><link rel="prefetch" href="/assets/js/733.c35594d8.js"><link rel="prefetch" href="/assets/js/734.6362f9f4.js"><link rel="prefetch" href="/assets/js/735.2a710e76.js"><link rel="prefetch" href="/assets/js/736.8be8fe7c.js"><link rel="prefetch" href="/assets/js/737.59d29403.js"><link rel="prefetch" href="/assets/js/738.56ccfb0f.js"><link rel="prefetch" href="/assets/js/739.a1a45b3c.js"><link rel="prefetch" href="/assets/js/74.1e9c0957.js"><link rel="prefetch" href="/assets/js/740.39bf2514.js"><link rel="prefetch" href="/assets/js/741.c391a3a8.js"><link rel="prefetch" href="/assets/js/742.cfaf9307.js"><link rel="prefetch" href="/assets/js/743.3a0c7f57.js"><link rel="prefetch" href="/assets/js/744.c7539842.js"><link rel="prefetch" href="/assets/js/745.2f4b089b.js"><link rel="prefetch" href="/assets/js/746.a5561e81.js"><link rel="prefetch" href="/assets/js/747.5fd89c89.js"><link rel="prefetch" href="/assets/js/748.18843b8d.js"><link rel="prefetch" href="/assets/js/749.15a74b6f.js"><link rel="prefetch" href="/assets/js/75.2104b0ce.js"><link rel="prefetch" href="/assets/js/750.cb13ff5f.js"><link rel="prefetch" href="/assets/js/751.c734df2b.js"><link rel="prefetch" href="/assets/js/752.7b82284f.js"><link rel="prefetch" href="/assets/js/753.d125fe71.js"><link rel="prefetch" href="/assets/js/754.eaeefc5e.js"><link rel="prefetch" href="/assets/js/755.9edc640d.js"><link rel="prefetch" href="/assets/js/756.66b52fb4.js"><link rel="prefetch" href="/assets/js/757.96e6dc8c.js"><link rel="prefetch" href="/assets/js/758.61d6f212.js"><link rel="prefetch" href="/assets/js/759.b0e9c3f4.js"><link rel="prefetch" href="/assets/js/76.af3cda5a.js"><link rel="prefetch" href="/assets/js/760.7d144b3e.js"><link rel="prefetch" href="/assets/js/761.36411342.js"><link rel="prefetch" href="/assets/js/762.847c222e.js"><link rel="prefetch" href="/assets/js/763.1f4e2e04.js"><link rel="prefetch" href="/assets/js/764.68231a60.js"><link rel="prefetch" href="/assets/js/765.45e55e64.js"><link rel="prefetch" href="/assets/js/766.fd7cde06.js"><link rel="prefetch" href="/assets/js/767.77ff4812.js"><link rel="prefetch" href="/assets/js/768.7eb89d36.js"><link rel="prefetch" href="/assets/js/769.1700dd5d.js"><link rel="prefetch" href="/assets/js/77.e8e6f525.js"><link rel="prefetch" href="/assets/js/770.2b89f55a.js"><link rel="prefetch" href="/assets/js/771.7bbef31f.js"><link rel="prefetch" href="/assets/js/772.4047d445.js"><link rel="prefetch" href="/assets/js/773.fb6b438f.js"><link rel="prefetch" href="/assets/js/774.3e2b407e.js"><link rel="prefetch" href="/assets/js/775.bbdf2988.js"><link rel="prefetch" href="/assets/js/776.be59696f.js"><link rel="prefetch" href="/assets/js/777.6ebf44b2.js"><link rel="prefetch" href="/assets/js/778.356023f1.js"><link rel="prefetch" href="/assets/js/779.c778b558.js"><link rel="prefetch" href="/assets/js/78.0bc36e74.js"><link rel="prefetch" href="/assets/js/780.d20347ae.js"><link rel="prefetch" href="/assets/js/781.4add5072.js"><link rel="prefetch" href="/assets/js/782.f8032d21.js"><link rel="prefetch" href="/assets/js/783.ccbac8b2.js"><link rel="prefetch" href="/assets/js/784.8ce2f757.js"><link rel="prefetch" href="/assets/js/785.5f3b962f.js"><link rel="prefetch" href="/assets/js/786.99425c8d.js"><link rel="prefetch" href="/assets/js/787.ec0e5057.js"><link rel="prefetch" href="/assets/js/788.7bd969be.js"><link rel="prefetch" href="/assets/js/789.458ed031.js"><link rel="prefetch" href="/assets/js/79.e72b6857.js"><link rel="prefetch" href="/assets/js/790.04d0bfc9.js"><link rel="prefetch" href="/assets/js/791.b1e0437f.js"><link rel="prefetch" href="/assets/js/792.12974c5d.js"><link rel="prefetch" href="/assets/js/793.1d970942.js"><link rel="prefetch" href="/assets/js/794.82023709.js"><link rel="prefetch" href="/assets/js/795.1d09f283.js"><link rel="prefetch" href="/assets/js/796.c3985609.js"><link rel="prefetch" href="/assets/js/797.c8070e36.js"><link rel="prefetch" href="/assets/js/798.dad7f23b.js"><link rel="prefetch" href="/assets/js/799.2d8672c9.js"><link rel="prefetch" href="/assets/js/8.a3ac78ab.js"><link rel="prefetch" href="/assets/js/80.a41803be.js"><link rel="prefetch" href="/assets/js/800.3b457f78.js"><link rel="prefetch" href="/assets/js/801.eecfd6f3.js"><link rel="prefetch" href="/assets/js/802.3b53874d.js"><link rel="prefetch" href="/assets/js/803.f545cd0b.js"><link rel="prefetch" href="/assets/js/804.b28fdd9a.js"><link rel="prefetch" href="/assets/js/805.52f7ed7a.js"><link rel="prefetch" href="/assets/js/806.ff06361a.js"><link rel="prefetch" href="/assets/js/807.8433573d.js"><link rel="prefetch" href="/assets/js/808.e6ef28fc.js"><link rel="prefetch" href="/assets/js/809.47f0e57e.js"><link rel="prefetch" href="/assets/js/81.44639404.js"><link rel="prefetch" href="/assets/js/810.8a7511d9.js"><link rel="prefetch" href="/assets/js/811.b6dbbe7f.js"><link rel="prefetch" href="/assets/js/812.a9583fe2.js"><link rel="prefetch" href="/assets/js/813.bc0cd26e.js"><link rel="prefetch" href="/assets/js/814.33ac9c50.js"><link rel="prefetch" href="/assets/js/815.a6463e71.js"><link rel="prefetch" href="/assets/js/816.6663f784.js"><link rel="prefetch" href="/assets/js/817.59400904.js"><link rel="prefetch" href="/assets/js/818.5d1bb6a3.js"><link rel="prefetch" href="/assets/js/819.f9e9a9fb.js"><link rel="prefetch" href="/assets/js/82.de63481d.js"><link rel="prefetch" href="/assets/js/820.92038ed5.js"><link rel="prefetch" href="/assets/js/821.66b734d4.js"><link rel="prefetch" href="/assets/js/822.14777207.js"><link rel="prefetch" href="/assets/js/823.676450ef.js"><link rel="prefetch" href="/assets/js/824.25604d56.js"><link rel="prefetch" href="/assets/js/825.f9123a97.js"><link rel="prefetch" href="/assets/js/826.b47a43b3.js"><link rel="prefetch" href="/assets/js/827.fdfc3d9d.js"><link rel="prefetch" href="/assets/js/828.456d0869.js"><link rel="prefetch" href="/assets/js/829.41555dbf.js"><link rel="prefetch" href="/assets/js/83.8459add4.js"><link rel="prefetch" href="/assets/js/830.f4f31385.js"><link rel="prefetch" href="/assets/js/831.4d6f3d59.js"><link rel="prefetch" href="/assets/js/832.dc5e7d27.js"><link rel="prefetch" href="/assets/js/833.968d3dbf.js"><link rel="prefetch" href="/assets/js/834.e0bff90b.js"><link rel="prefetch" href="/assets/js/835.3118846f.js"><link rel="prefetch" href="/assets/js/836.52ad109f.js"><link rel="prefetch" href="/assets/js/837.be748885.js"><link rel="prefetch" href="/assets/js/838.2912d973.js"><link rel="prefetch" href="/assets/js/839.6ab9ac36.js"><link rel="prefetch" href="/assets/js/84.4d853061.js"><link rel="prefetch" href="/assets/js/840.cd05c664.js"><link rel="prefetch" href="/assets/js/841.76efc9ed.js"><link rel="prefetch" href="/assets/js/842.f9c757fd.js"><link rel="prefetch" href="/assets/js/843.4465b1aa.js"><link rel="prefetch" href="/assets/js/844.1cb5a092.js"><link rel="prefetch" href="/assets/js/845.4b5f87d5.js"><link rel="prefetch" href="/assets/js/846.d33d93b8.js"><link rel="prefetch" href="/assets/js/847.ad0f35bc.js"><link rel="prefetch" href="/assets/js/848.693ccffa.js"><link rel="prefetch" href="/assets/js/849.67b0c679.js"><link rel="prefetch" href="/assets/js/85.e9cfd5ac.js"><link rel="prefetch" href="/assets/js/850.26d69b26.js"><link rel="prefetch" href="/assets/js/851.69d3d831.js"><link rel="prefetch" href="/assets/js/852.dd84ae6f.js"><link rel="prefetch" href="/assets/js/853.3ba0a0b1.js"><link rel="prefetch" href="/assets/js/854.de212530.js"><link rel="prefetch" href="/assets/js/855.83ff4916.js"><link rel="prefetch" href="/assets/js/856.dc8a25ea.js"><link rel="prefetch" href="/assets/js/857.a78b5812.js"><link rel="prefetch" href="/assets/js/858.502266d3.js"><link rel="prefetch" href="/assets/js/859.070ca65b.js"><link rel="prefetch" href="/assets/js/86.8b3cb79a.js"><link rel="prefetch" href="/assets/js/860.7f1a3c03.js"><link rel="prefetch" href="/assets/js/861.fb579f06.js"><link rel="prefetch" href="/assets/js/862.99e29735.js"><link rel="prefetch" href="/assets/js/863.79c018e0.js"><link rel="prefetch" href="/assets/js/864.94413774.js"><link rel="prefetch" href="/assets/js/865.0f28212d.js"><link rel="prefetch" href="/assets/js/866.98379ca9.js"><link rel="prefetch" href="/assets/js/867.679fc73b.js"><link rel="prefetch" href="/assets/js/868.9c211922.js"><link rel="prefetch" href="/assets/js/869.1fdba2b8.js"><link rel="prefetch" href="/assets/js/87.9a53555c.js"><link rel="prefetch" href="/assets/js/870.3150eb0e.js"><link rel="prefetch" href="/assets/js/871.7ac1f282.js"><link rel="prefetch" href="/assets/js/872.2dde878e.js"><link rel="prefetch" href="/assets/js/873.2ce8a1ee.js"><link rel="prefetch" href="/assets/js/874.f59697c1.js"><link rel="prefetch" href="/assets/js/875.1df755aa.js"><link rel="prefetch" href="/assets/js/876.c84f6ed0.js"><link rel="prefetch" href="/assets/js/877.5085f1ca.js"><link rel="prefetch" href="/assets/js/878.5e3bb3f2.js"><link rel="prefetch" href="/assets/js/879.62fd8ff7.js"><link rel="prefetch" href="/assets/js/88.8ded9630.js"><link rel="prefetch" href="/assets/js/880.ed04c0c9.js"><link rel="prefetch" href="/assets/js/881.ebd7c4f3.js"><link rel="prefetch" href="/assets/js/882.00f68bab.js"><link rel="prefetch" href="/assets/js/883.ce0055e2.js"><link rel="prefetch" href="/assets/js/884.3f476b68.js"><link rel="prefetch" href="/assets/js/885.f2e65abb.js"><link rel="prefetch" href="/assets/js/886.1506c7bf.js"><link rel="prefetch" href="/assets/js/887.68f41f94.js"><link rel="prefetch" href="/assets/js/888.10c87773.js"><link rel="prefetch" href="/assets/js/89.e9c2db39.js"><link rel="prefetch" href="/assets/js/9.3ebc642b.js"><link rel="prefetch" href="/assets/js/90.30976838.js"><link rel="prefetch" href="/assets/js/91.735dbf08.js"><link rel="prefetch" href="/assets/js/92.3e2ffb1a.js"><link rel="prefetch" href="/assets/js/93.60def4d1.js"><link rel="prefetch" href="/assets/js/94.93cee11a.js"><link rel="prefetch" href="/assets/js/95.56915d3f.js"><link rel="prefetch" href="/assets/js/96.6c16e408.js"><link rel="prefetch" href="/assets/js/97.6c2a65b1.js"><link rel="prefetch" href="/assets/js/98.9fcc705b.js"><link rel="prefetch" href="/assets/js/99.0e16b32f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.be581667.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="学习巴" class="logo"> <span class="site-name can-hide">学习巴</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础资料</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5a9535/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/pages/09d63b/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/916929/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Vue教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/115158caa9e96df0/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/pages/83a1ab785e7fd70c/" class="nav-link">组件</a></li><li class="dropdown-subitem"><a href="/pages/185a96b593a97078/" class="nav-link">过渡&amp;动画</a></li><li class="dropdown-subitem"><a href="/pages/bd36a3c1bc3e0821/" class="nav-link">可复用性&amp;组合</a></li><li class="dropdown-subitem"><a href="/pages/d00311f8174119b2/" class="nav-link">工具</a></li><li class="dropdown-subitem"><a href="/pages/d9d62d6ab8ff99a6/" class="nav-link">规模化</a></li><li class="dropdown-subitem"><a href="/pages/b30620/" class="nav-link">Vuex</a></li><li class="dropdown-subitem"><a href="/pages/fb08e252dfd8fdfd/" class="nav-link">其它</a></li></ul></li><li class="dropdown-item"><h4>React教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f6abc/" class="nav-link">核心概念</a></li><li class="dropdown-subitem"><a href="/pages/5c13b9/" class="nav-link">Hook</a></li><li class="dropdown-subitem"><a href="/pages/87156f/" class="nav-link">案例演示</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/38a70e/" class="nav-link">JavaScript教程</a></li><li class="dropdown-item"><!----> <a href="/pages/e05dce83e5129785/" class="nav-link">TypeScript 从零实现 axios</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/69d2f8/" class="nav-link">JavaSE</a></li><li class="dropdown-item"><!----> <a href="/pages/ca58e7/" class="nav-link">JavaEE</a></li><li class="dropdown-item"><!----> <a href="/pages/a1a3d3/" class="nav-link">Spring&amp;SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/012588/" class="nav-link">DataBase</a></li><li class="dropdown-item"><!----> <a href="/pages/3cbcff/" class="nav-link">Java中间件</a></li><li class="dropdown-item"><!----> <a href="/pages/dab057/" class="nav-link">JavaDevApp</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6820/" class="nav-link">Java工具</a></li><li class="dropdown-item"><!----> <a href="/pages/3cce56/" class="nav-link">CentOS</a></li><li class="dropdown-item"><!----> <a href="/pages/5d583a/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/552a2f/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b8f905/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="测试" class="dropdown-title"><a href="/testing/" class="link-title">测试</a> <span class="title" style="display:none;">测试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8ce1c/" class="nav-link">测试流程规范</a></li><li class="dropdown-item"><!----> <a href="/pages/eec3de/" class="nav-link">自动化测试</a></li><li class="dropdown-item"><!----> <a href="/pages/e07672/" class="nav-link">测试环境搭建</a></li><li class="dropdown-item"><h4>性能测试</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/48598c/" class="nav-link">Jmeter基础篇</a></li><li class="dropdown-subitem"><a href="/pages/21705d/" class="nav-link">Jmeter高级篇</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/971225/" class="nav-link">Fiddler</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ad9b6a/" class="nav-link">大数据综合</a></li><li class="dropdown-item"><!----> <a href="/pages/680e30/" class="nav-link">hadoop</a></li><li class="dropdown-item"><!----> <a href="/pages/a958fe/" class="nav-link">hive</a></li><li class="dropdown-item"><!----> <a href="/pages/417be6/" class="nav-link">hbase</a></li><li class="dropdown-item"><!----> <a href="/pages/1b41b6/" class="nav-link">zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/5c85bd/" class="nav-link">flink</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构和算法" class="dropdown-title"><a href="/arithmetic/" class="link-title">数据结构和算法</a> <span class="title" style="display:none;">数据结构和算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/92e4c1/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/5a9bff/" class="nav-link">线性表</a></li><li class="dropdown-item"><!----> <a href="/pages/8b1bd0/" class="nav-link">综合</a></li><li class="dropdown-item"><!----> <a href="/pages/39a1b7/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><a href="/other/" class="link-title">其它</a> <span class="title" style="display:none;">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a5f73af5185fdf0a/" class="nav-link">各种工具教程</a></li><li class="dropdown-item"><!----> <a href="/pages/8292d8/" class="nav-link">Git学习</a></li><li class="dropdown-item"><!----> <a href="/pages/51afd6/" class="nav-link">前端学习笔记</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kamalyes/kamalyes.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://avatars.githubusercontent.com/u/40486003?v=4"> <div class="blogger-info"><h3>kamalyes</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础资料</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5a9535/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/pages/09d63b/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/916929/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Vue教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/115158caa9e96df0/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/pages/83a1ab785e7fd70c/" class="nav-link">组件</a></li><li class="dropdown-subitem"><a href="/pages/185a96b593a97078/" class="nav-link">过渡&amp;动画</a></li><li class="dropdown-subitem"><a href="/pages/bd36a3c1bc3e0821/" class="nav-link">可复用性&amp;组合</a></li><li class="dropdown-subitem"><a href="/pages/d00311f8174119b2/" class="nav-link">工具</a></li><li class="dropdown-subitem"><a href="/pages/d9d62d6ab8ff99a6/" class="nav-link">规模化</a></li><li class="dropdown-subitem"><a href="/pages/b30620/" class="nav-link">Vuex</a></li><li class="dropdown-subitem"><a href="/pages/fb08e252dfd8fdfd/" class="nav-link">其它</a></li></ul></li><li class="dropdown-item"><h4>React教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9f6abc/" class="nav-link">核心概念</a></li><li class="dropdown-subitem"><a href="/pages/5c13b9/" class="nav-link">Hook</a></li><li class="dropdown-subitem"><a href="/pages/87156f/" class="nav-link">案例演示</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/38a70e/" class="nav-link">JavaScript教程</a></li><li class="dropdown-item"><!----> <a href="/pages/e05dce83e5129785/" class="nav-link">TypeScript 从零实现 axios</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/69d2f8/" class="nav-link">JavaSE</a></li><li class="dropdown-item"><!----> <a href="/pages/ca58e7/" class="nav-link">JavaEE</a></li><li class="dropdown-item"><!----> <a href="/pages/a1a3d3/" class="nav-link">Spring&amp;SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/012588/" class="nav-link">DataBase</a></li><li class="dropdown-item"><!----> <a href="/pages/3cbcff/" class="nav-link">Java中间件</a></li><li class="dropdown-item"><!----> <a href="/pages/dab057/" class="nav-link">JavaDevApp</a></li><li class="dropdown-item"><!----> <a href="/pages/4b6820/" class="nav-link">Java工具</a></li><li class="dropdown-item"><!----> <a href="/pages/3cce56/" class="nav-link">CentOS</a></li><li class="dropdown-item"><!----> <a href="/pages/5d583a/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/552a2f/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/b8f905/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="测试" class="dropdown-title"><a href="/testing/" class="link-title">测试</a> <span class="title" style="display:none;">测试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d8ce1c/" class="nav-link">测试流程规范</a></li><li class="dropdown-item"><!----> <a href="/pages/eec3de/" class="nav-link">自动化测试</a></li><li class="dropdown-item"><!----> <a href="/pages/e07672/" class="nav-link">测试环境搭建</a></li><li class="dropdown-item"><h4>性能测试</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/48598c/" class="nav-link">Jmeter基础篇</a></li><li class="dropdown-subitem"><a href="/pages/21705d/" class="nav-link">Jmeter高级篇</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/971225/" class="nav-link">Fiddler</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ad9b6a/" class="nav-link">大数据综合</a></li><li class="dropdown-item"><!----> <a href="/pages/680e30/" class="nav-link">hadoop</a></li><li class="dropdown-item"><!----> <a href="/pages/a958fe/" class="nav-link">hive</a></li><li class="dropdown-item"><!----> <a href="/pages/417be6/" class="nav-link">hbase</a></li><li class="dropdown-item"><!----> <a href="/pages/1b41b6/" class="nav-link">zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/5c85bd/" class="nav-link">flink</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构和算法" class="dropdown-title"><a href="/arithmetic/" class="link-title">数据结构和算法</a> <span class="title" style="display:none;">数据结构和算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/92e4c1/" class="nav-link">树</a></li><li class="dropdown-item"><!----> <a href="/pages/5a9bff/" class="nav-link">线性表</a></li><li class="dropdown-item"><!----> <a href="/pages/8b1bd0/" class="nav-link">综合</a></li><li class="dropdown-item"><!----> <a href="/pages/39a1b7/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><a href="/other/" class="link-title">其它</a> <span class="title" style="display:none;">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a5f73af5185fdf0a/" class="nav-link">各种工具教程</a></li><li class="dropdown-item"><!----> <a href="/pages/8292d8/" class="nav-link">Git学习</a></li><li class="dropdown-item"><!----> <a href="/pages/51afd6/" class="nav-link">前端学习笔记</a></li><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kamalyes/kamalyes.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaSE</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>基础特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>高级特性</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d90740/" class="sidebar-link">Java正则</a></li><li><a href="/pages/4a23df/" class="sidebar-link">Java编码和加密</a></li><li><a href="/pages/71379b/" class="sidebar-link">Java国际化</a></li><li><a href="/pages/f756bd/" class="sidebar-link">JDK8</a></li><li><a href="/pages/496a7e/" aria-current="page" class="active sidebar-link">源码级深度理解 Java SPI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#spi-简介" class="sidebar-link">SPI 简介</a></li><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#spi-示例" class="sidebar-link">SPI 示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-接口" class="sidebar-link">SPI 接口</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-实现类" class="sidebar-link">SPI 实现类</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-配置" class="sidebar-link">SPI 配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#serviceloader" class="sidebar-link">ServiceLoader</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#spi-原理" class="sidebar-link">SPI 原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#serviceloader-的成员变量" class="sidebar-link">ServiceLoader 的成员变量</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#serviceloader-的工作流程" class="sidebar-link">ServiceLoader 的工作流程</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-和类加载器" class="sidebar-link">SPI 和类加载器</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#java-spi-的不足" class="sidebar-link">Java SPI 的不足</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#spi-应用场景" class="sidebar-link">SPI 应用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-应用案例之-jdbc-drivermanager" class="sidebar-link">SPI 应用案例之 JDBC DriverManager</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#创建数据库连接" class="sidebar-link">创建数据库连接</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#drivermanager" class="sidebar-link">DriverManager</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-应用案例之-common-logging" class="sidebar-link">SPI 应用案例之 Common-Logging</a></li><li class="sidebar-sub-header level3"><a href="/pages/496a7e/#spi-应用案例之-spring-boot" class="sidebar-link">SPI 应用案例之 Spring Boot</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#springbootapplication-注解" class="sidebar-link">@SpringBootApplication 注解</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#springbootconfiguration-注解" class="sidebar-link">@SpringBootConfiguration 注解</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#enableautoconfiguration-注解" class="sidebar-link">@EnableAutoConfiguration 注解</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#autoconfigurationpackage-注解" class="sidebar-link">@AutoConfigurationPackage 注解</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#springfactoriesloader-loadfactorynames-方法" class="sidebar-link">SpringFactoriesLoader.loadFactoryNames 方法</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#spring-boot-的-autoconfiguration-类" class="sidebar-link">Spring Boot 的 AutoConfiguration 类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#spi-应用案例之-dubbo" class="sidebar-link">SPI 应用案例之 Dubbo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#extensionloader-入口" class="sidebar-link">ExtensionLoader 入口</a></li><li class="sidebar-sub-header level4"><a href="/pages/496a7e/#获取所有的拓展类" class="sidebar-link">获取所有的拓展类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/496a7e/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/pages/d71f2c/" class="sidebar-link">Java 编程规范</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/pages/5f886e/" class="sidebar-link">Java 面试总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaEE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Centos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/backend/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/backend/#JavaSE" data-v-06225672>JavaSE</a></li><li data-v-06225672><a href="/backend/#高级特性" data-v-06225672>高级特性</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/kamalyes" target="_blank" title="作者" class="beLink" data-v-06225672>kamalyes</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">源码级深度理解 Java SPI<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="源码级深度理解-java-spi"><a href="#源码级深度理解-java-spi" class="header-anchor">#</a> 源码级深度理解 Java SPI</h1> <h2 id="spi-简介"><a href="#spi-简介" class="header-anchor">#</a> SPI 简介</h2> <p>SPI 全称 Service Provider Interface，是 Java 提供的，旨在由第三方实现或扩展的 API，它是一种用于动态加载服务的机制。Java 中 SPI 机制主要思想是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要，其核心思想就是 <strong>解耦</strong>。</p> <p>Java SPI 有四个要素：</p> <ul><li><strong>SPI 接口</strong>：为服务提供者实现类约定的的接口或抽象类。</li> <li><strong>SPI 实现类</strong>：实际提供服务的实现类。</li> <li><strong>SPI 配置</strong>：Java SPI 机制约定的配置文件，提供查找服务实现类的逻辑。配置文件必须置于 <code>META-INF/services</code> 目录中，并且，文件名应与服务提供者接口的完全限定名保持一致。文件中的每一行都有一个实现服务类的详细信息，同样是服务提供者类的完全限定名称。</li> <li><strong><code>ServiceLoader</code></strong>：Java SPI 的核心类，用于加载 SPI 实现类。 <code>ServiceLoader</code> 中有各种实用方法来获取特定实现、迭代它们或重新加载服务。</li></ul> <h2 id="spi-示例"><a href="#spi-示例" class="header-anchor">#</a> SPI 示例</h2> <p>正所谓，实践出真知，我们不妨通过一个具体的示例来看一下，如何使用 Java SPI。</p> <h3 id="spi-接口"><a href="#spi-接口" class="header-anchor">#</a> SPI 接口</h3> <p>首先，需要定义一个 SPI 接口，和普通接口并没有什么差别。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kamalyes<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>spi</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataStorage</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="spi-实现类"><a href="#spi-实现类" class="header-anchor">#</a> SPI 实现类</h3> <p>假设，我们需要在程序中使用两种不同的数据存储——Mysql 和 Redis。因此，我们需要两个不同的实现类去分别完成相应工作。</p> <p>Mysql 查询 MOCK 类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kamalyes<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>spi</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MysqlStorage</span> <span class="token keyword">implements</span> <span class="token class-name">DataStorage</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;【Mysql】搜索&quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;，结果：No&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Redis 查询 MOCK 类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>kamalyes<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>spi</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisStorage</span> <span class="token keyword">implements</span> <span class="token class-name">DataStorage</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;【Redis】搜索&quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;，结果：Yes&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>到目前为止，定义接口，并实现接口和普通的 Java 接口实现没有任何不同。</p> <h3 id="spi-配置"><a href="#spi-配置" class="header-anchor">#</a> SPI 配置</h3> <p>如果想通过 Java SPI 机制来发现服务，就需要在 SPI 配置中约定好发现服务的逻辑。配置文件必须置于 <code>META-INF/services</code> 目录中，并且，文件名应与服务提供者接口的完全限定名保持一致。文件中的每一行都有一个实现服务类的详细信息，同样是服务提供者类的完全限定名称。以本示例代码为例，其文件名应该为 <code>io.github.kamalyes.javacore.spi.DataStorage</code>，文件中的内容如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>io.github.kamalyes.javacore.spi.MysqlStorage
io.github.kamalyes.javacore.spi.RedisStorage
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="serviceloader"><a href="#serviceloader" class="header-anchor">#</a> ServiceLoader</h3> <p>完成了上面的步骤，就可以通过 <code>ServiceLoader</code> 来加载服务。示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ServiceLoader</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpiDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DataStorage</span><span class="token punctuation">&gt;</span></span> serviceLoader <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">DataStorage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============ Java SPI 测试============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serviceLoader<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>loader <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">&quot;Yes Or No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>============ Java SPI 测试============
【Mysql】搜索Yes Or No，结果：No
【Redis】搜索Yes Or No，结果：Yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="spi-原理"><a href="#spi-原理" class="header-anchor">#</a> SPI 原理</h2> <p>上文中，我们已经了解 Java SPI 的要素以及使用 Java SPI 的方法。你有没有想过，Java SPI 和普通 Java 接口有何不同，Java SPI 是如何工作的。实际上，Java SPI 机制依赖于 <code>ServiceLoader</code> 类去解析、加载服务。因此，掌握了 <code>ServiceLoader</code> 的工作流程，就掌握了 SPI 的原理。<code>ServiceLoader</code> 的代码本身很精练，接下来，让我们通过走读源码的方式，逐一理解 <code>ServiceLoader</code> 的工作流程。</p> <h3 id="serviceloader-的成员变量"><a href="#serviceloader-的成员变量" class="header-anchor">#</a> ServiceLoader 的成员变量</h3> <p>先看一下 <code>ServiceLoader</code> 类的成员变量，大致有个印象，后面的源码中都会使用到。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// SPI 配置文件目录</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;META-INF/services/&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 将要被加载的 SPI 服务</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">;</span>

    <span class="token comment">// 用于加载 SPI 服务的类加载器</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> loader<span class="token punctuation">;</span>

    <span class="token comment">// ServiceLoader 创建时的访问控制上下文</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AccessControlContext</span> acc<span class="token punctuation">;</span>

    <span class="token comment">// SPI 服务缓存，按实例化的顺序排列</span>
    <span class="token keyword">private</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> providers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 懒查询迭代器</span>
    <span class="token keyword">private</span> <span class="token class-name">LazyIterator</span> lookupIterator<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="serviceloader-的工作流程"><a href="#serviceloader-的工作流程" class="header-anchor">#</a> ServiceLoader 的工作流程</h3> <p>（1）<code>ServiceLoader.load</code> 静态方法</p> <p>应用程序加载 Java SPI 服务，都是先调用 <code>ServiceLoader.load</code> 静态方法。<code>ServiceLoader.load</code> 静态方法的作用是：</p> <ol><li>指定类加载 <code>ClassLoader</code> 和访问控制上下文；</li> <li>然后，重新加载 SPI 服务
<ol><li>清空缓存中所有已实例化的 SPI 服务</li> <li>根据 <code>ClassLoader</code> 和 SPI 类型，创建懒加载迭代器</li></ol></li></ol> <p>这里，摘录 <code>ServiceLoader.load</code> 相关源码，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// service 传入的是期望加载的 SPI 接口类型</span>
<span class="token comment">// loader 是用于加载 SPI 服务的类加载器</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">,</span>
										<span class="token class-name">ClassLoader</span> loader<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清空缓存中所有已实例化的 SPI 服务</span>
	providers<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 根据 ClassLoader 和 SPI 类型，创建懒加载迭代器</span>
	lookupIterator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyIterator</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 私有构造方法</span>
<span class="token comment">// 重新加载 SPI 服务</span>
<span class="token keyword">private</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> svc<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> cl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	service <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>svc<span class="token punctuation">,</span> <span class="token string">&quot;Service interface cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定类加载 ClassLoader 和访问控制上下文</span>
	loader <span class="token operator">=</span> <span class="token punctuation">(</span>cl <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> cl<span class="token punctuation">;</span>
	acc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 然后，重新加载 SPI 服务</span>
	<span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>（2）应用程序通过 <code>ServiceLoader</code> 的 <code>iterator</code> 方法遍历 SPI 实例</p> <p><code>ServiceLoader</code> 的类定义，明确了 <code>ServiceLoader</code> 类实现了 <code>Iterable&lt;T&gt;</code> 接口，所以，它是可以迭代遍历的。实际上，<code>ServiceLoader</code> 类维护了一个缓存 providers（ <code>LinkedHashMap</code> 对象），缓存 providers 中保存了已经被成功加载的 SPI 实例，这个 Map 的 key 是 SPI 接口实现类的全限定名，value 是该实现类的一个实例对象。</p> <p>当应用程序调用 <code>ServiceLoader</code> 的 <code>iterator</code> 方法时，<code>ServiceLoader</code> 会先判断缓存 providers 中是否有数据：如果有，则直接返回缓存 providers 的迭代器；如果没有，则返回懒加载迭代器的迭代器。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 缓存 SPI providers</span>
		<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> knownProviders
			<span class="token operator">=</span> providers<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// lookupIterator 是 LazyIterator 实例，用于懒加载 SPI 实例</span>
		<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>knownProviders<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> lookupIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">S</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>knownProviders<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> knownProviders<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> lookupIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>（3）懒加载迭代器的工作流程</p> <p>上面的源码中提到了，lookupIterator 是 <code>LazyIterator</code> 实例，而 <code>LazyIterator</code> 用于懒加载 SPI 实例。那么， <code>LazyIterator</code> 是如何工作的呢？</p> <p>这里，摘取 <code>LazyIterator</code> 关键代码</p> <ul><li><code>hasNextService</code> 方法：
<ol><li>拼接 <code>META-INF/services/</code> + SPI 接口全限定名</li> <li>通过类加载器，尝试加载资源文件</li> <li>解析资源文件中的内容，获取 SPI 接口的实现类的全限定名 <code>nextName</code></li></ol></li> <li><code>nextService</code> 方法：
<ol><li><code>hasNextService()</code> 方法解析出了 SPI 实现类的的全限定名 <code>nextName</code>，通过反射，获取 SPI 实现类的类定义 <code>Class&lt;?&gt;</code>。</li> <li>然后，尝试通过 <code>Class&lt;?&gt;</code> 的 <code>newInstance</code> 方法实例化一个 SPI 服务对象。如果成功，则将这个对象加入到缓存 providers 中并返回该对象。</li></ol></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>nextName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>configs <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1.拼接 META-INF/services/ + SPI 接口全限定名</span>
            <span class="token comment">// 2.通过类加载器，尝试加载资源文件</span>
            <span class="token comment">// 3.解析资源文件中的内容</span>
			<span class="token class-name">String</span> fullName <span class="token operator">=</span> <span class="token constant">PREFIX</span> <span class="token operator">+</span> service<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>loader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
				configs <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				configs <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> <span class="token string">&quot;Error locating configuration files&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pending <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>pending<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>configs<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		pending <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> configs<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	nextName <span class="token operator">=</span> pending<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">S</span> <span class="token function">nextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> cn <span class="token operator">=</span> nextName<span class="token punctuation">;</span>
	nextName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
			 <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn <span class="token operator">+</span> <span class="token string">&quot; not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>service<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
			 <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn  <span class="token operator">+</span> <span class="token string">&quot; not a s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">S</span> p <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		providers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cn<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> p<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
			 <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn <span class="token operator">+</span> <span class="token string">&quot; could not be instantiated&quot;</span><span class="token punctuation">,</span>
			 x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// This cannot happen</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="spi-和类加载器"><a href="#spi-和类加载器" class="header-anchor">#</a> SPI 和类加载器</h3> <p>通过上面两个章节中，走读 <code>ServiceLoader</code> 代码，我们已经大致了解 Java SPI 的工作原理，即通过 <code>ClassLoader</code> 加载 SPI 配置文件，解析 SPI 服务，然后通过反射，实例化 SPI 服务实例。我们不妨思考一下，为什么加载 SPI 服务时，需要指定类加载器 <code>ClassLoader</code> 呢？</p> <p>学习过 JVM 的读者，想必都了解过类加载器的<strong>双亲委派模型（Parents Delegation Model）</strong>。双亲委派模型要求除了顶层的 <strong><code>BootstrapClassLoader</code></strong> 外，其余的类加载器都应有自己的父类加载器。这里类加载器之间的父子关系一般通过组合（Composition）关系来实现，而不是通过继承（Inheritance）的关系实现。双亲委派继承体系图如下：</p> <img src="https://www.yuyanqing.cn/oss/image-bed/col/java/javacore/jvm/jmm-%E7%B1%BB%E5%8A%A0%E8%BD%BD-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE.png" alt="img" style="zoom:50%;"> <p>双亲委派机制约定了：<strong>一个类加载器首先将类加载请求传送到父类加载器，只有当父类加载器无法完成类加载请求时才尝试加载</strong>。</p> <p><strong>双亲委派的好处</strong>：使得 Java 类伴随着它的类加载器，天然具备一种带有优先级的层次关系，从而使得类加载得到统一，不会出现重复加载的问题：</p> <ul><li>系统类防止内存中出现多份同样的字节码</li> <li>保证 Java 程序安全稳定运行</li></ul> <p>例如： <code>java.lang.Object</code> 存放在 <code>rt.jar</code> 中，如果编写另外一个 <code>java.lang.Object</code> 的类并放到 <code>classpath</code> 中，程序可以编译通过。因为双亲委派模型的存在，所以在 rt.jar 中的 <code>Object</code> 比在 <code>classpath</code> 中的 <code>Object</code> 优先级更高，因为 rt.jar 中的 <code>Object</code> 使用的是启动类加载器，而 <code>classpath</code> 中的 <code>Object</code> 使用的是应用程序类加载器。正因为 rt.jar 中的 <code>Object</code> 优先级更高，因为程序中所有的 <code>Object</code> 都是这个 <code>Object</code>。</p> <p><strong>双亲委派的限制</strong>：子类加载器可以使用父类加载器已经加载的类，而父类加载器无法使用子类加载器已经加载的。——这就导致了双亲委派模型并不能解决所有的类加载器问题。Java SPI 就面临着这样的问题：</p> <ul><li>SPI 的接口是 Java 核心库的一部分，是由 <code>BootstrapClassLoader</code> 加载的；</li> <li>而 SPI 实现的 Java 类一般是由 <code>AppClassLoader</code> 来加载的。<code>BootstrapClassLoader</code> 是无法找到 SPI 的实现类的，因为它只加载 Java 的核心库。它也不能代理给 <code>AppClassLoader</code>，因为它是最顶层的类加载器。这也解释了本节开始的问题——为什么加载 SPI 服务时，需要指定类加载器 <code>ClassLoader</code> 呢？因为如果不指定 <code>ClassLoader</code>，则无法获取 SPI 服务。</li></ul> <p>如果不做任何的设置，Java 应用的线程的上下文类加载器默认就是 <code>AppClassLoader</code>。在核心类库使用 SPI 接口时，传递的类加载器使用线程上下文类加载器，就可以成功的加载到 SPI 实现的类。线程上下文类加载器在很多 SPI 的实现中都会用到。</p> <p>通常可以通过 <code>Thread.currentThread().getClassLoader()</code> 和 <code>Thread.currentThread().getContextClassLoader()</code> 获取线程上下文类加载器。</p> <h3 id="java-spi-的不足"><a href="#java-spi-的不足" class="header-anchor">#</a> Java SPI 的不足</h3> <p>Java SPI 存在一些不足：</p> <ul><li><p>不能按需加载，需要遍历所有的实现，并实例化，然后在循环中才能找到我们需要的实现。如果不想用某些实现类，或者某些类实例化很耗时，它也被载入并实例化了，这就造成了浪费。</p></li> <li><p>获取某个实现类的方式不够灵活，只能通过 Iterator 形式获取，不能根据某个参数来获取对应的实现类。</p></li> <li><p>多个并发多线程使用 ServiceLoader 类的实例是不安全的。</p></li></ul> <h2 id="spi-应用场景"><a href="#spi-应用场景" class="header-anchor">#</a> SPI 应用场景</h2> <p>SPI 在 Java 开发中应用十分广泛。首先，在 Java 的 <code>java.util.spi</code> package 中就约定了很多 SPI 接口。下面，列举一些 SPI 接口：</p> <ul><li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/spi/TimeZoneNameProvider.html" target="_blank" rel="noopener noreferrer"><em>TimeZoneNameProvider:</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 为 TimeZone 类提供本地化的时区名称。</li> <li><em><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/text/spi/DateFormatProvider.html" target="_blank" rel="noopener noreferrer">DateFormatProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</em> 为指定的语言环境提供日期和时间格式。</li> <li><em><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/text/spi/NumberFormatProvider.html" target="_blank" rel="noopener noreferrer">NumberFormatProvider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</em> 为 NumberFormat 类提供货币、整数和百分比值。</li> <li><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Driver.html" target="_blank" rel="noopener noreferrer"><em>Driver:</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 从 4.0 版开始，JDBC API 支持 SPI 模式。旧版本使用 Class.forName() 方法加载驱动程序。</li> <li><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/spi/PersistenceProvider.html" target="_blank" rel="noopener noreferrer"><em>PersistenceProvider:</em><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供 JPA API 的实现。</li> <li>等等</li></ul> <p>除此以外，SPI 还有很多应用，下面列举几个经典案例。</p> <h3 id="spi-应用案例之-jdbc-drivermanager"><a href="#spi-应用案例之-jdbc-drivermanager" class="header-anchor">#</a> SPI 应用案例之 JDBC DriverManager</h3> <p>作为 Java 工程师，尤其是 CRUD 工程师，相必都非常熟悉 JDBC。众所周知，关系型数据库有很多种，如：Mysql、Oracle、PostgreSQL 等等。JDBC 如何识别各种数据库的驱动呢？</p> <h4 id="创建数据库连接"><a href="#创建数据库连接" class="header-anchor">#</a> 创建数据库连接</h4> <p>我们先回顾一下，JDBC 如何创建数据库连接的呢？</p> <p>在 <strong>JDBC4.0 之前</strong>，连接数据库的时候，通常会用 <strong><code>Class.forName(XXX)</code></strong> 方法来加载数据库相应的驱动，然后再获取数据库连接，继而进行 CRUD 等操作。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而 J<strong>DBC4.0 之后</strong>，不再需要用 <strong><code>Class.forName(XXX)</code></strong> 方法来加载数据库驱动，直接获取连接就可以了。显然，这种方式很方便，但是如何做到的呢？</p> <ul><li><p>JDBC 接口：首先，Java 中内置了接口 <code>java.sql.Driver</code>。</p></li> <li><p>JDBC 接口实现：各个数据库的驱动自行实现 <code>java.sql.Driver</code> 接口，用于管理数据库连接。</p> <ul><li>Mysql：在 mysql 的 Java 驱动包 <code>mysql-connector-java-XXX.jar</code> 中，可以找到 <code>META-INF/services</code> 目录，该目录下会有一个名字为<code>java.sql.Driver</code> 的文件，文件内容是 <code>com.mysql.cj.jdbc.Driver</code>。 <code>com.mysql.cj.jdbc.Driver</code> 正是 Mysql 版的 <code>java.sql.Driver</code> 实现。如下图所示：</li></ul> <p><img src="https://www.yuyanqing.cn/oss/image-bed/snap/20220505201455.png" alt=""></p> <ul><li>PostgreSQL 实现：在 PostgreSQL 的 Java 驱动包 <code>postgresql-42.0.0.jar</code> 中，也可以找到同样的配置文件，文件内容是 <code>org.postgresql.Driver</code>，<code>org.postgresql.Driver</code> 正是 PostgreSQL 版的 <code>java.sql.Driver</code> 实现。</li></ul></li> <li><p>创建数据库连接</p> <p>以 Mysql 为例，创建数据库连接代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DB_URL</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://%s:%s/%s&quot;</span><span class="token punctuation">,</span> <span class="token constant">DB_HOST</span><span class="token punctuation">,</span> <span class="token constant">DB_PORT</span><span class="token punctuation">,</span> <span class="token constant">DB_SCHEMA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token constant">DB_URL</span><span class="token punctuation">,</span> <span class="token constant">DB_USER</span><span class="token punctuation">,</span> <span class="token constant">DB_PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="drivermanager"><a href="#drivermanager" class="header-anchor">#</a> DriverManager</h4> <p>从前文，我们已经知道 <code>DriverManager</code> 是创建数据库连接的关键。它究竟是如何工作的呢？</p> <p>可以看到是加载实例化驱动的，接着看 loadInitialDrivers 方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">loadInitialDrivers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> drivers<span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		drivers <span class="token operator">=</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.drivers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		drivers <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 通过 classloader 获取所有实现 java.sql.Driver 的驱动类</span>
	<span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token class-name">Void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 利用 SPI，记载所有 Driver 服务</span>
			<span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Driver</span><span class="token punctuation">&gt;</span></span> loadedDrivers <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Driver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取迭代器</span>
			<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Driver</span><span class="token punctuation">&gt;</span></span> driversIterator <span class="token operator">=</span> loadedDrivers<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">try</span><span class="token punctuation">{</span>
                <span class="token comment">// 遍历迭代器</span>
				<span class="token keyword">while</span><span class="token punctuation">(</span>driversIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					driversIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Do nothing</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印数据库驱动信息</span>
	<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;DriverManager.initialize: jdbc.drivers = &quot;</span> <span class="token operator">+</span> drivers<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>drivers <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> drivers<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> driversList <span class="token operator">=</span> drivers<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;number of Drivers:&quot;</span> <span class="token operator">+</span> driversList<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> aDriver <span class="token operator">:</span> driversList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;DriverManager.Initialize: loading &quot;</span> <span class="token operator">+</span> aDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 尝试实例化驱动</span>
			<span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>aDriver<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
					<span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;DriverManager.Initialize: load failed: &quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>上面的代码主要步骤是：</p> <ol><li>从系统变量中获取驱动的实现类。</li> <li>利用 SPI 来获取所有驱动的实现类。</li> <li>遍历所有驱动，尝试实例化各个实现类。</li> <li>根据第 1 步获取到的驱动列表来实例化具体的实现类。</li></ol> <p>需要关注的是下面这行代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Driver</span><span class="token punctuation">&gt;</span></span> loadedDrivers <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Driver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里实际获取的是 <code>java.util.ServiceLoader.LazyIterator</code> 迭代器。调用其 <code>hasNext</code> 方法时，会搜索 classpath 下以及 jar 包中的 <code>META-INF/services</code> 目录，查找 <code>java.sql.Driver</code> 文件，并找到文件中的驱动实现类的全限定名。调用其 <code>next</code> 方法时，会根据驱动类的全限定名去尝试实例化一个驱动类的对象。</p> <h3 id="spi-应用案例之-common-logging"><a href="#spi-应用案例之-common-logging" class="header-anchor">#</a> SPI 应用案例之 Common-Logging</h3> <p>common-logging（也称 Jakarta Commons Logging，缩写 JCL）是常用的日志门面工具包。</p> <p>common-logging 的核心类是入口是 <code>LogFactory</code>，<code>LogFatory</code> 是一个抽象类，它负责加载具体的日志实现。</p> <p>其入口方法是 <code>LogFactory.getLog</code> 方法，源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Log</span> <span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LogConfigurationException</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Log</span> <span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LogConfigurationException</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>从以上源码可知，<code>getLog</code> 采用了工厂设计模式，是先调用 <code>getFactory</code> 方法获取具体日志库的工厂类，然后根据类名称或类型创建日志实例。</p> <p><code>LogFatory.getFactory</code> 方法负责选出匹配的日志工厂，其源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LogFactory</span> <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LogConfigurationException</span> <span class="token punctuation">{</span>
	<span class="token comment">// 省略...</span>

	<span class="token comment">// 加载 commons-logging.properties 配置文件</span>
	<span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token function">getConfigurationFile</span><span class="token punctuation">(</span>contextClassLoader<span class="token punctuation">,</span> <span class="token constant">FACTORY_PROPERTIES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 省略...</span>

    <span class="token comment">// 决定创建哪个 LogFactory 实例</span>
	<span class="token comment">// （1）尝试读取全局属性 org.apache.commons.logging.LogFactory</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] Looking for system property [&quot;</span> <span class="token operator">+</span> <span class="token constant">FACTORY_PROPERTY</span> <span class="token operator">+</span>
					  <span class="token string">&quot;] to define the LogFactory subclass to use...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果指定了 org.apache.commons.logging.LogFactory 属性，尝试实例化具体实现类</span>
		<span class="token class-name">String</span> factoryClass <span class="token operator">=</span> <span class="token function">getSystemProperty</span><span class="token punctuation">(</span><span class="token constant">FACTORY_PROPERTY</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>factoryClass <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] Creating an instance of LogFactory class '&quot;</span> <span class="token operator">+</span> factoryClass <span class="token operator">+</span>
							  <span class="token string">&quot;' as specified by system property &quot;</span> <span class="token operator">+</span> <span class="token constant">FACTORY_PROPERTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			factory <span class="token operator">=</span> <span class="token function">newFactory</span><span class="token punctuation">(</span>factoryClass<span class="token punctuation">,</span> baseClassLoader<span class="token punctuation">,</span> contextClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] No system property [&quot;</span> <span class="token operator">+</span> <span class="token constant">FACTORY_PROPERTY</span> <span class="token operator">+</span> <span class="token string">&quot;] defined.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SecurityException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 异常处理</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 异常处理</span>
	<span class="token punctuation">}</span>

    <span class="token comment">// （2）利用 Java SPI 机制，尝试在 classpatch 的 META-INF/services 目录下寻找 org.apache.commons.logging.LogFactory 实现类</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] Looking for a resource file of name [&quot;</span> <span class="token operator">+</span> <span class="token constant">SERVICE_ID</span> <span class="token operator">+</span>
						  <span class="token string">&quot;] to define the LogFactory subclass to use...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>contextClassLoader<span class="token punctuation">,</span> <span class="token constant">SERVICE_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span><span class="token punctuation">(</span> is <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// This code is needed by EBCDIC and other strange systems.</span>
				<span class="token comment">// It's a fix for bugs reported in xerces</span>
				<span class="token class-name">BufferedReader</span> rd<span class="token punctuation">;</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					rd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					rd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token class-name">String</span> factoryClassName <span class="token operator">=</span> rd<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				rd<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>factoryClassName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>factoryClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP]  Creating an instance of LogFactory class &quot;</span> <span class="token operator">+</span>
									  factoryClassName <span class="token operator">+</span>
									  <span class="token string">&quot; as specified by file '&quot;</span> <span class="token operator">+</span> <span class="token constant">SERVICE_ID</span> <span class="token operator">+</span>
									  <span class="token string">&quot;' which was present in the path of the context classloader.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					factory <span class="token operator">=</span> <span class="token function">newFactory</span><span class="token punctuation">(</span>factoryClassName<span class="token punctuation">,</span> baseClassLoader<span class="token punctuation">,</span> contextClassLoader <span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// is == null</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] No resource file with name '&quot;</span> <span class="token operator">+</span> <span class="token constant">SERVICE_ID</span> <span class="token operator">+</span> <span class="token string">&quot;' found.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// note: if the specified LogFactory class wasn't compatible with LogFactory</span>
			<span class="token comment">// for some reason, a ClassCastException will be caught here, and attempts will</span>
			<span class="token comment">// continue to find a compatible class.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">logDiagnostic</span><span class="token punctuation">(</span>
					<span class="token string">&quot;[LOOKUP] A security exception occurred while trying to create an&quot;</span> <span class="token operator">+</span>
					<span class="token string">&quot; instance of the custom factory class&quot;</span> <span class="token operator">+</span>
					<span class="token string">&quot;: [&quot;</span> <span class="token operator">+</span> <span class="token function">trim</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
					<span class="token string">&quot;]. Trying alternative implementations...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// ignore</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// （3）尝试从 classpath 目录下的 commons-logging.properties 文件中查找 org.apache.commons.logging.LogFactory 属性</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">logDiagnostic</span><span class="token punctuation">(</span>
					<span class="token string">&quot;[LOOKUP] Looking in properties file for entry with key '&quot;</span> <span class="token operator">+</span> <span class="token constant">FACTORY_PROPERTY</span> <span class="token operator">+</span>
					<span class="token string">&quot;' to define the LogFactory subclass to use...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">String</span> factoryClass <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token constant">FACTORY_PROPERTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>factoryClass <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">logDiagnostic</span><span class="token punctuation">(</span>
						<span class="token string">&quot;[LOOKUP] Properties file specifies LogFactory subclass '&quot;</span> <span class="token operator">+</span> factoryClass <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				factory <span class="token operator">=</span> <span class="token function">newFactory</span><span class="token punctuation">(</span>factoryClass<span class="token punctuation">,</span> baseClassLoader<span class="token punctuation">,</span> contextClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// TODO: think about whether we need to handle exceptions from newFactory</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] Properties file has no entry specifying LogFactory subclass.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">logDiagnostic</span><span class="token punctuation">(</span><span class="token string">&quot;[LOOKUP] No properties file available to determine&quot;</span> <span class="token operator">+</span> <span class="token string">&quot; LogFactory subclass from..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// （4）以上情况都不满足，实例化默认实现类 org.apache.commons.logging.impl.LogFactoryImpl</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDiagnosticsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">logDiagnostic</span><span class="token punctuation">(</span>
				<span class="token string">&quot;[LOOKUP] Loading the default LogFactory implementation '&quot;</span> <span class="token operator">+</span> <span class="token constant">FACTORY_DEFAULT</span> <span class="token operator">+</span>
				<span class="token string">&quot;' via the same classloader that loaded this LogFactory&quot;</span> <span class="token operator">+</span>
				<span class="token string">&quot; class (ie not looking in the context classloader).&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		factory <span class="token operator">=</span> <span class="token function">newFactory</span><span class="token punctuation">(</span><span class="token constant">FACTORY_DEFAULT</span><span class="token punctuation">,</span> thisClassLoader<span class="token punctuation">,</span> contextClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">/**
		 * Always cache using context class loader.
		 */</span>
		<span class="token function">cacheFactory</span><span class="token punctuation">(</span>contextClassLoader<span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Enumeration</span> names <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">propertyNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>names<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> names<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> value <span class="token operator">=</span> props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
				factory<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br></div></div><p>从 getFactory 方法的源码可以看出，其核心逻辑分为 4 步：</p> <ol><li>首先，尝试查找全局属性 <code>org.apache.commons.logging.LogFactory</code>，如果指定了具体类，尝试创建实例。</li> <li>利用 Java SPI 机制，尝试在 classpatch 的 <code>META-INF/services</code> 目录下寻找 <code>org.apache.commons.logging.LogFactory</code> 的实现类。</li> <li>尝试从 classpath 目录下的 <code>commons-logging.properties</code> 文件中查找 <code>org.apache.commons.logging.LogFactory</code> 属性，如果指定了具体类，尝试创建实例。</li> <li>以上情况如果都不满足，则实例化默认实现类，即 <code>org.apache.commons.logging.impl.LogFactoryImpl</code>。</li></ol> <h3 id="spi-应用案例之-spring-boot"><a href="#spi-应用案例之-spring-boot" class="header-anchor">#</a> SPI 应用案例之 Spring Boot</h3> <p>Spring Boot 是基于 Spring 构建的框架，其设计目的在于简化 Spring 应用的配置、运行。在 Spring Boot 中，大量运用了自动装配来尽可能减少配置。</p> <p>下面是一个 Spring Boot 入口示例，可以看到，代码非常简洁。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		<span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hello %s!&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>那么，Spring Boot 是如何做到寥寥几行代码，就可以运行一个 Spring Boot 应用的呢。我们不妨带着疑问，从源码入手，一步步探究其原理。</p> <h4 id="springbootapplication-注解"><a href="#springbootapplication-注解" class="header-anchor">#</a> <code>@SpringBootApplication</code> 注解</h4> <p>首先，Spring Boot 应用的启动类上都会标记一个 <code>@SpringBootApplication</code> 注解。<code>@SpringBootApplication</code> 注解定义如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>
    excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>
    type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span>
    classes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>
    type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span>
    classes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
		<span class="token comment">// 略</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>除了 <code>@Target</code>、 <code>@Retention</code>、<code>@Documented</code>、<code>@Inherited</code> 这几个元注解， <code>@SpringBootApplication</code> 注解的定义中还标记了 <code>@SpringBootConfiguration</code>、<code>@EnableAutoConfiguration</code>、<code>@ComponentScan</code> 三个注解。</p> <h4 id="springbootconfiguration-注解"><a href="#springbootconfiguration-注解" class="header-anchor">#</a> <code>@SpringBootConfiguration</code> 注解</h4> <p>从<code>@SpringBootConfiguration</code> 注解的定义来看，<code>@SpringBootConfiguration</code> 注解本质上就是一个 <code>@Configuration</code> 注解，这意味着被<code>@SpringBootConfiguration</code> 注解修饰的类会被 Spring Boot 识别为一个配置类。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Configuration
public @interface SpringBootConfiguration {
    @AliasFor(
        annotation = Configuration.class
    )
    boolean proxyBeanMethods() default true;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="enableautoconfiguration-注解"><a href="#enableautoconfiguration-注解" class="header-anchor">#</a> <code>@EnableAutoConfiguration</code> 注解</h4> <p><code>@EnableAutoConfiguration</code> 注解定义如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token constant">ENABLED_OVERRIDE_PROPERTY</span> <span class="token operator">=</span> <span class="token string">&quot;spring.boot.enableautoconfiguration&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>@EnableAutoConfiguration</code> 注解包含了 <code>@AutoConfigurationPackage</code> 与 <code>@Import({AutoConfigurationImportSelector.class})</code> 两个注解。</p> <h4 id="autoconfigurationpackage-注解"><a href="#autoconfigurationpackage-注解" class="header-anchor">#</a> <code>@AutoConfigurationPackage</code> 注解</h4> <p><code>@AutoConfigurationPackage</code> 会将被修饰的类作为主配置类，该类所在的 package 会被视为根路径，Spring Boot 默认会自动扫描根路径下的所有 Spring Bean（被 <code>@Component</code> 以及继承 <code>@Component</code> 的各个注解所修饰的类）。——这就是为什么 Spring Boot 的启动类一般要置于根路径的原因。这个功能等同于在 Spring xml 配置中通过 <code>context:component-scan</code> 来指定扫描路径。<code>@Import</code> 注解的作用是向 Spring 容器中直接注入指定组件。<code>@AutoConfigurationPackage</code> 注解中注明了 <code>@Import({Registrar.class})</code>。<code>Registrar</code> 类用于保存 Spring Boot 的入口类、根路径等信息。</p> <h4 id="springfactoriesloader-loadfactorynames-方法"><a href="#springfactoriesloader-loadfactorynames-方法" class="header-anchor">#</a> <code>SpringFactoriesLoader.loadFactoryNames</code> 方法</h4> <p><code>@Import(AutoConfigurationImportSelector.class)</code> 表示直接注入 <code>AutoConfigurationImportSelector</code>。<code>AutoConfigurationImportSelector</code> 有一个核心方法 <code>getCandidateConfigurations</code> 用于获取候选配置。该方法调用了 <code>SpringFactoriesLoader.loadFactoryNames</code> 方法，这个方法即为 Spring Boot SPI 的关键，它负责加载所有 <code>META-INF/spring.factories</code> 文件，加载的过程由 <code>SpringFactoriesLoader</code> 负责。</p> <p>Spring Boot 的 <code>META-INF/spring.factories</code> 文件本质上就是一个 properties 文件，数据内容就是一个个键值对。</p> <p><code>SpringFactoriesLoader.loadFactoryNames</code> 方法的关键源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// spring.factories 文件的格式为：key=value1,value2,value3</span>
<span class="token comment">// 遍历所有 META-INF/spring.factories 文件</span>
<span class="token comment">// 解析文件，获得 key=factoryClass 的类名称</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> factoryType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> factoryType<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 尝试获取缓存，如果缓存中有数据，直接返回</span>
	<span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取资源文件路径</span>
		<span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> urls <span class="token operator">=</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span>
				classLoader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token constant">FACTORIES_RESOURCE_LOCATION</span><span class="token punctuation">)</span> <span class="token operator">:</span>
				<span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span><span class="token constant">FACTORIES_RESOURCE_LOCATION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历所有路径</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">URL</span> url <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">UrlResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 解析文件，得到对应的一组 Properties</span>
			<span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token class-name">PropertiesLoaderUtils</span><span class="token punctuation">.</span><span class="token function">loadProperties</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 遍历解析出的 properties，组装数据</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> factoryImplementationName <span class="token operator">:</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> factoryImplementationName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to load factories from location [&quot;</span> <span class="token operator">+</span>
				<span class="token constant">FACTORIES_RESOURCE_LOCATION</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>归纳上面的方法，主要作了这些事：</p> <p>加载所有 <code>META-INF/spring.factories</code> 文件，加载过程有 <code>SpringFactoriesLoader</code> 负责。</p> <ul><li>在 CLASSPATH 中搜寻所有 <code>META-INF/spring.factories</code> 配置文件</li> <li>然后，解析 <code>spring.factories</code> 文件，获取指定自动装配类的全限定名</li></ul> <h4 id="spring-boot-的-autoconfiguration-类"><a href="#spring-boot-的-autoconfiguration-类" class="header-anchor">#</a> Spring Boot 的 <code>AutoConfiguration</code> 类</h4> <p>Spring Boot 有各种 starter 包，可以根据实际项目需要，按需取材。在项目开发中，只要将 starter 包引入，我们就可以用很少的配置，甚至什么都不配置，即可获取相关的能力。通过前面的 Spring Boot SPI 流程，只完成了自动装配工作的一半，剩下的工作如何处理呢 ？</p> <p>以 spring-boot-starter-web 的 jar 包为例，查看其 maven pom，可以看到，它依赖于 spring-boot-starter，所有 Spring Boot 官方 starter 包都会依赖于这个 jar 包。而 spring-boot-starter 又依赖于 spring-boot-autoconfigure，Spring Boot 的自动装配秘密，就在于这个 jar 包。</p> <p>从 spring-boot-autoconfigure 包的结构来看，它有一个 <code>META-INF/spring.factories</code> ，显然利用了 Spring Boot SPI，来自动装配其中的配置类。</p> <p><img src="https://www.yuyanqing.cn/oss/image-bed/snap/20220505004100.png" alt=""></p> <p>下图是 spring-boot-autoconfigure 的 <code>META-INF/spring.factories</code> 文件的部分内容，可以看到其中注册了一长串会被自动加载的 <code>AutoConfiguration</code> 类。</p> <p><img src="https://www.yuyanqing.cn/oss/image-bed/snap/20220505005130.png" alt=""></p> <p>以 <code>RedisAutoConfiguration</code> 为例，这个配置类中，会根据 <code>@ConditionalXXX</code> 中的条件去决定是否实例化对应的 Bean，实例化 Bean 所依赖的重要参数则通过 <code>RedisProperties</code> 传入。</p> <p><img src="https://www.yuyanqing.cn/oss/image-bed/snap/20220505005548.png" alt=""></p> <p><code>RedisProperties</code> 中维护了 Redis 连接所需要的关键属性，只要在 yml 或 properties 配置文件中，指定 spring.redis 开头的属性，都会被自动装载到 <code>RedisProperties</code> 实例中。</p> <p><img src="https://www.yuyanqing.cn/oss/image-bed/snap/20220505005836.png" alt=""></p> <p>通过以上分析，已经一步步解读出 Spring Boot 自动装载的原理。</p> <h2 id="spi-应用案例之-dubbo"><a href="#spi-应用案例之-dubbo" class="header-anchor">#</a> SPI 应用案例之 Dubbo</h2> <p>Dubbo 并未使用 Java SPI，而是自己封装了一套新的 SPI 机制。Dubbo SPI 所需的配置文件需放置在 <code>META-INF/dubbo</code> 路径下，配置内容形式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>optimusPrime = org.apache.spi.OptimusPrime
bumblebee = org.apache.spi.Bumblebee
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>与 Java SPI 实现类配置不同，Dubbo SPI 是<strong>通过键值对的方式进行配置</strong>，这样可以<strong>按需加载</strong>指定的实现类。Dubbo SPI 除了支持按需加载接口实现类，还增加了 IOC 和 AOP 等特性。</p> <h4 id="extensionloader-入口"><a href="#extensionloader-入口" class="header-anchor">#</a> <code>ExtensionLoader</code> 入口</h4> <p>Dubbo SPI 的相关逻辑被封装在了 <code>ExtensionLoader</code> 类中，通过 <code>ExtensionLoader</code>，可以加载指定的实现类。</p> <p><code>ExtensionLoader</code> 的 <code>getExtension</code> 方法是其入口方法，其源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getExtension</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Extension name == null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取默认的拓展实现类</span>
        <span class="token keyword">return</span> <span class="token function">getDefaultExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Holder，顾名思义，用于持有目标对象</span>
    <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> holder <span class="token operator">=</span> cachedInstances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>holder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cachedInstances<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Holder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        holder <span class="token operator">=</span> cachedInstances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Object</span> instance <span class="token operator">=</span> holder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 双重检查</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>holder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> holder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 创建拓展实例</span>
                instance <span class="token operator">=</span> <span class="token function">createExtension</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 设置实例到 holder 中</span>
                holder<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>可以看出，这个方法的作用就是：首先检查缓存，缓存未命中则调用 <code>createExtension</code> 方法创建拓展对象。那么，<code>createExtension</code> 是如何创建拓展对象的呢，其源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">T</span> <span class="token function">createExtension</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从配置文件中加载所有的拓展类，可得到“配置项名称”到“配置类”的映射关系表</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token function">getExtensionClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">findException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token constant">EXTENSION_INSTANCES</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通过反射创建实例</span>
            <span class="token constant">EXTENSION_INSTANCES</span><span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token constant">EXTENSION_INSTANCES</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 向实例中注入依赖</span>
        <span class="token function">injectExtension</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wrapperClasses <span class="token operator">=</span> cachedWrapperClasses<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperClasses <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>wrapperClasses<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 循环创建 Wrapper 实例</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> wrapperClass <span class="token operator">:</span> wrapperClasses<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 将当前 instance 作为参数传给 Wrapper 的构造方法，并通过反射创建 Wrapper 实例。</span>
                <span class="token comment">// 然后向 Wrapper 实例中注入依赖，最后将 Wrapper 实例再次赋值给 instance 变量</span>
                instance <span class="token operator">=</span> <span class="token function">injectExtension</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> wrapperClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><code>createExtension</code> 方法的的工作步骤可以归纳为：</p> <ol><li>通过 <code>getExtensionClasses</code> 获取所有的拓展类</li> <li>通过反射创建拓展对象</li> <li>向拓展对象中注入依赖</li> <li>将拓展对象包裹在相应的 <code>Wrapper</code> 对象中</li></ol> <p>以上步骤中，第一个步骤是加载拓展类的关键，第三和第四个步骤是 Dubbo IOC 与 AOP 的具体实现。</p> <h4 id="获取所有的拓展类"><a href="#获取所有的拓展类" class="header-anchor">#</a> 获取所有的拓展类</h4> <p>Dubbo 在通过名称获取拓展类之前，首先需要根据配置文件解析出拓展项名称到拓展类的映射关系表（Map&lt;名称, 拓展类&gt;），之后再根据拓展项名称从映射关系表中取出相应的拓展类即可。相关过程的代码分析如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtensionClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从缓存中获取已加载的拓展类</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> classes <span class="token operator">=</span> cachedClasses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 双重检查</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>classes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>cachedClasses<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            classes <span class="token operator">=</span> cachedClasses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>classes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 加载拓展类</span>
                classes <span class="token operator">=</span> <span class="token function">loadExtensionClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cachedClasses<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>classes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> classes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>这里也是先检查缓存，若缓存未命中，则通过 <code>synchronized</code> 加锁。加锁后再次检查缓存，并判空。此时如果 classes 仍为 null，则通过 <code>loadExtensionClasses</code> 加载拓展类。下面分析 <code>loadExtensionClasses</code> 方法的逻辑。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadExtensionClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 SPI 注解，这里的 type 变量是在调用 getExtensionLoader 方法时传入的</span>
    <span class="token keyword">final</span> <span class="token class-name">SPI</span> defaultAnnotation <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token constant">SPI</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultAnnotation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> defaultAnnotation<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对 SPI 注解内容进行切分</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token constant">NAME_SEPARATOR</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 检测 SPI 注解内容是否合法，不合法则抛出异常</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>names<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;more than 1 default extension name on extension...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 设置默认名称，参考 getDefaultExtension 方法</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>names<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cachedDefaultName <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> extensionClasses <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 加载指定文件夹下的配置文件</span>
    <span class="token function">loadDirectory</span><span class="token punctuation">(</span>extensionClasses<span class="token punctuation">,</span> <span class="token constant">DUBBO_INTERNAL_DIRECTORY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">loadDirectory</span><span class="token punctuation">(</span>extensionClasses<span class="token punctuation">,</span> <span class="token constant">DUBBO_DIRECTORY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">loadDirectory</span><span class="token punctuation">(</span>extensionClasses<span class="token punctuation">,</span> <span class="token constant">SERVICES_DIRECTORY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> extensionClasses<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>loadExtensionClasses</code> 方法总共做了两件事情，一是对 SPI 注解进行解析，二是调用 <code>loadDirectory</code> 方法加载指定文件夹配置文件。SPI 注解解析过程比较简单，无需多说。下面我们来看一下 <code>loadDirectory</code> 做了哪些事情。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadDirectory</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> extensionClasses<span class="token punctuation">,</span> <span class="token class-name">String</span> dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// fileName = 文件夹路径 + type 全限定名</span>
    <span class="token class-name">String</span> fileName <span class="token operator">=</span> dir <span class="token operator">+</span> type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URL<span class="token punctuation">&gt;</span></span> urls<span class="token punctuation">;</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token function">findClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据文件名加载所有的同名文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            urls <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            urls <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>urls <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL</span> resourceURL <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 加载资源</span>
                <span class="token function">loadResource</span><span class="token punctuation">(</span>extensionClasses<span class="token punctuation">,</span> classLoader<span class="token punctuation">,</span> resourceURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>loadDirectory 方法先通过 classLoader 获取所有资源链接，然后再通过 loadResource 方法加载资源。我们继续跟下去，看一下 loadResource 方法的实现。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadResource</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> extensionClasses<span class="token punctuation">,</span>
	<span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL</span> resourceURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>resourceURL<span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> line<span class="token punctuation">;</span>
            <span class="token comment">// 按行读取配置内容</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 定位 # 字符</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> ci <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'#'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ci <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 截取 # 之前的字符串，# 之后的内容为注释，需要忽略</span>
                    line <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ci<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                line <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token keyword">int</span> i <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 以等于号 = 为界，截取键与值</span>
                            name <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            line <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 加载类，并通过 loadClass 方法对类进行缓存</span>
                            <span class="token function">loadClass</span><span class="token punctuation">(</span>extensionClasses<span class="token punctuation">,</span> resourceURL<span class="token punctuation">,</span>
                                      <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">IllegalStateException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load extension class...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Exception when load extension class...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>loadResource 方法用于读取和解析配置文件，并通过反射加载类，最后调用 loadClass 方法进行其他操作。loadClass 方法用于主要用于操作缓存，该方法的逻辑如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> extensionClasses<span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL</span> resourceURL<span class="token punctuation">,</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 检测目标类上是否有 Adaptive 注解</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Adaptive</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedAdaptiveClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 设置 cachedAdaptiveClass缓存</span>
            cachedAdaptiveClass <span class="token operator">=</span> clazz<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cachedAdaptiveClass<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token comment">// 检测 clazz 是否是 Wrapper 类型</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isWrapperClass</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wrappers <span class="token operator">=</span> cachedWrapperClasses<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wrappers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cachedWrapperClasses <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            wrappers <span class="token operator">=</span> cachedWrapperClasses<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 存储 clazz 到 cachedWrapperClasses 缓存中</span>
        wrappers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 程序进入此分支，表明 clazz 是一个普通的拓展类</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 检测 clazz 是否有默认的构造方法，如果没有，则抛出异常</span>
        clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果 name 为空，则尝试从 Extension 注解中获取 name，或使用小写的类名作为 name</span>
            name <span class="token operator">=</span> <span class="token function">findAnnotationName</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 切分 name</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token constant">NAME_SEPARATOR</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>names <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> names<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Activate</span> activate <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Activate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>activate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果类上有 Activate 注解，则使用 names 数组的第一个元素作为键，</span>
                <span class="token comment">// 存储 name 到 Activate 注解对象的映射关系</span>
                cachedActivates<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> activate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> n <span class="token operator">:</span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cachedNames<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 存储 Class 到名称的映射关系</span>
                    cachedNames<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> extensionClasses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 存储名称到 Class 的映射关系</span>
                    extensionClasses<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>如上，<code>loadClass</code> 方法操作了不同的缓存，比如 <code>cachedAdaptiveClass</code>、<code>cachedWrapperClasses</code> 和 <code>cachedNames</code> 等等。除此之外，该方法没有其他什么逻辑了。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://zhuanlan.zhihu.com/p/28909673" target="_blank" rel="noopener noreferrer">Java SPI 思想梳理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dubbo.apache.org/zh/docs/v2.7/dev/source/dubbo-spi/#m-zhdocsv27devsourcedubbo-spi" target="_blank" rel="noopener noreferrer">Dubbo SPI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/0d196ad23915" target="_blank" rel="noopener noreferrer">springboot 中 SPI 机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cdmana.com/2021/09/20210912140742519L.html" target="_blank" rel="noopener noreferrer">SpringBoot 的自动装配原理、自定义 starter 与 spi 机制，一网打尽<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/kamalyes/kamalyes.github.io.git/edit/master/docs/02.后端/01.JavaSE/02.高级特性/05.JavaSPI.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Java" title="标签">#Java</a><a href="/tags/?tag=JavaSE" title="标签">#JavaSE</a><a href="/tags/?tag=SPI" title="标签">#SPI</a><a href="/tags/?tag=Dubbo" title="标签">#Dubbo</a><a href="/tags/?tag=Spring%20Boot" title="标签">#Spring Boot</a><a href="/tags/?tag=common-logging" title="标签">#common-logging</a><a href="/tags/?tag=JDBC" title="标签">#JDBC</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/05/25, 09:15:06</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f756bd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JDK8</div></a> <a href="/pages/d71f2c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Java 编程规范</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f756bd/" class="prev">JDK8</a></span> <span class="next"><a href="/pages/d71f2c/">Java 编程规范</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/08be43/"><div>
            k8s搭建redis集群
            <!----></div></a> <span class="date">12-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e35a32/"><div>
            k8s搭建rabbitmq集群
            <!----></div></a> <span class="date">12-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/0ac0cb/"><div>
            k8s-sonarqube-jenkins-pipeline配置
            <!----></div></a> <span class="date">12-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:mryu168@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/kamalyes" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>kamalyes | <a href="http://beian.miit.gov.cn/" target="_blank">© ICP备案/许可证号:粤ICP备2023052306号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1c8f7f3c.js" defer></script><script src="/assets/js/2.16d814aa.js" defer></script><script src="/assets/js/219.9844c3ab.js" defer></script>
  </body>
</html>
