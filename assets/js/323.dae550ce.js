(window.webpackJsonp=window.webpackJsonp||[]).push([[323],{640:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"jmh-快速入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-快速入门"}},[s._v("#")]),s._v(" JMH 快速入门")]),s._v(" "),t("h2",{attrs:{id:"基准测试简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基准测试简介"}},[s._v("#")]),s._v(" 基准测试简介")]),s._v(" "),t("h3",{attrs:{id:"什么是基准测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是基准测试"}},[s._v("#")]),s._v(" 什么是基准测试")]),s._v(" "),t("p",[s._v("基准测试是指通过设计科学的测试方法、测试工具和测试系统，实现对一类测试对象的某项性能指标进行定量的和可对比的测试。")]),s._v(" "),t("p",[s._v("现代软件常常都把高性能作为目标。那么，何为高性能，性能就是快，更快吗？显然，如果没有一个量化的标准，难以衡量性能的好坏。")]),s._v(" "),t("p",[s._v("不同的基准测试其具体内容和范围也存在很大的不同。如果是专业的性能工程师，更加熟悉的可能是类似 SPEC 提供的工业标准的系统级测试；而对于大多数 Java 开发者，更熟悉的则是范围相对较小、关注点更加细节的微基准测试（Micro-Benchmark）。何谓 Micro Benchmark 呢？ 简单地说就是在 method 层面上的 benchmark，精度可以精确到 "),t("strong",[s._v("微秒级")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"何时需要微基准测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#何时需要微基准测试"}},[s._v("#")]),s._v(" 何时需要微基准测试")]),s._v(" "),t("p",[s._v("微基准测试大多是 API 级别的性能测试。")]),s._v(" "),t("p",[s._v("微基准测试的适用场景：")]),s._v(" "),t("ul",[t("li",[s._v("如果开发公共类库、中间件，会被其他模块经常调用的 API。")]),s._v(" "),t("li",[s._v("对于性能，如响应延迟、吞吐量有严格要求的核心 API。")])]),s._v(" "),t("h2",{attrs:{id:"jmh-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-简介"}},[s._v("#")]),s._v(" JMH 简介")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://openjdk.java.net/projects/code-tools/jmh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH(即 Java Microbenchmark Harness)"),t("OutboundLink")],1),s._v("，是目前主流的微基准测试框架。JMH 是由 Hotspot JVM 团队专家开发的，除了支持完整的基准测试过程，包括预热、运行、统计和报告等，还支持 Java 和其他 JVM 语言。更重要的是，它针对 Hotspot JVM 提供了各种特性，以保证基准测试的正确性，整体准确性大大优于其他框架，并且，JMH 还提供了用近乎白盒的方式进行 Profiling 等工作的能力。")]),s._v(" "),t("h3",{attrs:{id:"为什么需要-jmh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要-jmh"}},[s._v("#")]),s._v(" 为什么需要 JMH")]),s._v(" "),t("h4",{attrs:{id:"死码消除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#死码消除"}},[s._v("#")]),s._v(" 死码消除")]),s._v(" "),t("p",[s._v("所谓死码，是指注释的代码，不可达的代码块，可达但不被使用的代码等等 。")]),s._v(" "),t("h4",{attrs:{id:"常量折叠与常量传播"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常量折叠与常量传播"}},[s._v("#")]),s._v(" 常量折叠与常量传播")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%B8%B8%E6%95%B8%E6%8A%98%E7%96%8A#%E5%B8%B8%E6%95%B8%E5%82%B3%E6%92%AD",target:"_blank",rel:"noopener noreferrer"}},[s._v("常量折叠"),t("OutboundLink")],1),s._v(" (Constant folding) 是一个在编译时期简化常数的一个过程，常数在表示式中仅仅代表一个简单的数值，就像是整数 "),t("code",[s._v("2")]),s._v("，若是一个变数从未被修改也可作为常数，或者直接将一个变数被明确地被标注为常数，例如下面的描述：")]),s._v(" "),t("h3",{attrs:{id:"jmh-的注意点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-的注意点"}},[s._v("#")]),s._v(" JMH 的注意点")]),s._v(" "),t("ul",[t("li",[s._v("测试前需要预热。")]),s._v(" "),t("li",[s._v("防止无用代码进入测试方法中。")]),s._v(" "),t("li",[s._v("并发测试。")]),s._v(" "),t("li",[s._v("测试结果呈现。")])]),s._v(" "),t("h3",{attrs:{id:"应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),t("ol",[t("li",[s._v("当你已经找出了热点函数，而需要对热点函数进行进一步的优化时，就可以使用 JMH 对优化的效果进行定量的分析。")]),s._v(" "),t("li",[s._v("想定量地知道某个函数需要执行多长时间，以及执行时间和输入 n 的相关性")]),s._v(" "),t("li",[s._v("一个函数有两种不同实现（例如 JSON 序列化/反序列化有 Jackson 和 Gson 实现），不知道哪种实现性能更好")])]),s._v(" "),t("h3",{attrs:{id:"jmh-概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-概念"}},[s._v("#")]),s._v(" JMH 概念")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Iteration")]),s._v(" - iteration 是 JMH 进行测试的最小单位，包含一组 invocations。")]),s._v(" "),t("li",[t("code",[s._v("Invocation")]),s._v(" - 一次 benchmark 方法调用。")]),s._v(" "),t("li",[t("code",[s._v("Operation")]),s._v(" - benchmark 方法中，被测量操作的执行。如果被测试的操作在 benchmark 方法中循环执行，可以使用"),t("code",[s._v("@OperationsPerInvocation")]),s._v("表明循环次数，使测试结果为单次 operation 的性能。")]),s._v(" "),t("li",[t("code",[s._v("Warmup")]),s._v(" - 在实际进行 benchmark 前先进行预热。因为某个函数被调用多次之后，JIT 会对其进行编译，通过预热可以使测量结果更加接近真实情况。")])]),s._v(" "),t("h2",{attrs:{id:"jmh-快速入门-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-快速入门-2"}},[s._v("#")]),s._v(" JMH 快速入门")]),s._v(" "),t("h3",{attrs:{id:"添加-maven-依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加-maven-依赖"}},[s._v("#")]),s._v(" 添加 maven 依赖")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.openjdk.jmh"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jmh-core"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${jmh.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.openjdk.jmh"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jmh-generator-annprocess"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${jmh.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("provided"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"测试代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试代码"}},[s._v("#")]),s._v(" 测试代码")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@BenchmarkMode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Throughput")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Warmup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("iterations "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Measurement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("iterations "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Threads")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Fork")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OutputTimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MILLISECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilderBenchmark")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("testStringAdd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// System.out.println(a);")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("testStringBuilderAdd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),s._v(" sb "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            sb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// System.out.println(sb.toString());")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RunnerException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Options")]),s._v(" options "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OptionsBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("include")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilderBenchmark")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSimpleName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("output")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d:/Benchmark.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("h3",{attrs:{id:"执行-jmh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行-jmh"}},[s._v("#")]),s._v(" 执行 JMH")]),s._v(" "),t("h4",{attrs:{id:"命令行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令行"}},[s._v("#")]),s._v(" 命令行")]),s._v(" "),t("p",[s._v("（1）初始化 "),t("strong",[s._v("benchmarking")]),s._v(" 工程")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ mvn archetype:generate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DinteractiveMode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DarchetypeGroupId")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.openjdk.jmh "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DarchetypeArtifactId")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jmh-java-benchmark-archetype "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DgroupId")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.sample "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DartifactId")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dversion")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("（2）构建 benchmark")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" test/\nmvn clean "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("（3）运行 benchmark")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" target/benchmarks.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"执行-main-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行-main-方法"}},[s._v("#")]),s._v(" 执行 main 方法")]),s._v(" "),t("p",[s._v("执行 main 方法，耐心等待测试结果，最终会生成一个测试报告，内容大致如下；")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JMH version: 1.22")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM version: JDK 1.8.0_181, Java HotSpot(TM) 64-Bit Server VM, 25.181-b13")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_181\\jre\\bin\\java.exe")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM options: -javaagent:D:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.2.3\\lib\\idea_rt.jar=58635:D:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.2.3\\bin -Dfile.encoding=UTF-8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup: 3 iterations, 10 s each")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Measurement: 10 iterations, 5 s each")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Timeout: 10 min per iteration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads: 8 threads, will synchronize iterations")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Benchmark mode: Throughput, ops/time")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Benchmark: io.github.kamalyes.javatech.jmh.StringBuilderBenchmark.testStringAdd")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run progress: 0.00% complete, ETA 00:05:20")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Fork: 1 of 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   1: 21803.050 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   2: 22501.860 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   3: 20953.944 ops/ms")]),s._v("\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21627.645")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21215.269")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20863.282")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21617.715")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21695.645")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21886.784")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21986.899")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22389.540")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22507.313")]),s._v(" ops/ms\nIteration  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22124.133")]),s._v(" ops/ms\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run progress: 25.00% complete, ETA 00:04:02")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Fork: 2 of 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   1: 22262.108 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   2: 21567.804 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   3: 21787.002 ops/ms")]),s._v("\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21598.970")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22486.133")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22157.834")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22321.827")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22477.063")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22154.760")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21561.095")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22194.863")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22493.844")]),s._v(" ops/ms\nIteration  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22568.078")]),s._v(" ops/ms\n\n\nResult "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.github.kamalyes.javatech.jmh.StringBuilderBenchmark.testStringAdd"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21996.435")]),s._v(" ±"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("412.955")]),s._v(" ops/ms "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Average"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min, avg, max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20863.282")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21996.435")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22568.078")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", stdev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("475.560")]),s._v("\n  CI "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21583.480")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22409.390")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("assumes normal distribution"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JMH version: 1.22")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM version: JDK 1.8.0_181, Java HotSpot(TM) 64-Bit Server VM, 25.181-b13")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM invoker: C:\\Program Files\\Java\\jdk1.8.0_181\\jre\\bin\\java.exe")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VM options: -javaagent:D:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.2.3\\lib\\idea_rt.jar=58635:D:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.2.3\\bin -Dfile.encoding=UTF-8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup: 3 iterations, 10 s each")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Measurement: 10 iterations, 5 s each")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Timeout: 10 min per iteration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Threads: 8 threads, will synchronize iterations")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Benchmark mode: Throughput, ops/time")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Benchmark: io.github.kamalyes.javatech.jmh.StringBuilderBenchmark.testStringBuilderAdd")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run progress: 50.00% complete, ETA 00:02:41")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Fork: 1 of 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   1: 241500.886 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   2: 134206.032 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   3: 86907.846 ops/ms")]),s._v("\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86143.339")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74725.356")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72316.121")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("77319.716")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83469.256")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("87712.360")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("79421.899")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80867.839")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82619.163")]),s._v(" ops/ms\nIteration  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("87026.928")]),s._v(" ops/ms\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run progress: 75.00% complete, ETA 00:01:20")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Fork: 2 of 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   1: 228342.337 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   2: 124737.248 ops/ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warmup Iteration   3: 82598.851 ops/ms")]),s._v("\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86877.318")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89388.624")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("88523.558")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("87547.332")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("88376.087")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("88848.837")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("85998.124")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86796.998")]),s._v(" ops/ms\nIteration   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("87994.726")]),s._v(" ops/ms\nIteration  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("87784.453")]),s._v(" ops/ms\n\n\nResult "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.github.kamalyes.javatech.jmh.StringBuilderBenchmark.testStringBuilderAdd"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84487.902")]),s._v(" ±"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4355.525")]),s._v(" ops/ms "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Average"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min, avg, max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72316.121")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84487.902")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89388.624")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", stdev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5015.829")]),s._v("\n  CI "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80132.377")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("88843.427")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("assumes normal distribution"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run complete. Total time: 00:05:23")]),s._v("\n\nREMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on\nwhy the numbers are the way they are. Use profilers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("see -prof, -lprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", design factorial\nexperiments, perform baseline and negative tests that provide experimental control, "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" sure\nthe benchmarking environment is safe on JVM/OS/HW level, ask "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" reviews from the domain experts.\nDo not assume the numbers tell you what you want them to tell.\n\nBenchmark                                     Mode  Cnt      Score      Error   Units\nStringBuilderBenchmark.testStringAdd         thrpt   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21996.435")]),s._v(" ±  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("412.955")]),s._v("  ops/ms\nStringBuilderBenchmark.testStringBuilderAdd  thrpt   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84487.902")]),s._v(" ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4355.525")]),s._v("  ops/ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br")])]),t("h2",{attrs:{id:"jmh-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jmh-api"}},[s._v("#")]),s._v(" JMH API")]),s._v(" "),t("p",[s._v("下面来了解一下 jmh 常用 API")]),s._v(" "),t("h3",{attrs:{id:"benchmarkmode"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#benchmarkmode"}},[s._v("#")]),s._v(" @BenchmarkMode")]),s._v(" "),t("p",[s._v("基准测试类型。这里选择的是 "),t("code",[s._v("Throughput")]),s._v(" 也就是吞吐量。根据源码点进去，每种类型后面都有对应的解释，比较好理解，吞吐量会得到单位时间内可以进行的操作数。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Throughput")]),s._v(" - 整体吞吐量，例如“1 秒内可以执行多少次调用”。")]),s._v(" "),t("li",[t("code",[s._v("AverageTime")]),s._v(" - 调用的平均时间，例如“每次调用平均耗时 xxx 毫秒”。")]),s._v(" "),t("li",[t("code",[s._v("SampleTime")]),s._v(" - 随机取样，最后输出取样结果的分布，例如“99%的调用在 xxx 毫秒以内，99.99%的调用在 xxx 毫秒以内”")]),s._v(" "),t("li",[t("code",[s._v("SingleShotTime")]),s._v(" - 以上模式都是默认一次 iteration 是 1s，唯有 SingleShotTime 是只运行一次。往往同时把 warmup 次数设为 0，用于测试冷启动时的性能。")]),s._v(" "),t("li",[t("code",[s._v("All")]),s._v(" - 所有模式")])]),s._v(" "),t("h3",{attrs:{id:"warmup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warmup"}},[s._v("#")]),s._v(" @Warmup")]),s._v(" "),t("p",[s._v("上面我们提到了，进行基准测试前需要进行预热。一般我们前几次进行程序测试的时候都会比较慢， 所以要让程序进行几轮预热，保证测试的准确性。其中的参数 iterations 也就非常好理解了，就是预热轮数。")]),s._v(" "),t("p",[s._v("为什么需要预热？因为 JVM 的 JIT 机制的存在，如果某个函数被调用多次之后，JVM 会尝试将其编译成为机器码从而提高执行速度。所以为了让 benchmark 的结果更加接近真实情况就需要进行预热。")]),s._v(" "),t("h3",{attrs:{id:"measurement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#measurement"}},[s._v("#")]),s._v(" @Measurement")]),s._v(" "),t("p",[s._v("度量，其实就是一些基本的测试参数。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("iterations")]),s._v(" - 进行测试的轮次")]),s._v(" "),t("li",[t("code",[s._v("time")]),s._v(" - 每轮进行的时长")]),s._v(" "),t("li",[t("code",[s._v("timeUnit")]),s._v(" - 时长单位")])]),s._v(" "),t("p",[s._v("都是一些基本的参数，可以根据具体情况调整。一般比较重的东西可以进行大量的测试，放到服务器上运行。")]),s._v(" "),t("h3",{attrs:{id:"threads"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#threads"}},[s._v("#")]),s._v(" @Threads")]),s._v(" "),t("p",[s._v("每个进程中的测试线程，这个非常好理解，根据具体情况选择，一般为 cpu 乘以 2。")]),s._v(" "),t("h3",{attrs:{id:"fork"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fork"}},[s._v("#")]),s._v(" @Fork")]),s._v(" "),t("p",[s._v("进行 fork 的次数。如果 fork 数是 2 的话，则 JMH 会 fork 出两个进程来进行测试。")]),s._v(" "),t("h3",{attrs:{id:"outputtimeunit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#outputtimeunit"}},[s._v("#")]),s._v(" @OutputTimeUnit")]),s._v(" "),t("p",[s._v("这个比较简单了，基准测试结果的时间类型。一般选择秒、毫秒、微秒。")]),s._v(" "),t("h3",{attrs:{id:"benchmark"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#benchmark"}},[s._v("#")]),s._v(" @Benchmark")]),s._v(" "),t("p",[s._v("方法级注解，表示该方法是需要进行 benchmark 的对象，用法和 JUnit 的 @Test 类似。")]),s._v(" "),t("h3",{attrs:{id:"param"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#param"}},[s._v("#")]),s._v(" @Param")]),s._v(" "),t("p",[s._v("属性级注解，@Param 可以用来指定某项参数的多种情况。特别适合用来测试一个函数在不同的参数输入的情况下的性能。")]),s._v(" "),t("h3",{attrs:{id:"setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[s._v("#")]),s._v(" @Setup")]),s._v(" "),t("p",[s._v("方法级注解，这个注解的作用就是我们需要在测试之前进行一些准备工作，比如对一些数据的初始化之类的。")]),s._v(" "),t("h3",{attrs:{id:"teardown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#teardown"}},[s._v("#")]),s._v(" @TearDown")]),s._v(" "),t("p",[s._v("方法级注解，这个注解的作用就是我们需要在测试之后进行一些结束工作，比如关闭线程池，数据库连接等的，主要用于资源的回收等。")]),s._v(" "),t("h3",{attrs:{id:"state"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[s._v("#")]),s._v(" @State")]),s._v(" "),t("p",[s._v("当使用 @Setup 参数的时候，必须在类上加这个参数，不然会提示无法运行。")]),s._v(" "),t("p",[s._v("State 用于声明某个类是一个“状态”，然后接受一个 Scope 参数用来表示该状态的共享范围。 因为很多 benchmark 会需要一些表示状态的类，JMH 允许你把这些类以依赖注入的方式注入到 benchmark 函数里。Scope 主要分为三种。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Thread")]),s._v(" - 该状态为每个线程独享。")]),s._v(" "),t("li",[t("code",[s._v("Group")]),s._v(" - 该状态为同一个组里面所有线程共享。")]),s._v(" "),t("li",[t("code",[s._v("Benchmark")]),s._v(" - 该状态在所有线程间共享。")])]),s._v(" "),t("p",[s._v("关于 State 的用法，官方的 code sample 里有比较好的"),t("a",{attrs:{href:"http://hg.openjdk.java.net/code-tools/jmh/file/cb9aa824b55a/jmh-samples/src/main/java/org/openjdk/jmh/samples/JMHSample_03_States.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("例子"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/",target:"_blank",rel:"noopener noreferrer"}},[s._v("jmh 官方示例"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.xncoding.com/2018/01/07/java/jmh.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Java 微基准测试框架 JMH"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnkirito.moe/java-jmh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("JAVA 拾遗 — JMH 与 8 个测试陷阱"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);