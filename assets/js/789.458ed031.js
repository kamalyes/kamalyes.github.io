(window.webpackJsonp=window.webpackJsonp||[]).push([[789],{1100:function(e,v,s){"use strict";s.r(v);var _=s(7),a=Object(_.a)({},(function(){var e=this,v=e._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"redis-æŒä¹…åŒ–"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#redis-æŒä¹…åŒ–"}},[e._v("#")]),e._v(" Redis æŒä¹…åŒ–")]),e._v(" "),v("blockquote",[v("p",[e._v("Redis æ”¯æŒæŒä¹…åŒ–ï¼Œå³æŠŠæ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜ä¸­ã€‚")]),e._v(" "),v("p",[e._v("Redis æä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š")]),e._v(" "),v("ul",[v("li",[v("strong",[v("code",[e._v("RDB å¿«ç…§ï¼ˆsnapshotï¼‰")])]),e._v(" - å°†å­˜åœ¨äºæŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("åªè¿½åŠ æ–‡ä»¶ï¼ˆappend-only fileï¼ŒAOFï¼‰")])]),e._v(" - å®ƒä¼šåœ¨æ‰§è¡Œå†™å‘½ä»¤æ—¶ï¼Œå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å¤åˆ¶åˆ°ç¡¬ç›˜ä¸­ã€‚")])]),e._v(" "),v("p",[e._v("è¿™ä¸¤ç§æŒä¹…åŒ–æ–¹å¼æ—¢å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚")]),e._v(" "),v("p",[e._v("å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜çš„ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ä¸ºäº†åœ¨ä¹‹åé‡ç”¨æ•°æ®ï¼Œæˆ–è€…æ˜¯ä¸ºäº†é˜²æ­¢ç³»ç»Ÿæ•…éšœè€Œå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚å¦å¤–ï¼Œå­˜å‚¨åœ¨ Redis é‡Œé¢çš„æ•°æ®æœ‰å¯èƒ½æ˜¯ç»è¿‡é•¿æ—¶é—´è®¡ç®—å¾—å‡ºçš„ï¼Œæˆ–è€…æœ‰ç¨‹åºæ­£åœ¨ä½¿ç”¨ Redis å­˜å‚¨çš„æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥ç”¨æˆ·ä¼šå¸Œæœ›è‡ªå·±å¯ä»¥å°†è¿™äº›æ•°æ®å­˜å‚¨èµ·æ¥ä»¥ä¾¿ä¹‹åä½¿ç”¨ï¼Œè¿™æ ·å°±ä¸å¿…é‡æ–°è®¡ç®—äº†ã€‚")]),e._v(" "),v("p",[e._v("Redis æä¾›äº†ä¸¤ç§æŒä¹…æ–¹å¼ï¼šRDB å’Œ AOFã€‚ä½ å¯ä»¥åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, å½“ redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯” RDB æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚")])]),e._v(" "),v("h2",{attrs:{id:"ä¸€ã€rdb"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€rdb"}},[e._v("#")]),e._v(" ä¸€ã€RDB")]),e._v(" "),v("h3",{attrs:{id:"rdb-ç®€ä»‹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-ç®€ä»‹"}},[e._v("#")]),e._v(" RDB ç®€ä»‹")]),e._v(" "),v("p",[v("strong",[e._v("RDB å³å¿«ç…§æ–¹å¼ï¼Œå®ƒå°†æŸä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰ Redis æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆRDB æ–‡ä»¶ï¼‰ä¸­")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("åˆ›å»º RDB åï¼Œç”¨æˆ·å¯ä»¥å¯¹ RDB è¿›è¡Œ"),v("strong",[e._v("å¤‡ä»½")]),e._v("ï¼Œå¯ä»¥å°† RDB "),v("strong",[e._v("å¤åˆ¶")]),e._v("åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼Œè¿˜å¯ä»¥åœ¨"),v("strong",[e._v("é‡å¯")]),e._v("æœåŠ¡å™¨æ—¶ä½¿ç”¨ã€‚ä¸€å¥è¯æ¥è¯´ï¼šRDB é€‚åˆä½œä¸º "),v("strong",[e._v("å†·å¤‡")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("RDB æ—¢å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨é…ç½®é€‰é¡¹å®šæœŸæ‰§è¡Œã€‚è¯¥åŠŸèƒ½å¯ä»¥å°†æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚")]),e._v(" "),v("h4",{attrs:{id:"rdb-çš„ä¼˜ç‚¹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„ä¼˜ç‚¹"}},[e._v("#")]),e._v(" RDB çš„ä¼˜ç‚¹")]),e._v(" "),v("ul",[v("li",[e._v("RDB æ–‡ä»¶éå¸¸ç´§å‡‘ï¼Œ"),v("strong",[e._v("é€‚åˆä½œä¸ºå†·å¤‡")]),e._v("ã€‚æ¯”å¦‚ä½ å¯ä»¥åœ¨æ¯ä¸ªå°æ—¶æŠ¥ä¿å­˜ä¸€ä¸‹è¿‡å» 24 å°æ—¶å†…çš„æ•°æ®ï¼ŒåŒæ—¶æ¯å¤©ä¿å­˜è¿‡å» 30 å¤©çš„æ•°æ®ï¼Œè¿™æ ·å³ä½¿å‡ºäº†é—®é¢˜ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚æ¢å¤åˆ°ä¸åŒç‰ˆæœ¬çš„æ•°æ®é›†ã€‚")]),e._v(" "),v("li",[e._v("å¿«ç…§åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶çˆ¶è¿›ç¨‹å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå…¨éƒ¨ç”±å­è¿›ç¨‹æ¥åšï¼Œçˆ¶è¿›ç¨‹ä¸éœ€è¦å†åšå…¶ä»– IO æ“ä½œï¼Œæ‰€ä»¥å¿«ç…§æŒä¹…åŒ–æ–¹å¼å¯ä»¥æœ€å¤§åŒ– Redis çš„æ€§èƒ½ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("æ¢å¤å¤§æ•°æ®é›†æ—¶ï¼ŒRDB æ¯” AOF æ›´å¿«")]),e._v("ã€‚")])]),e._v(" "),v("h4",{attrs:{id:"rdb-çš„ç¼ºç‚¹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„ç¼ºç‚¹"}},[e._v("#")]),e._v(" RDB çš„ç¼ºç‚¹")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå°†ä¼šä¸¢å¤±æœ€åä¸€æ¬¡åˆ›å»ºå¿«ç…§ä¹‹åçš„æ•°æ®")]),e._v("ã€‚å¦‚æœä½ å¸Œæœ›åœ¨ Redis æ„å¤–åœæ­¢å·¥ä½œï¼ˆä¾‹å¦‚ç”µæºä¸­æ–­ï¼‰çš„æƒ…å†µä¸‹ä¸¢å¤±çš„æ•°æ®æœ€å°‘çš„è¯ï¼Œé‚£ä¹ˆ å¿«ç…§ä¸é€‚åˆä½ ã€‚è™½ç„¶ä½ å¯ä»¥é…ç½®ä¸åŒçš„ save æ—¶é—´ç‚¹(ä¾‹å¦‚æ¯éš” 5 åˆ†é’Ÿå¹¶ä¸”å¯¹æ•°æ®é›†æœ‰ 100 ä¸ªå†™çš„æ“ä½œ)ï¼Œæ˜¯ Redis è¦å®Œæ•´çš„ä¿å­˜æ•´ä¸ªæ•°æ®é›†æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¹é‡çš„å·¥ä½œï¼Œä½ é€šå¸¸ä¼šæ¯éš” 5 åˆ†é’Ÿæˆ–è€…æ›´ä¹…åšä¸€æ¬¡å®Œæ•´çš„ä¿å­˜ï¼Œä¸‡ä¸€åœ¨ Redis æ„å¤–å®•æœºï¼Œä½ å¯èƒ½ä¼šä¸¢å¤±å‡ åˆ†é’Ÿçš„æ•°æ®ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œä¿å­˜å¿«ç…§çš„æ—¶é—´ä¼šå¾ˆé•¿")]),e._v("ã€‚å¿«ç…§éœ€è¦ç»å¸¸ fork å­è¿›ç¨‹æ¥ä¿å­˜æ•°æ®é›†åˆ°ç¡¬ç›˜ä¸Šã€‚å½“æ•°æ®é›†æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œfork çš„è¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Redis åœ¨ä¸€äº›æ¯«ç§’çº§å†…ä¸èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å¦‚æœæ•°æ®é›†å·¨å¤§å¹¶ä¸” CPU æ€§èƒ½ä¸æ˜¯å¾ˆå¥½çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æƒ…å†µä¼šæŒç»­ 1 ç§’ã€‚AOF ä¹Ÿéœ€è¦ forkï¼Œä½†æ˜¯ä½ å¯ä»¥è°ƒèŠ‚é‡å†™æ—¥å¿—æ–‡ä»¶çš„é¢‘ç‡æ¥æé«˜æ•°æ®é›†çš„è€ä¹…åº¦ã€‚")])]),e._v(" "),v("h3",{attrs:{id:"rdb-çš„åˆ›å»º"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„åˆ›å»º"}},[e._v("#")]),e._v(" RDB çš„åˆ›å»º")]),e._v(" "),v("p",[e._v("æœ‰ä¸¤ä¸ª Redis å‘½ä»¤å¯ä»¥ç”¨äºç”Ÿæˆ RDB æ–‡ä»¶ï¼š"),v("code",[e._v("SAVE")]),e._v(" å’Œ "),v("code",[e._v("BGSAVE")]),e._v("ã€‚")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://redis.io/commands/save",target:"_blank",rel:"noopener noreferrer"}},[v("strong",[v("code",[e._v("SAVE")])]),v("OutboundLink")],1),e._v(" å‘½ä»¤ä¼šé˜»å¡ Redis æœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ° RDB åˆ›å»ºå®Œæˆä¸ºæ­¢ï¼Œåœ¨é˜»å¡æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸èƒ½å“åº”ä»»ä½•å‘½ä»¤è¯·æ±‚ã€‚")]),e._v(" "),v("li",[v("a",{attrs:{href:"https://redis.io/commands/bgsave",target:"_blank",rel:"noopener noreferrer"}},[v("strong",[v("code",[e._v("BGSAVE")])]),v("OutboundLink")],1),e._v(" å‘½ä»¤ä¼šæ´¾ç”Ÿå‡ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åç”±å­è¿›ç¨‹è´Ÿè´£åˆ›å»º RDB æ–‡ä»¶ï¼ŒæœåŠ¡å™¨è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚")])]),e._v(" "),v("blockquote",[v("p",[e._v("ğŸ”” æ³¨æ„ï¼š"),v("code",[e._v("BGSAVE")]),e._v(" å‘½ä»¤æ‰§è¡ŒæœŸé—´ï¼Œ"),v("code",[e._v("SAVE")]),e._v("ã€"),v("code",[e._v("BGSAVE")]),e._v("ã€"),v("code",[e._v("BGREWRITEAOF")]),e._v(" ä¸‰ä¸ªå‘½ä»¤ä¼šè¢«æ‹’ç»ï¼Œä»¥å…ä¸å½“å‰çš„ "),v("code",[e._v("BGSAVE")]),e._v(" æ“ä½œäº§ç”Ÿç«æ€æ¡ä»¶ï¼Œé™ä½æ€§èƒ½ã€‚")])]),e._v(" "),v("h4",{attrs:{id:"è‡ªåŠ¨é—´éš”ä¿å­˜"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªåŠ¨é—´éš”ä¿å­˜"}},[e._v("#")]),e._v(" è‡ªåŠ¨é—´éš”ä¿å­˜")]),e._v(" "),v("p",[e._v("Redis å…è®¸ç”¨æˆ·é€šè¿‡è®¾ç½®æœåŠ¡å™¨é…ç½®çš„ "),v("code",[e._v("save")]),e._v(" é€‰é¡¹ï¼Œè®©æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ "),v("code",[e._v("BGSAVE")]),e._v(" å‘½ä»¤ã€‚")]),e._v(" "),v("p",[e._v("ç”¨æˆ·å¯ä»¥é€šè¿‡ "),v("code",[e._v("save")]),e._v(" é€‰é¡¹è®¾ç½®å¤šä¸ªä¿å­˜æ¡ä»¶ï¼Œä½†åªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼ŒæœåŠ¡å™¨å°±ä¼šæ‰§è¡Œ "),v("code",[e._v("BGSAVE")]),e._v(" å‘½ä»¤ã€‚")]),e._v(" "),v("p",[e._v("ä¸¾ä¾‹æ¥è¯´ï¼Œ"),v("code",[e._v("redis.conf")]),e._v(" ä¸­è®¾ç½®äº†å¦‚ä¸‹é…ç½®ï¼š")]),e._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("save 900 1       -- 900 ç§’å†…ï¼Œè‡³å°‘å¯¹æ•°æ®åº“è¿›è¡Œäº† 1 æ¬¡ä¿®æ”¹\nsave 300 10      -- 300 ç§’å†…ï¼Œè‡³å°‘å¯¹æ•°æ®åº“è¿›è¡Œäº† 10 æ¬¡ä¿®æ”¹\nsave 60 10000    -- 60 ç§’å†…ï¼Œè‡³å°‘å¯¹æ•°æ®åº“è¿›è¡Œäº† 10000 æ¬¡ä¿®æ”¹\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br"),v("span",{staticClass:"line-number"},[e._v("2")]),v("br"),v("span",{staticClass:"line-number"},[e._v("3")]),v("br")])]),v("p",[e._v("åªè¦æ»¡è¶³ä»¥ä¸Šä»»æ„æ¡ä»¶ï¼ŒRedis æœåŠ¡å°±ä¼šæ‰§è¡Œ BGSAVE å‘½ä»¤ã€‚")]),e._v(" "),v("h3",{attrs:{id:"rdb-çš„è½½å…¥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„è½½å…¥"}},[e._v("#")]),e._v(" RDB çš„è½½å…¥")]),e._v(" "),v("p",[v("strong",[e._v("RDB æ–‡ä»¶çš„è½½å…¥å·¥ä½œæ˜¯åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„")]),e._v("ï¼ŒRedis å¹¶æ²¡æœ‰ä¸“é—¨ç”¨äºè½½å…¥ RDB æ–‡ä»¶çš„å‘½ä»¤ã€‚")]),e._v(" "),v("p",[e._v("æœåŠ¡å™¨è½½å…¥ RDB æ–‡ä»¶æœŸé—´ï¼Œä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è½½å…¥å®Œæˆä¸ºæ­¢ã€‚")]),e._v(" "),v("blockquote",[v("p",[e._v("ğŸ”” æ³¨æ„ï¼šå› ä¸º AOF é€šå¸¸æ›´æ–°é¢‘ç‡æ¯” RDB é«˜ï¼Œæ‰€ä»¥ä¸¢å¤±æ•°æ®ç›¸å¯¹æ›´å°‘ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒRedis æœ‰ä»¥ä¸‹é»˜è®¤è¡Œä¸ºï¼š")]),e._v(" "),v("ul",[v("li",[e._v("åªæœ‰åœ¨å…³é—­ AOF åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šä½¿ç”¨ RDB è¿˜åŸæ•°æ®ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ AOF æ–‡ä»¶æ¥è¿˜åŸæ•°æ®ã€‚")])])]),e._v(" "),v("h3",{attrs:{id:"rdb-çš„æ–‡ä»¶ç»“æ„"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„æ–‡ä»¶ç»“æ„"}},[e._v("#")]),e._v(" RDB çš„æ–‡ä»¶ç»“æ„")]),e._v(" "),v("p",[e._v("RDB æ–‡ä»¶æ˜¯ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆã€‚")]),e._v(" "),v("p",[e._v("å¯¹äºä¸åŒç±»å‹ï¼ˆSTRINGã€HASHã€LISTã€SETã€SORTED SETï¼‰çš„é”®å€¼å¯¹ï¼ŒRDB æ–‡ä»¶ä¼šä½¿ç”¨ä¸åŒçš„æ–¹å¼æ¥ä¿å­˜å®ƒä»¬ã€‚")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/database/redis/redis-rdb-structure.png",alt:"img"}})]),e._v(" "),v("p",[e._v("Redis æœ¬èº«æä¾›äº†ä¸€ä¸ª RDB æ–‡ä»¶æ£€æŸ¥å·¥å…· redis-check-dumpã€‚")]),e._v(" "),v("h3",{attrs:{id:"rdb-çš„é…ç½®"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-çš„é…ç½®"}},[e._v("#")]),e._v(" RDB çš„é…ç½®")]),e._v(" "),v("p",[e._v("Redis RDB é»˜è®¤é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("save 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br"),v("span",{staticClass:"line-number"},[e._v("2")]),v("br"),v("span",{staticClass:"line-number"},[e._v("3")]),v("br"),v("span",{staticClass:"line-number"},[e._v("4")]),v("br"),v("span",{staticClass:"line-number"},[e._v("5")]),v("br"),v("span",{staticClass:"line-number"},[e._v("6")]),v("br"),v("span",{staticClass:"line-number"},[e._v("7")]),v("br"),v("span",{staticClass:"line-number"},[e._v("8")]),v("br")])]),v("p",[e._v("Redis çš„é…ç½®æ–‡ä»¶ "),v("code",[e._v("redis.conf")]),e._v(" ä¸­ä¸ RDB æœ‰å…³çš„é€‰é¡¹ï¼š")]),e._v(" "),v("ul",[v("li",[v("p",[v("code",[e._v("save")]),e._v(" - Redis ä¼šæ ¹æ® "),v("code",[e._v("save")]),e._v(" é€‰é¡¹ï¼Œè®©æœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ "),v("code",[e._v("BGSAVE")]),e._v(" å‘½ä»¤ã€‚")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("stop-writes-on-bgsave-error")]),e._v(" - å½“ BGSAVE å‘½ä»¤å‡ºç°é”™è¯¯æ—¶åœæ­¢å†™ RDB æ–‡ä»¶")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("rdbcompression")]),e._v(" - RDB æ–‡ä»¶å¼€å¯å‹ç¼©åŠŸèƒ½ã€‚")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("rdbchecksum")]),e._v(" - å¯¹ RDB æ–‡ä»¶è¿›è¡Œæ ¡éªŒã€‚")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("dbfilename")]),e._v(" - RDB æ–‡ä»¶åã€‚")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("dir")]),e._v(" - RDB æ–‡ä»¶å’Œ AOF æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚")])])]),e._v(" "),v("h2",{attrs:{id:"äºŒã€aof"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€aof"}},[e._v("#")]),e._v(" äºŒã€AOF")]),e._v(" "),v("h3",{attrs:{id:"aof-ç®€ä»‹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-ç®€ä»‹"}},[e._v("#")]),e._v(" AOF ç®€ä»‹")]),e._v(" "),v("p",[v("code",[e._v("AOF(Append Only File)")]),e._v(" æ˜¯ä»¥ "),v("strong",[e._v("æ–‡æœ¬æ—¥å¿—å½¢å¼")]),e._v(" å°† "),v("strong",[e._v("æ‰€æœ‰å†™å‘½ä»¤ä»¥ Redis å‘½ä»¤è¯·æ±‚åè®®æ ¼å¼è¿½åŠ åˆ° AOF æ–‡ä»¶çš„æœ«å°¾")]),e._v("ï¼Œä»¥æ­¤æ¥è®°å½•æ•°æ®çš„å˜åŒ–ã€‚"),v("strong",[e._v("å½“æœåŠ¡å™¨é‡å¯æ—¶ï¼Œä¼šé‡æ–°è½½å…¥å’Œæ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œå°±å¯ä»¥æ¢å¤åŸå§‹çš„æ•°æ®")]),e._v("ã€‚AOF é€‚åˆä½œä¸º "),v("strong",[e._v("çƒ­å¤‡")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("AOF å¯ä»¥é€šè¿‡ "),v("code",[e._v("appendonly yes")]),e._v(" é…ç½®é€‰é¡¹æ¥å¼€å¯ã€‚")]),e._v(" "),v("p",[e._v("å‘½ä»¤è¯·æ±‚ä¼šå…ˆä¿å­˜åˆ° AOF ç¼“å†²åŒºä¸­ï¼Œä¹‹åå†å®šæœŸå†™å…¥å¹¶åŒæ­¥åˆ° AOF æ–‡ä»¶ã€‚")]),e._v(" "),v("h4",{attrs:{id:"aof-çš„ä¼˜ç‚¹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„ä¼˜ç‚¹"}},[e._v("#")]),e._v(" AOF çš„ä¼˜ç‚¹")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼ŒAOF ä¸¢å¤±æ•°æ®æ¯” RDB å°‘")]),e._v("ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„ fsync ç­–ç•¥ï¼šæ—  fsyncï¼›æ¯ç§’ fsyncï¼›æ¯æ¬¡å†™çš„æ—¶å€™ fsyncã€‚ä½¿ç”¨é»˜è®¤çš„æ¯ç§’ fsync ç­–ç•¥ï¼ŒRedis çš„æ€§èƒ½ä¾ç„¶å¾ˆå¥½(fsync æ˜¯ç”±åå°çº¿ç¨‹è¿›è¡Œå¤„ç†çš„,ä¸»çº¿ç¨‹ä¼šå°½åŠ›å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚)ï¼Œä¸€æ—¦å‡ºç°æ•…éšœï¼Œä½ æœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("AOF æ–‡ä»¶å¯ä¿®å¤")]),e._v(" - AOF æ–‡ä»¶æ˜¯ä¸€ä¸ªåªè¿›è¡Œè¿½åŠ çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å†™å…¥ seekï¼Œå³ä½¿ç”±äºæŸäº›åŸå› (ç£ç›˜ç©ºé—´å·²æ»¡ï¼Œå†™çš„è¿‡ç¨‹ä¸­å®•æœºç­‰ç­‰)æœªæ‰§è¡Œå®Œæ•´çš„å†™å…¥å‘½ä»¤ï¼Œä½ ä¹Ÿä¹Ÿå¯ä½¿ç”¨ redis-check-aof å·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("AOF æ–‡ä»¶å¯å‹ç¼©")]),e._v("ã€‚Redis å¯ä»¥åœ¨ AOF æ–‡ä»¶ä½“ç§¯å˜å¾—è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨åœ°åœ¨åå°å¯¹ AOF è¿›è¡Œé‡å†™ï¼šé‡å†™åçš„æ–° AOF æ–‡ä»¶åŒ…å«äº†æ¢å¤å½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°å‘½ä»¤é›†åˆã€‚æ•´ä¸ªé‡å†™æ“ä½œæ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œå› ä¸º Redis åœ¨åˆ›å»ºæ–° AOF æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»§ç»­å°†å‘½ä»¤è¿½åŠ åˆ°ç°æœ‰çš„ AOF æ–‡ä»¶é‡Œé¢ï¼Œå³ä½¿é‡å†™è¿‡ç¨‹ä¸­å‘ç”Ÿåœæœºï¼Œç°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚è€Œä¸€æ—¦æ–° AOF æ–‡ä»¶åˆ›å»ºå®Œæ¯•ï¼ŒRedis å°±ä¼šä»æ—§ AOF æ–‡ä»¶åˆ‡æ¢åˆ°æ–° AOF æ–‡ä»¶ï¼Œå¹¶å¼€å§‹å¯¹æ–° AOF æ–‡ä»¶è¿›è¡Œè¿½åŠ æ“ä½œã€‚")]),e._v(" "),v("li",[v("strong",[e._v("AOF æ–‡ä»¶å¯è¯»")]),e._v(" - AOF æ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥ Redis å‘½ä»¤çš„æ ¼å¼ä¿å­˜ã€‚å› æ­¤ AOF æ–‡ä»¶çš„å†…å®¹éå¸¸å®¹æ˜“è¢«äººè¯»æ‡‚ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†æï¼ˆparseï¼‰ä¹Ÿå¾ˆè½»æ¾ã€‚ å¯¼å‡ºï¼ˆexportï¼‰ AOF æ–‡ä»¶ä¹Ÿéå¸¸ç®€å•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ ä¸å°å¿ƒæ‰§è¡Œäº† FLUSHALL å‘½ä»¤ï¼Œä½†åªè¦ AOF æ–‡ä»¶æœªè¢«é‡å†™ï¼Œé‚£ä¹ˆåªè¦åœæ­¢æœåŠ¡å™¨ï¼Œç§»é™¤ AOF æ–‡ä»¶æœ«å°¾çš„ FLUSHALL å‘½ä»¤ï¼Œå¹¶é‡å¯ Redis ï¼Œå°±å¯ä»¥å°†æ•°æ®é›†æ¢å¤åˆ° FLUSHALL æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ã€‚")])]),e._v(" "),v("h4",{attrs:{id:"aof-çš„ç¼ºç‚¹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„ç¼ºç‚¹"}},[e._v("#")]),e._v(" AOF çš„ç¼ºç‚¹")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("AOF æ–‡ä»¶ä½“ç§¯ä¸€èˆ¬æ¯” RDB å¤§")]),e._v(" - å¯¹äºç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOF æ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äº RDB æ–‡ä»¶çš„ä½“ç§¯ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("æ¢å¤å¤§æ•°æ®é›†æ—¶ï¼ŒAOF æ¯” RDB æ…¢ã€‚")]),e._v(" - æ ¹æ®æ‰€ä½¿ç”¨çš„ fsync ç­–ç•¥ï¼ŒAOF çš„é€Ÿåº¦å¯èƒ½ä¼šæ…¢äºå¿«ç…§ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ç§’ fsync çš„æ€§èƒ½ä¾ç„¶éå¸¸é«˜ï¼Œè€Œå…³é—­ fsync å¯ä»¥è®© AOF çš„é€Ÿåº¦å’Œå¿«ç…§ä¸€æ ·å¿«ï¼Œå³ä½¿åœ¨é«˜è´Ÿè·ä¹‹ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡åœ¨å¤„ç†å·¨å¤§çš„å†™å…¥è½½å…¥æ—¶ï¼Œå¿«ç…§å¯ä»¥æä¾›æ›´æœ‰ä¿è¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆlatencyï¼‰ã€‚")])]),e._v(" "),v("h3",{attrs:{id:"aof-çš„åˆ›å»º"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„åˆ›å»º"}},[e._v("#")]),e._v(" AOF çš„åˆ›å»º")]),e._v(" "),v("p",[v("strong",[e._v("Redis å‘½ä»¤è¯·æ±‚ä¼šå…ˆä¿å­˜åˆ° AOF ç¼“å†²åŒºï¼Œå†å®šæœŸå†™å…¥å¹¶åŒæ­¥åˆ° AOF æ–‡ä»¶")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("AOF çš„å®ç°å¯ä»¥åˆ†ä¸ºå‘½ä»¤è¿½åŠ ï¼ˆappendï¼‰ã€æ–‡ä»¶å†™å…¥ã€æ–‡ä»¶åŒæ­¥ï¼ˆsyncï¼‰ä¸‰ä¸ªæ­¥éª¤ã€‚")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("å‘½ä»¤è¿½åŠ ")]),e._v(" - å½“ Redis æœåŠ¡å™¨å¼€å¯ AOF åŠŸèƒ½æ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤åï¼Œä¼šä»¥ Redis å‘½ä»¤åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ° AOF ç¼“å†²åŒºçš„æœ«å°¾ã€‚")]),e._v(" "),v("li",[v("strong",[e._v("æ–‡ä»¶å†™å…¥")]),e._v("å’Œ"),v("strong",[e._v("æ–‡ä»¶åŒæ­¥")]),e._v(" - Redis çš„æœåŠ¡å™¨è¿›ç¨‹å°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œè¿™ä¸ªå¾ªç¯ä¸­çš„æ–‡ä»¶äº‹ä»¶è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ï¼Œä»¥åŠå‘å®¢æˆ·ç«¯å‘é€å‘½ä»¤å›å¤ã€‚è€Œæ—¶é—´äº‹ä»¶åˆ™è´Ÿè´£æ‰§è¡Œå®šæ—¶è¿è¡Œçš„å‡½æ•°ã€‚å› ä¸ºæœåŠ¡å™¨åœ¨å¤„ç†æ–‡ä»¶äº‹ä»¶æ—¶å¯èƒ½ä¼šæ‰§è¡Œå†™å‘½ä»¤ï¼Œè¿™äº›å†™å‘½ä»¤ä¼šè¢«è¿½åŠ åˆ° AOF ç¼“å†²åŒºï¼ŒæœåŠ¡å™¨æ¯æ¬¡ç»“æŸäº‹ä»¶å¾ªç¯å‰ï¼Œéƒ½ä¼šæ ¹æ® "),v("code",[e._v("appendfsync")]),e._v(" é€‰é¡¹æ¥åˆ¤æ–­ AOF ç¼“å†²åŒºå†…å®¹æ˜¯å¦éœ€è¦å†™å…¥å’ŒåŒæ­¥åˆ° AOF æ–‡ä»¶ä¸­ã€‚")])]),e._v(" "),v("p",[v("code",[e._v("appendfsync")]),e._v(" ä¸åŒé€‰é¡¹å†³å®šäº†ä¸åŒçš„æŒä¹…åŒ–è¡Œä¸ºï¼š")]),e._v(" "),v("ul",[v("li",[v("strong",[v("code",[e._v("always")])]),e._v(" - å°†ç¼“å†²åŒºæ‰€æœ‰å†…å®¹å†™å…¥å¹¶åŒæ­¥åˆ° AOF æ–‡ä»¶ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("everysec")])]),e._v(" - å°†ç¼“å†²åŒºæ‰€æœ‰å†…å®¹å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå¦‚æœä¸Šæ¬¡åŒæ­¥ AOF æ–‡ä»¶çš„æ—¶é—´è·ç¦»ç°åœ¨è¶…è¿‡ä¸€ç§’é’Ÿï¼Œé‚£ä¹ˆå†æ¬¡å¯¹ AOF æ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªåŒæ­¥æ“ä½œæ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£æ‰§è¡Œçš„ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("no")])]),e._v(" - å°†ç¼“å†²åŒºæ‰€æœ‰å†…å®¹å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œä½†å¹¶ä¸å¯¹ AOF æ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œä½•æ—¶åŒæ­¥ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚")])]),e._v(" "),v("h3",{attrs:{id:"aof-çš„è½½å…¥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„è½½å…¥"}},[e._v("#")]),e._v(" AOF çš„è½½å…¥")]),e._v(" "),v("p",[e._v("å› ä¸º AOF æ–‡ä»¶ä¸­åŒ…å«äº†é‡å»ºæ•°æ®åº“æ‰€éœ€çš„æ‰€æœ‰å†™å‘½ä»¤ï¼Œæ‰€ä»¥æœåŠ¡å™¨åªè¦è½½å…¥å¹¶æ‰§è¡Œä¸€é AOF æ–‡ä»¶ä¸­ä¿å­˜çš„å†™å‘½ä»¤ï¼Œå°±å¯ä»¥è¿˜åŸæœåŠ¡å™¨å…³é—­å‰çš„æ•°æ®åº“çŠ¶æ€ã€‚")]),e._v(" "),v("p",[e._v("AOF è½½å…¥è¿‡ç¨‹å¦‚ä¸‹ï¼š")]),e._v(" "),v("ol",[v("li",[e._v("æœåŠ¡å™¨å¯åŠ¨è½½å…¥ç¨‹åºã€‚")]),e._v(" "),v("li",[e._v("åˆ›å»ºä¸€ä¸ªä¼ªå®¢æˆ·ç«¯ã€‚å› ä¸º Redis å‘½ä»¤åªèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªä¼ªå®¢æˆ·ç«¯æ¥è½½å…¥ã€æ‰§è¡Œ AOF æ–‡ä»¶ä¸­è®°å½•çš„å‘½ä»¤ã€‚")]),e._v(" "),v("li",[e._v("ä» AOF æ–‡ä»¶ä¸­åˆ†æå¹¶è¯»å–ä¸€æ¡å†™å‘½ä»¤ã€‚")]),e._v(" "),v("li",[e._v("ä½¿ç”¨ä¼ªå®¢æˆ·ç«¯æ‰§è¡Œå†™å‘½ä»¤ã€‚")]),e._v(" "),v("li",[e._v("å¾ªç¯æ‰§è¡Œæ­¥éª¤ 3ã€4ï¼Œç›´åˆ°æ‰€æœ‰å†™å‘½ä»¤éƒ½è¢«å¤„ç†å®Œæ¯•ä¸ºæ­¢ã€‚")]),e._v(" "),v("li",[e._v("è½½å…¥å®Œæ¯•ã€‚")])]),e._v(" "),v("div",{attrs:{align:"center"}},[v("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/database/redis/redis-aof-flow.png"}})]),e._v(" "),v("h3",{attrs:{id:"aof-çš„é‡å†™"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„é‡å†™"}},[e._v("#")]),e._v(" AOF çš„é‡å†™")]),e._v(" "),v("p",[e._v("éšç€ Redis ä¸æ–­è¿è¡Œï¼ŒAOF çš„ä½“ç§¯ä¹Ÿä¼šä¸æ–­å¢é•¿ï¼Œè¿™å°†å¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š")]),e._v(" "),v("ul",[v("li",[e._v("AOF è€—å°½ç£ç›˜å¯ç”¨ç©ºé—´ã€‚")]),e._v(" "),v("li",[e._v("Redis é‡å¯åéœ€è¦æ‰§è¡Œ AOF æ–‡ä»¶è®°å½•çš„æ‰€æœ‰å†™å‘½ä»¤æ¥è¿˜åŸæ•°æ®é›†ï¼Œå¦‚æœ AOF è¿‡å¤§ï¼Œåˆ™è¿˜åŸæ“ä½œæ‰§è¡Œçš„æ—¶é—´å°±ä¼šéå¸¸é•¿ã€‚")])]),e._v(" "),v("p",[e._v("ä¸ºäº†è§£å†³ AOF ä½“ç§¯è†¨èƒ€é—®é¢˜ï¼ŒRedis æä¾›äº† AOF é‡å†™åŠŸèƒ½ï¼Œæ¥å¯¹ AOF æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚"),v("strong",[e._v("AOF é‡å†™å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ï¼Œè¿™ä¸ªæ–°çš„ AOF æ–‡ä»¶å’ŒåŸæ¥çš„ AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼Œä½†ä½“ç§¯æ›´å°")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("AOF é‡å†™å¹¶éè¯»å–å’Œåˆ†æç°æœ‰ AOF æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œæ˜¯ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–å½“å‰çš„æ•°æ®åº“çŠ¶æ€ã€‚å³"),v("strong",[e._v("ä¾æ¬¡è¯»å–æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ï¼Œç„¶åç”¨ä¸€æ¡å‘½ä»¤å»è®°å½•è¯¥é”®å€¼å¯¹")]),e._v("ï¼Œä»¥æ­¤ä»£æ›¿ä¹‹å‰å¯èƒ½å­˜åœ¨å†—ä½™çš„å‘½ä»¤ã€‚")]),e._v(" "),v("h4",{attrs:{id:"aof-åå°é‡å†™"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-åå°é‡å†™"}},[e._v("#")]),e._v(" AOF åå°é‡å†™")]),e._v(" "),v("p",[e._v("ä½œä¸ºä¸€ç§è¾…åŠ©æ€§åŠŸèƒ½ï¼Œæ˜¾ç„¶ Redis å¹¶ä¸æƒ³åœ¨ AOF é‡å†™æ—¶é˜»å¡ Redis æœåŠ¡æ¥æ”¶å…¶ä»–å‘½ä»¤ã€‚å› æ­¤ï¼ŒRedis å†³å®šé€šè¿‡ "),v("code",[e._v("BGREWRITEAOF")]),e._v(" å‘½ä»¤åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åç”±å­è¿›ç¨‹è´Ÿè´£å¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè¿™ä¸ "),v("code",[e._v("BGSAVE")]),e._v(" åŸç†ç±»ä¼¼ã€‚")]),e._v(" "),v("ul",[v("li",[e._v("åœ¨æ‰§è¡Œ "),v("code",[e._v("BGREWRITEAOF")]),e._v(" å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºã€‚å½“ AOF é‡å†™å­è¿›ç¨‹å¼€å§‹å·¥ä½œåï¼ŒRedis æ¯æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ï¼Œä¼šåŒæ—¶å°†è¿™ä¸ªå‘½ä»¤å‘é€ç»™ AOF ç¼“å†²åŒºå’Œ AOF é‡å†™ç¼“å†²åŒºã€‚")]),e._v(" "),v("li",[e._v("ç”±äºå½¼æ­¤ä¸æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­å·¥ä½œï¼ŒAOF é‡å†™ä¸å½±å“ AOF å†™å…¥å’ŒåŒæ­¥ã€‚å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–° AOF æ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚")]),e._v(" "),v("li",[e._v("æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢å°±çš„ AOF æ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®Œæˆ AOF é‡å†™æ“ä½œã€‚")])]),e._v(" "),v("p",[v("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/snap/20200130153716.png",alt:"img"}})]),e._v(" "),v("p",[e._v("å¯ä»¥é€šè¿‡è®¾ç½® "),v("code",[e._v("auto-aof-rewrite-percentage")]),e._v(" å’Œ "),v("code",[e._v("auto-aof-rewrite-min-size")]),e._v("ï¼Œä½¿å¾— Redis åœ¨æ»¡è¶³æ¡ä»¶æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ "),v("code",[e._v("BGREWRITEAOF")]),e._v("ã€‚")]),e._v(" "),v("p",[e._v("å‡è®¾é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("auto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br"),v("span",{staticClass:"line-number"},[e._v("2")]),v("br")])]),v("p",[e._v("è¡¨æ˜ï¼Œå½“ AOF å¤§äº "),v("code",[e._v("64MB")]),e._v("ï¼Œä¸” AOF ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™åçš„ä½“ç§¯å¤§äº†è‡³å°‘ "),v("code",[e._v("100%")]),e._v(" æ—¶ï¼Œæ‰§è¡Œ "),v("code",[e._v("BGREWRITEAOF")]),e._v("ã€‚")]),e._v(" "),v("h3",{attrs:{id:"aof-çš„é…ç½®"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-çš„é…ç½®"}},[e._v("#")]),e._v(" AOF çš„é…ç½®")]),e._v(" "),v("p",[e._v("AOF çš„é»˜è®¤é…ç½®ï¼š")]),e._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("appendonly no\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br"),v("span",{staticClass:"line-number"},[e._v("2")]),v("br"),v("span",{staticClass:"line-number"},[e._v("3")]),v("br"),v("span",{staticClass:"line-number"},[e._v("4")]),v("br"),v("span",{staticClass:"line-number"},[e._v("5")]),v("br")])]),v("p",[e._v("AOF æŒä¹…åŒ–é€šè¿‡åœ¨ "),v("code",[e._v("redis.conf")]),e._v(" ä¸­çš„ "),v("code",[e._v("appendonly yes")]),e._v(" é…ç½®é€‰é¡¹æ¥å¼€å¯ã€‚")]),e._v(" "),v("ul",[v("li",[v("strong",[v("code",[e._v("appendonly")])]),e._v(" - å¼€å¯ AOF åŠŸèƒ½ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("appendfilename")])]),e._v(" - AOF æ–‡ä»¶åã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("appendfsync")])]),e._v(" - ç”¨äºè®¾ç½®åŒæ­¥é¢‘ç‡ï¼Œå®ƒæœ‰ä»¥ä¸‹å¯é€‰é¡¹ï¼š\n"),v("ul",[v("li",[v("strong",[v("code",[e._v("always")])]),e._v(" - æ¯ä¸ª Redis å†™å‘½ä»¤éƒ½è¦åŒæ­¥å†™å…¥ç¡¬ç›˜ã€‚è¿™æ ·åšä¼šä¸¥é‡é™ä½ Redis çš„é€Ÿåº¦ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("everysec")])]),e._v(" - æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ã€‚ä¸ºäº†å…¼é¡¾æ•°æ®å®‰å…¨å’Œå†™å…¥æ€§èƒ½ï¼Œæ¨èä½¿ç”¨ "),v("code",[e._v("appendfsync everysec")]),e._v(" é€‰é¡¹ã€‚Redis æ¯ç§’åŒæ­¥ä¸€æ¬¡ AOF æ–‡ä»¶æ—¶çš„æ€§èƒ½å’Œä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–ç‰¹æ€§æ—¶çš„æ€§èƒ½ç›¸å·®æ— å‡ ã€‚")]),e._v(" "),v("li",[v("strong",[v("code",[e._v("no")])]),e._v(" - è®©æ“ä½œç³»ç»Ÿæ¥å†³å®šåº”è¯¥ä½•æ—¶è¿›è¡ŒåŒæ­¥ã€‚")])])]),e._v(" "),v("li",[v("code",[e._v("no-appendfsync-on-rewrite")]),e._v(" - AOF é‡å†™æ—¶ä¸æ”¯æŒè¿½åŠ å‘½ä»¤ã€‚")]),e._v(" "),v("li",[v("code",[e._v("auto-aof-rewrite-percentage")]),e._v(" - AOF é‡å†™ç™¾åˆ†æ¯”ã€‚")]),e._v(" "),v("li",[v("code",[e._v("auto-aof-rewrite-min-size")]),e._v(" - AOF é‡å†™æ–‡ä»¶çš„æœ€å°å¤§å°ã€‚")]),e._v(" "),v("li",[v("code",[e._v("dir")]),e._v(" - RDB æ–‡ä»¶å’Œ AOF æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚")])]),e._v(" "),v("h2",{attrs:{id:"ä¸‰ã€rdb-å’Œ-aof"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€rdb-å’Œ-aof"}},[e._v("#")]),e._v(" ä¸‰ã€RDB å’Œ AOF")]),e._v(" "),v("blockquote",[v("p",[e._v("å½“ Redis å¯åŠ¨æ—¶ï¼Œ å¦‚æœ RDB å’Œ AOF åŠŸèƒ½éƒ½å¼€å¯äº†ï¼Œé‚£ä¹ˆç¨‹åºä¼šä¼˜å…ˆä½¿ç”¨ AOF æ–‡ä»¶æ¥æ¢å¤æ•°æ®é›†ï¼Œå› ä¸º AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®é€šå¸¸æ˜¯æœ€å®Œæ•´çš„ã€‚")])]),e._v(" "),v("h3",{attrs:{id:"å¦‚ä½•é€‰æ‹©æŒä¹…åŒ–"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•é€‰æ‹©æŒä¹…åŒ–"}},[e._v("#")]),e._v(" å¦‚ä½•é€‰æ‹©æŒä¹…åŒ–")]),e._v(" "),v("ul",[v("li",[e._v("å¦‚æœä¸å…³å¿ƒæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥ä¸æŒä¹…åŒ–ã€‚")]),e._v(" "),v("li",[e._v("å¦‚æœå¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åªä½¿ç”¨ RDBã€‚")]),e._v(" "),v("li",[e._v("å¦‚æœä¸èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ RDB å’Œ AOFã€‚")])]),e._v(" "),v("p",[e._v("æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œ ä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼š å› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œå¹¶ä¸”å¿«ç…§æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯” AOF æ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨å¿«ç…§è¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„ AOF ç¨‹åºçš„ bug ã€‚")]),e._v(" "),v("h3",{attrs:{id:"rdb-åˆ‡æ¢ä¸º-aof"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#rdb-åˆ‡æ¢ä¸º-aof"}},[e._v("#")]),e._v(" RDB åˆ‡æ¢ä¸º AOF")]),e._v(" "),v("p",[e._v("åœ¨ Redis 2.2 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹ï¼Œä» RDB åˆ‡æ¢ä¸º AOF ï¼š")]),e._v(" "),v("ul",[v("li",[e._v("ä¸ºæœ€æ–°çš„ dump.rdb æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¤‡ä»½ã€‚")]),e._v(" "),v("li",[e._v("å°†å¤‡ä»½æ”¾åˆ°ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚")]),e._v(" "),v("li",[e._v("æ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤:")]),e._v(" "),v("li",[e._v("redis-cli config set appendonly yes")]),e._v(" "),v("li",[e._v("redis-cli config set save")]),e._v(" "),v("li",[e._v("ç¡®ä¿å†™å‘½ä»¤ä¼šè¢«æ­£ç¡®åœ°è¿½åŠ åˆ° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚")]),e._v(" "),v("li",[e._v("æ‰§è¡Œçš„ç¬¬ä¸€æ¡å‘½ä»¤å¼€å¯äº† AOF åŠŸèƒ½ï¼š Redis ä¼šé˜»å¡ç›´åˆ°åˆå§‹ AOF æ–‡ä»¶åˆ›å»ºå®Œæˆä¸ºæ­¢ï¼Œ ä¹‹å Redis ä¼šç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œ å¹¶å¼€å§‹å°†å†™å…¥å‘½ä»¤è¿½åŠ åˆ° AOF æ–‡ä»¶æœ«å°¾ã€‚")])]),e._v(" "),v("p",[e._v("æ‰§è¡Œçš„ç¬¬äºŒæ¡å‘½ä»¤ç”¨äºå…³é—­å¿«ç…§åŠŸèƒ½ã€‚ è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œ å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œ ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨å¿«ç…§å’Œ AOF è¿™ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚")]),e._v(" "),v("blockquote",[v("p",[e._v("ğŸ”” é‡è¦ï¼šåˆ«å¿˜äº†åœ¨ "),v("code",[e._v("redis.conf")]),e._v(" ä¸­æ‰“å¼€ AOF åŠŸèƒ½ï¼å¦åˆ™çš„è¯ï¼ŒæœåŠ¡å™¨é‡å¯ä¹‹åï¼Œä¹‹å‰é€šè¿‡ CONFIG SET è®¾ç½®çš„é…ç½®å°±ä¼šè¢«é—å¿˜ï¼Œç¨‹åºä¼šæŒ‰åŸæ¥çš„é…ç½®æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚")])]),e._v(" "),v("h3",{attrs:{id:"aof-å’Œ-rdb-çš„ç›¸äº’ä½œç”¨"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aof-å’Œ-rdb-çš„ç›¸äº’ä½œç”¨"}},[e._v("#")]),e._v(" AOF å’Œ RDB çš„ç›¸äº’ä½œç”¨")]),e._v(" "),v("p",[v("code",[e._v("BGSAVE")]),e._v(" å’Œ "),v("code",[e._v("BGREWRITEAOF")]),e._v(" å‘½ä»¤ä¸å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†é¿å…ä¸¤ä¸ª Redis åå°è¿›ç¨‹åŒæ—¶å¯¹ç£ç›˜è¿›è¡Œå¤§é‡çš„ I/O æ“ä½œã€‚")]),e._v(" "),v("p",[e._v("å¦‚æœ "),v("code",[e._v("BGSAVE")]),e._v(" æ­£åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”ç”¨æˆ·æ˜¾ç¤ºåœ°è°ƒç”¨ "),v("code",[e._v("BGREWRITEAOF")]),e._v(" å‘½ä»¤ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†å‘ç”¨æˆ·å›å¤ä¸€ä¸ª OK çŠ¶æ€ï¼Œå¹¶å‘ŠçŸ¥ç”¨æˆ·ï¼Œ"),v("code",[e._v("BGREWRITEAOF")]),e._v(" å·²ç»è¢«é¢„å®šæ‰§è¡Œã€‚ä¸€æ—¦ "),v("code",[e._v("BGSAVE")]),e._v(" æ‰§è¡Œå®Œæ¯•ï¼Œ "),v("code",[e._v("BGREWRITEAOF")]),e._v(" å°±ä¼šæ­£å¼å¼€å§‹ã€‚")]),e._v(" "),v("h2",{attrs:{id:"å››ã€redis-å¤‡ä»½"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€redis-å¤‡ä»½"}},[e._v("#")]),e._v(" å››ã€Redis å¤‡ä»½")]),e._v(" "),v("p",[e._v("åº”è¯¥ç¡®ä¿ Redis æ•°æ®æœ‰å®Œæ•´çš„å¤‡ä»½ã€‚")]),e._v(" "),v("p",[e._v("å¤‡ä»½ Redis æ•°æ®å»ºè®®é‡‡ç”¨ RDBã€‚")]),e._v(" "),v("h3",{attrs:{id:"å¤‡ä»½è¿‡ç¨‹"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å¤‡ä»½è¿‡ç¨‹"}},[e._v("#")]),e._v(" å¤‡ä»½è¿‡ç¨‹")]),e._v(" "),v("ol",[v("li",[e._v("åˆ›å»ºä¸€ä¸ªå®šæœŸä»»åŠ¡ï¼ˆcron jobï¼‰ï¼Œæ¯å°æ—¶å°†ä¸€ä¸ª RDB æ–‡ä»¶å¤‡ä»½åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ¯å¤©å°†ä¸€ä¸ª RDB æ–‡ä»¶å¤‡ä»½åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚")]),e._v(" "),v("li",[e._v("ç¡®ä¿å¿«ç…§çš„å¤‡ä»½éƒ½å¸¦æœ‰ç›¸åº”çš„æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ï¼Œæ¯æ¬¡æ‰§è¡Œå®šæœŸä»»åŠ¡è„šæœ¬æ—¶ï¼Œä½¿ç”¨ find å‘½ä»¤æ¥åˆ é™¤è¿‡æœŸçš„å¿«ç…§ï¼šæ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥ä¿ç•™æœ€è¿‘ 48 å°æ—¶å†…çš„æ¯å°æ—¶å¿«ç…§ï¼Œè¿˜å¯ä»¥ä¿ç•™æœ€è¿‘ä¸€ä¸¤ä¸ªæœˆçš„æ¯æ—¥å¿«ç…§ã€‚")]),e._v(" "),v("li",[e._v("è‡³å°‘æ¯å¤©ä¸€æ¬¡ï¼Œå°† RDB å¤‡ä»½åˆ°ä½ çš„æ•°æ®ä¸­å¿ƒä¹‹å¤–ï¼Œæˆ–è€…è‡³å°‘æ˜¯å¤‡ä»½åˆ°ä½ è¿è¡Œ Redis æœåŠ¡å™¨çš„ç‰©ç†æœºå™¨ä¹‹å¤–ã€‚")])]),e._v(" "),v("h3",{attrs:{id:"å®¹ç¾å¤‡ä»½"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å®¹ç¾å¤‡ä»½"}},[e._v("#")]),e._v(" å®¹ç¾å¤‡ä»½")]),e._v(" "),v("p",[e._v("Redis çš„å®¹ç¾å¤‡ä»½åŸºæœ¬ä¸Šå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œå¹¶å°†è¿™äº›å¤‡ä»½ä¼ é€åˆ°å¤šä¸ªä¸åŒçš„å¤–éƒ¨æ•°æ®ä¸­å¿ƒã€‚")]),e._v(" "),v("p",[e._v("å®¹ç¾å¤‡ä»½å¯ä»¥åœ¨ Redis è¿è¡Œå¹¶äº§ç”Ÿå¿«ç…§çš„ä¸»æ•°æ®ä¸­å¿ƒå‘ç”Ÿä¸¥é‡çš„é—®é¢˜æ—¶ï¼Œä»ç„¶è®©æ•°æ®å¤„äºå®‰å…¨çŠ¶æ€ã€‚")]),e._v(" "),v("h2",{attrs:{id:"äº”ã€è¦ç‚¹æ€»ç»“"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€è¦ç‚¹æ€»ç»“"}},[e._v("#")]),e._v(" äº”ã€è¦ç‚¹æ€»ç»“")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/snap/20200224214047.png",alt:"img"}})]),e._v(" "),v("h2",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[e._v("#")]),e._v(" å‚è€ƒèµ„æ–™")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("å®˜ç½‘")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis å®˜ç½‘"),v("OutboundLink")],1)]),e._v(" "),v("li",[v("a",{attrs:{href:"https://github.com/antirez/redis",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis github"),v("OutboundLink")],1)]),e._v(" "),v("li",[v("a",{attrs:{href:"http://redis.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ"),v("OutboundLink")],1)])])]),e._v(" "),v("li",[v("strong",[e._v("ä¹¦ç±")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://item.jd.com/11791607.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRedis å®æˆ˜ã€‹"),v("OutboundLink")],1)]),e._v(" "),v("li",[v("a",{attrs:{href:"https://item.jd.com/11486101.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹"),v("OutboundLink")],1)])])]),e._v(" "),v("li",[v("strong",[e._v("æ•™ç¨‹")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"http://redisdoc.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis å‘½ä»¤å‚è€ƒ"),v("OutboundLink")],1)])])])])])}),[],!1,null,null,null);v.default=a.exports}}]);