(window.webpackJsonp=window.webpackJsonp||[]).push([[370],{684:function(s,a,e){"use strict";e.r(a);var t=e(7),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Dockerfile")])]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile 是 Docker 中用于定义镜像自动化构建流程的配置文件")]),s._v(" "),a("li",[s._v("在 Dockerfile 中，包含了构建镜像过程中需要执行的命令和其他操作")]),s._v(" "),a("li",[s._v("它可以明确设定 Docker 镜像的制作过程，帮助我们在容器体系下能够完成自动构构建")])]),s._v(" "),a("h3",{attrs:{id:"使用-dockerfile-构建镜像的步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-dockerfile-构建镜像的步骤"}},[s._v("#")]),s._v(" 使用 Dockerfile 构建镜像的步骤")]),s._v(" "),a("ul",[a("li",[s._v("编写一个 dockerfile 文件")]),s._v(" "),a("li",[s._v("docker build 构建成为一个镜像")]),s._v(" "),a("li",[s._v("docker run 运行镜像")]),s._v(" "),a("li",[s._v("docker push 发布镜像（DockerHub 、阿里云仓库)")])]),s._v(" "),a("h3",{attrs:{id:"为什么要用-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用-dockerfile"}},[s._v("#")]),s._v(" 为什么要用 Dockerfile")]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile 是面向开发的，以后要发布项目，做镜像，就需要编写 dockerfile 文件")]),s._v(" "),a("li",[s._v("Docker 镜像逐渐成企业交付的标准，必须要掌握！")]),s._v(" "),a("li",[s._v("DockerFile 构建镜像文件，定义了一切的步骤，源代码")]),s._v(" "),a("li",[s._v("Dockerfile 的体积小，容易进行快速迁移部署")]),s._v(" "),a("li",[s._v("环境构建流程记录在 Dockerfile 中，能够直观的看到镜像构建的顺序和逻辑")]),s._v(" "),a("li",[s._v("Docker Images 通过 DockerFile 构建生成的镜像，最终发布和运行产品")]),s._v(" "),a("li",[s._v("Docker 容器，镜像运行起来提供服务")])]),s._v(" "),a("h3",{attrs:{id:"dockerfile-构建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建过程"}},[s._v("#")]),s._v(" Dockerfile 构建过程")]),s._v(" "),a("ul",[a("li",[s._v("每个保留关键字(指令）都是必须是大写字母")]),s._v(" "),a("li",[s._v("执行从上到下顺序")]),s._v(" "),a("li",[s._v("#表示注释")]),s._v(" "),a("li",[s._v("每一个指令都会创建提交一个新的镜像层，并提交")])]),s._v(" "),a("h3",{attrs:{id:"简单的-dockerfile-栗子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单的-dockerfile-栗子"}},[s._v("#")]),s._v(" 简单的 Dockerfile 栗子")]),s._v(" "),a("h4",{attrs:{id:"编写-dockerfile-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写-dockerfile-文件"}},[s._v("#")]),s._v(" 编写 dockerfile 文件")]),s._v(" "),a("p",[s._v("在任意目录创建一个 dockerfile 文件，输入以下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\nFROM ubuntu\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\nMAINTAINER my_name polotest@domain.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 换成国内的软件源")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list \nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 安装nginx")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露对外端口")]),s._v("\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h4",{attrs:{id:"执行-docker-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行-docker-build"}},[s._v("#")]),s._v(" 执行 docker build")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" ubuntu-nginx:v1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"镜像的构建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像的构建过程"}},[s._v("#")]),s._v(" 镜像的构建过程")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user@centos8 nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" ubuntu-nginx:v1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将上下文求发送给Docker引擎")]),s._v("\nSending build context to Docker daemon   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".56kB\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载依赖的镜像")]),s._v("\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM ubuntu\nlatest: Pulling from library/ubuntu\nd51af753c3d3: Pull complete\nfc878cd0a91c: Pull complete\n6154df8ff988: Pull complete\nfee5db0ff82f: Pull complete\nDigest: sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ubuntu:latest\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 1d622ef86b13")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 1d622ef86b13\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER my_name myemail@domain.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器 4eec6e3094f0，在容器内运行上面的这个命令，标记维护者信息")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 4eec6e3094f0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 4eec6e3094f0")]),s._v("\nRemoving intermediate container 4eec6e3094f0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 6679d1c204e3")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6679d1c204e3\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器84d38c20d8c4，在容器内运行上面的这个命令，更换软件源记录")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 84d38c20d8c4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 84d38c20d8c4")]),s._v("\nRemoving intermediate container 84d38c20d8c4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 83f29f7b055a")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 83f29f7b055a\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器 763e4493d93f， 在容器内运行上面的这个命令，更换软件源记录")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 763e4493d93f\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 763e4493d93f")]),s._v("\nRemoving intermediate container 763e4493d93f\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 6297f20605d9")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6297f20605d9\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器 2665a7e5a2e9，在容器内运行上面的这个命令， 更新软件源缓存")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 2665a7e5a2e9\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 2665a7e5a2e9")]),s._v("\nRemoving intermediate container 2665a7e5a2e9\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 fdfed940ca4d")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" fdfed940ca4d\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行 容器 722a9a544643，在容器内运行上面的这个命令， 安装nginx")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 722a9a544643\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 722a9a544643")]),s._v("\nRemoving intermediate container 722a9a544643\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成镜像 6ee76f7df9e5")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6ee76f7df9e5\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/7 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" EXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器 a12ed3216ee0，在容器内运行上面的这个命令， 暴露80端口")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a12ed3216ee0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除临时容器 a12ed3216ee0")]),s._v("\nRemoving intermediate container a12ed3216ee0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成最终的镜像 7cf64279ba98")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 7cf64279ba98\nSuccessfully built 7cf64279ba98\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将这个镜像标记命名 ubuntu-nginx 版本号v1")]),s._v("\nSuccessfully tagged ubuntu-nginx:v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("nbsp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br")])]),a("p",[s._v("Dockerfile 就是将在文件中书写的构建指令，一层一层从 FROM 指定的基础镜像使用临时容器过渡，逐层叠加起来最终生成目标镜像")]),s._v(" "),a("h4",{attrs:{id:"使用-docker-history-查看镜像历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-history-查看镜像历史"}},[s._v("#")]),s._v(" 使用 docker history 查看镜像历史")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user@centos8 nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" ubuntu-nginx:v1\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n7cf64279ba98        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  EXPOSE 80                    0B")]),s._v("\n6ee76f7df9e5        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(".2MB\nfdfed940ca4d        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(".4MB\n6297f20605d9        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mir…   2.76kB\n83f29f7b055a        21 minutes ago      /bin/sh -c sed -i '")]),s._v("s/archive.ubuntu.com/mirr…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".76kB\n6679d1c204e3        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago      /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  MAINTAINER my_name myemai…   0B")]),s._v("\n1d622ef86b13        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  CMD ["/bin/bash"]            0B')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /run/systemd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("amp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'do…   7B\n<missing>           2 weeks ago         /bin/sh -c set -xe   &amp;&amp; echo '")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh' > /…   811B")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-z")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" indextargets"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".01MB\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) ADD file:a58c8b447951f9e30…   72.8MB")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p"),s._v(" "),a("h2",{attrs:{id:"dockerfile-的结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-的结构"}},[s._v("#")]),s._v(" Dockerfile 的结构")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nDockerfile 主要包含四部分内容：\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("基础镜像信息")]),s._v(" "),a("li",[s._v("维护者信息")]),s._v(" "),a("li",[s._v("镜像操作指令")]),s._v(" "),a("li",[s._v("容器启动时指令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n可以将 Dockerfile 理解为一个由上往下执行指令的脚本文件\n当调用构建命令，通过 Dockerfile 构建镜像时，Docker 会按照指令顺序进行对应的操作\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"简单的-dockerfile-栗子二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单的-dockerfile-栗子二"}},[s._v("#")]),s._v(" 简单的 Dockerfile 栗子二")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("FROM centos:latest\nMAINTAINER polo\n\nENV MYPATH /usr/local\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")]),s._v("\n\nRUN yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\nRUN yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools\n\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----end----"')]),s._v("\nCMD /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h4",{attrs:{id:"执行-docker-build-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行-docker-build-2"}},[s._v("#")]),s._v(" 执行 docker build")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" test.dockerfile  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);