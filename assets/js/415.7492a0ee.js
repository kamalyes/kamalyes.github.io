(window.webpackJsonp=window.webpackJsonp||[]).push([[415],{731:function(s,a,n){"use strict";n.r(a);var t=n(7),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_4-1-general"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-general"}},[s._v("#")]),s._v(" 4.1 General")]),s._v(" "),a("p",[s._v("会自动填入上面配置的Gitee链接\n"),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/general.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_4-2-源码管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-源码管理"}},[s._v("#")]),s._v(" 4.2 源码管理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/git-config.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/ssh-config.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/git-ssh.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_4-3构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3构建"}},[s._v("#")]),s._v(" 4.3构建")]),s._v(" "),a("p",[s._v("注意这里"),a("strong",[s._v("GradleVersion要跟安卓项目中使用的Gradle版本一致")]),s._v("，否则编译可能会出错。")]),s._v(" "),a("p",[s._v("构建命令一般是先clean，然后assembleRelease-打Release版本的包，或者assembleDebug-打Debug版本的包。")]),s._v(" "),a("p",[s._v("构建 - Invoke Gradle script")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/invoke-gradle-script-select.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/invoke-gradle-script.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_4-4-build-now"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-build-now"}},[s._v("#")]),s._v(" 4.4 Build Now")]),s._v(" "),a("p",[s._v("点击 Build Now ，可以看到此时开始构建了")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/build-home.png",alt:""}})]),s._v(" "),a("p",[s._v("不出意外项目构建成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/build-successd.png",alt:""}})]),s._v(" "),a("p",[s._v("点击进去，选择控制台输出可查看构建日志")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/build-console-main.png",alt:""}})]),s._v(" "),a("p",[s._v("构建成功提示信息，若构建失败具体请查看日志")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/build-console-detail.png",alt:""}})]),s._v(" "),a("p",[s._v("这时已经生成release包了，默认路径在:")]),s._v(" "),a("p",[a("code",[s._v("Jenkins\\workspace\\Test\\app\\build\\outputs\\apk\\release")])]),s._v(" "),a("p",[s._v("但此时apk不能安装，因为： 如果你是使用android studio编译项目的化，在编译apk只会会自动给apk签名。 但默认配置下jenkins下编译出的apk是unsign的。需要一些额外的设置才能自动sign。")]),s._v(" "),a("h3",{attrs:{id:"_4-5-打包android应用时release自动签名设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-打包android应用时release自动签名设置"}},[s._v("#")]),s._v(" 4.5 打包android应用时Release自动签名设置")]),s._v(" "),a("p",[s._v("这个功能需要我们修改下build.gradle配置文件，让gradle在编译之后执行签名。 当然你也可以在这里做一些其它的修改，比如修改编译出的apk的名字，让他加个当前时间的时间戳，编译类型的后缀什么的，方便识别。")]),s._v(" "),a("p",[s._v("1.首先要有一个key，没有就自己建一个")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/generate-androidstudio-sign-main.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/generate-androidstudio-sign.png",alt:""}})]),s._v(" "),a("p",[s._v("2.将key复制到app目录下")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/copy-generate-androidstudio-sign.png",alt:""}})]),s._v(" "),a("p",[s._v("3.添加签名配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("signingConfigs {//签名的配置\n        release {\n            storeFile file(\"xxx.jks\")\n            storePassword '密码'\n            keyAlias '别名'\n            keyPassword '密码'\n        }\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/config-build-gradle.png",alt:""}})]),s._v(" "),a("p",[s._v("4.引用签名配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("buildTypes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        minifyEnabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        //必须添加以下这句话\n        signingConfig signingConfigs.release\n        proguardFiles getDefaultProguardFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'proguard-android.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'proguard-rules.pro'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("5.(可选)生成的apk名加上当前时间 + 修改apk的发布路径")]),s._v(" "),a("p",[s._v("在build.gradle配置文件下的android配置段下的buildTypes下找到你的编译配置项一般就是release 在release段下面加上如下代码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("applicationVariants.all "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" variant -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                variant.outputs.all "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" output -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    def outputFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" output.outputFile\n                    def fileName\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("outputFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" outputFile.name.endsWith"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.apk'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("variant.buildType.name.equals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'release'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("//如果是release包\n                            fileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appname_release_v'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${defaultConfig.versionName}")]),s._v('.apk"')]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("variant.buildType.name.equals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debug'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("//如果是debug包\n                            fileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appname_debug_v'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${defaultConfig.versionName}")]),s._v('.apk"')]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                        outputFileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fileName\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("然后在build.gradle配置文件的末尾加上一个方法用来获取当前时间")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("def "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("releaseTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  // "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" new Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyyMMdd"')]),s._v(", TimeZone.getTimeZone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" //年月日\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" new Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyyMMdd HH-mm-ss"')]),s._v(", TimeZone.getTimeZone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GMT+8:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" //年月日时分秒\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("plugins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'com.android.application'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'org.jetbrains.kotlin.android'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n​\nandroid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    compileSdk "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n​\n    defaultConfig "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        applicationId "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.seagull.test"')]),s._v("\n        minSdk "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n        targetSdk "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n        versionCode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        versionName "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),s._v("\n​\n        testInstrumentationRunner "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"androidx.test.runner.AndroidJUnitRunner"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n​\n    signingConfigs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("//签名的配置\n        release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            storeFile file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key.jks"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            storePassword "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n            keyAlias "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key0'")]),s._v("\n            keyPassword "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n​\n    buildTypes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            minifyEnabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            signingConfig signingConfigs.release\n            proguardFiles getDefaultProguardFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'proguard-android-optimize.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'proguard-rules.pro'")]),s._v("\n            applicationVariants.all "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" variant -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                variant.outputs.all "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" output -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    def outputFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" output.outputFile\n                    def fileName\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("outputFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" outputFile.name.endsWith"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.apk'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("variant.buildType.name.equals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'release'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("//如果是release包\n                            fileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test_release_v'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${defaultConfig.versionName}")]),s._v('.apk"')]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("variant.buildType.name.equals"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debug'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("//如果是debug包\n                            fileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test_debug_v'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${defaultConfig.versionName}")]),s._v('.apk"')]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                        outputFileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fileName\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    compileOptions "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    kotlinOptions "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jvmTarget "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.8'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n​\ndependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'androidx.core:core-ktx:1.7.0'")]),s._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'androidx.appcompat:appcompat:1.3.0'")]),s._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'com.google.android.material:material:1.4.0'")]),s._v("\n    implementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'androidx.constraintlayout:constraintlayout:2.0.4'")]),s._v("\n    testImplementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'junit:junit:4.13.2'")]),s._v("\n    androidTestImplementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'androidx.test.ext:junit:1.1.3'")]),s._v("\n    androidTestImplementation "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'androidx.test.espresso:espresso-core:3.4.0'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n​\ndef "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("releaseTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    // "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" new Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyyMMdd"')]),s._v(", TimeZone.getTimeZone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" //年月日\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" new Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyyMMdd HH-mm-ss"')]),s._v(", TimeZone.getTimeZone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GMT+8:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" //年月日时分秒\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br")])]),a("h3",{attrs:{id:"_4-6-构建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-构建触发器"}},[s._v("#")]),s._v(" 4.6 构建触发器")]),s._v(" "),a("p",[s._v("可根据实际情况创建，仅示例当gitee发生改变时自动构建：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/0d67cd8c2919994a08ccfca5f9be918c.png",alt:""}})]),s._v(" "),a("p",[s._v("生成密码并复制\n"),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/a32db59c18bbfe18e83998727ef0b3dd.png",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("Gitee中只能访问公有ip，无法访问本地的jenkins服务器，因此需要将内网转成外网域名")]),s._v("（推荐用内网穿透工具：ngrok）")]),s._v(" "),a("p",[s._v("进入"),a("a",{attrs:{href:"https://gitee.com/",title:"Gitee",target:"_blank",rel:"noopener noreferrer"}},[s._v("Gitee"),a("OutboundLink")],1),s._v("项目中,点击管理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/gitee-webhook.png",alt:""}})]),s._v(" "),a("p",[s._v("粘贴链接将内网穿透地址替换掉localhost")]),s._v(" "),a("p",[s._v("点击测试，请求结果为......has been accepted 说明配置成功")]),s._v(" "),a("h3",{attrs:{id:"_4-7-构建后操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-构建后操作"}},[s._v("#")]),s._v(" 4.7 构建后操作")]),s._v(" "),a("p",[s._v("点击增加构建后操作步骤，选择Archive the artifacts\n"),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/cc9e4492ea18f6e3ddd984fefe323f68.png",alt:""}})]),s._v(" "),a("p",[s._v("填入正则表达式路径，匹配用于存档的apk\n"),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/10209ae5c50081418a18ac4700198235.png",alt:""}})]),s._v(" "),a("p",[s._v("app/build/outputs/apk/release/*.apk的意思是匹配app/build/outputs/apk/release路径下所有拓展名为.apk的安装包 看这路径是不是很熟悉，其实就是项目路径下apk的输出路径")]),s._v(" "),a("p",[s._v("存档后xxx-release-v1.0.apk就会显示在Jenkins项目最后一次成功的构建结果")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/b14153ea337e0def77f07cb6387e861b.png",alt:""}})]),s._v(" "),a("h1",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("h3",{attrs:{id:"_1-connect-err"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-connect-err"}},[s._v("#")]),s._v(" 1. connect err")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/jenkins/connect-github-err.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". jenkins服务器上root用户生成密钥对\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen -t rsa （一直回车）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 在gogs配置公钥\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 在jenkins服务器上测试下是否能够正常获取代码 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);