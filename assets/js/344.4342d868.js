(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{662:function(a,t,s){"use strict";s.r(t);var r=s(7),e=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[t("strong",[a._v("如果你还想从头学起 Docker，可以看看这个系列的文章哦！")])]),a._v(" "),t("h2",{attrs:{id:"作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[a._v("#")]),a._v(" 作用")]),a._v(" "),t("p",[a._v("创建一个新的容器并运行一个命令")]),a._v(" "),t("h2",{attrs:{id:"语法格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#语法格式"}},[a._v("#")]),a._v(" 语法格式")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OPTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" IMAGE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("COMMAND"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("ARG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[t("strong",[a._v("备注")]),a._v(" 其实跟 docker create 一样的语法格式，只不过可以运行容器甚至进入容器内部")]),a._v(" "),t("li",[t("strong",[a._v("COMMAND ：")]),a._v(" 需要在容器内执行的命令")])]),a._v(" "),t("h4",{attrs:{id:"docker-run-执行流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-run-执行流程"}},[a._v("#")]),a._v(" docker run 执行流程")]),a._v(" "),t("ul",[t("li",[a._v("首先在指定镜像上创建一个可写的容器层")]),a._v(" "),t("li",[a._v("然后使用指定的命令（COMMAND）启动它")]),a._v(" "),t("li",[a._v("docker run 相当于执行了两个 API：/containers/create、/containers/(id)/start")])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("option")]),a._v(" "),t("th",[a._v("作用")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("-i")]),a._v(" "),t("td",[a._v("以交互模式运行容器，通常与 -t 同时使用")])]),a._v(" "),t("tr",[t("td",[a._v("-t")]),a._v(" "),t("td",[a._v("启动容器后，为容器分配一个命令行，通常与 -i 同时使用")])]),a._v(" "),t("tr",[t("td",[a._v("-v")]),a._v(" "),t("td",[a._v("目录映射，容器目录挂载到宿主机目录，格式：host目录:容器目录")])]),a._v(" "),t("tr",[t("td",[a._v("-d")]),a._v(" "),t("td",[a._v("守护进程，后台运行该容器")])]),a._v(" "),t("tr",[t("td",[a._v("-p")]),a._v(" "),t("td",[a._v("指定端口映射，"),t("strong",[a._v("格式")]),a._v("：主机(宿主)端口:容器端口")])]),a._v(" "),t("tr",[t("td",[a._v("-P")]),a._v(" "),t("td",[a._v("随机端口映射，容器内部端口"),t("strong",[a._v("随机")]),a._v("映射到主机的端口")])]),a._v(" "),t("tr",[t("td",[a._v("-u")]),a._v(" "),t("td",[a._v("以什么用户身份创建容器")])]),a._v(" "),t("tr",[t("td",[a._v("--name")]),a._v(" "),t("td",[a._v("容器名字")])]),a._v(" "),t("tr",[t("td",[a._v("-m, --memory bytes")]),a._v(" "),t("td",[a._v("设置容器使用内存最大值")])]),a._v(" "),t("tr",[t("td",[a._v("--dns")]),a._v(" "),t("td",[a._v("指定容器的 host name")])]),a._v(" "),t("tr",[t("td",[a._v("-e")]),a._v(" "),t("td",[a._v('设置环境变量 🌰：-e username="ritchie"')])]),a._v(" "),t("tr",[t("td",[a._v("-m, --memory bytes")]),a._v(" "),t("td",[a._v("设置容器使用内存最大值")])]),a._v(" "),t("tr",[t("td",[a._v("--restart")]),a._v(" "),t("td",[a._v("Docker 重启后，容器是否自动重启")])]),a._v(" "),t("tr",[t("td",[a._v("--privileged")]),a._v(" "),t("td",[a._v("容器内是否使用真正的 root 权限")])])])]),a._v(" "),t("p",[t("strong",[a._v("备注：")]),a._v(" 其实还有好多 options，但是目前还没用到，要用的时候再写吧")]),a._v(" "),t("h4",{attrs:{id:"p-的三种写法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#p-的三种写法"}},[a._v("#")]),a._v(" -p 的三种写法")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" ip:主机端口:容器端口\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 主机端口:容器端口 （常用） \n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 容器端口\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h2",{attrs:{id:"实际栗子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实际栗子"}},[a._v("#")]),a._v(" 实际栗子")]),a._v(" "),t("h3",{attrs:{id:"栗子一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子一"}},[a._v("#")]),a._v(" 栗子一")]),a._v(" "),t("p",[a._v("使用镜像 tomcat:7  ，容器命名为 tomcat7")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat7 tomcat:7\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("这样运行，会直接将容器运行日志打印出来，所以一般都需要加 -d，否则无法继续敲其他命令")]),a._v(" "),t("p",[a._v("docker ps 看看容器")]),a._v(" "),t("p",[a._v("其实打印的日志就是catalina.sh run 命令运行之后的日志")]),a._v(" "),t("h3",{attrs:{id:"栗子二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子二"}},[a._v("#")]),a._v(" 栗子二")]),a._v(" "),t("ul",[t("li",[a._v("使用镜像 tomcat:7 ")]),a._v(" "),t("li",[a._v("以后台模式启动一个容器")]),a._v(" "),t("li",[a._v("容器名字自定义为 tomcat7")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat7 tomcat:7\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"栗子三"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子三"}},[a._v("#")]),a._v(" 栗子三")]),a._v(" "),t("ul",[t("li",[a._v("使用镜像 tomcat:7 ")]),a._v(" "),t("li",[a._v("以后台模式启动一个容器")]),a._v(" "),t("li",[a._v("将容器的 8080 端口映射到主机的随机端口")]),a._v(" "),t("li",[a._v("容器名字自定义为 tomcat9999")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat9999 tomcat:7\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"栗子四"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子四"}},[a._v("#")]),a._v(" 栗子四")]),a._v(" "),t("ul",[t("li",[a._v("使用镜像 tomcat:7 ")]),a._v(" "),t("li",[a._v("以后台模式启动一个容器")]),a._v(" "),t("li",[a._v("将容器的 8080 端口映射到主机的 9999 端口")]),a._v(" "),t("li",[a._v("容器名字自定义为 tomcat7")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9999")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat7 tomcat:7\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("可以看到 PORTS 一列，主机的 9999 端口指向了容器的 8888 端口")]),a._v(" "),t("h3",{attrs:{id:"栗子五"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子五"}},[a._v("#")]),a._v(" 栗子五")]),a._v(" "),t("ul",[t("li",[a._v("使用镜像 tomcat:7 ")]),a._v(" "),t("li",[a._v("以后台模式启动一个容器")]),a._v(" "),t("li",[a._v("将容器的 8080 端口映射到主机的 9999 端口")]),a._v(" "),t("li",[a._v("容器名字自定义为 tomcat7")]),a._v(" "),t("li",[a._v("主机的目录&nbsp/usr/local/tomcat/webapps 映射到容器的&nbsp/usr/local/tomcat/webapps ")]),a._v(" "),t("li",[a._v("以后直接在主机的 webapps 目录上传 war 包，就能在浏览器访问对应的项目")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9999")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat7 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/tomcat/webapps:/usr/local/tomcat/webapps tomcat:7\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"栗子六"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子六"}},[a._v("#")]),a._v(" 栗子六")]),a._v(" "),t("ul",[t("li",[a._v("使用镜像 tomcat:7  ")]),a._v(" "),t("li",[a._v("以后台模式启动一个容器")]),a._v(" "),t("li",[a._v("将容器的 8080 端口映射到主机的 111.20.72.43:8888 端口")]),a._v(" "),t("li",[a._v("容器名字自定义为 tomcat77")]),a._v(" "),t("li",[a._v("主机的目录&nbsp/usr/local/tomcat/webapp 映射到容器&nbsp/usr/local/tomcat/webapps  ")]),a._v(" "),t("li",[a._v("启动容器后，在容器内执行 bash 命令")]),a._v(" "),t("li",[t("strong",[a._v("注意：")]),a._v(" 这里不加 -it 的话，容器是无法再启动的，加上才能启动容器并执行 bash 命令")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("111.20")]),a._v(".72.43:8888:8080 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /usr/local/webapps:/usr/local/webapps "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat77 tomcat:7 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"栗子七"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子七"}},[a._v("#")]),a._v(" 栗子七")]),a._v(" "),t("ul",[t("li",[a._v("容器 8080 端口映射到主机的 1111 端口")]),a._v(" "),t("li",[a._v(" -it 以交互模式启动一个容器，在容器内执行 bash 命令")]),a._v(" "),t("li",[t("strong",[a._v("注意：")]),a._v(" 如果这里加了 -d  参数，则不会进入容器的 CLI 界面；如果不加 bash 命令，则会执行 tomcat 容器本身自动会执行的命令（ catalina.sh run ），也会进不了 CLI 界面，因为会打印一堆运行日志")])]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1111")]),a._v(":8080 tomcat:7 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"栗子八"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子八"}},[a._v("#")]),a._v(" 栗子八")]),a._v(" "),t("p",[a._v("以 root 权限创建容器，当进入容器之后，拥有 root 权限去执行命令")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" jenkin2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true jenkins/jenkins\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("虽然是拥有了 root 权限，但并不一定是 root 用户身份，所以最好加 -uroot 指定 root 用户身份")]),a._v(" "),t("p",[a._v("即使加了 -uroot ，指定了 root 用户身份，但并不是真正拥有 root 权限")]),a._v(" "),t("h4",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("-uroot：")]),a._v(" 是给了 root 用户身份，但并没有真正的 root 权限")]),a._v(" "),t("li",[t("strong",[a._v("--privileged：")]),a._v(" 真正让当前用户有了 root 权限")]),a._v(" "),t("li",[a._v("若想要最高的权限，两者可以结合使用")])]),a._v(" "),t("h3",{attrs:{id:"栗子九"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栗子九"}},[a._v("#")]),a._v(" 栗子九")]),a._v(" "),t("p",[a._v("该容器在 Docker 重启后会自动启动无需手动启动")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" jenkins2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),a._v(" always jenkins/jenkins\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[a._v("创建了两个容器：jenkins2、jenkins3")]),a._v(" "),t("li",[a._v("重启 docker 服务")]),a._v(" "),t("li",[a._v("再次查看正在运行的容器，只有 jenkins2")])]),a._v(" "),t("h2",{attrs:{id:"退出容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#退出容器"}},[a._v("#")]),a._v(" 退出容器")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#容器直接退出")]),a._v("\nctrl +P +Q  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#容器不停止退出     ---注意：这个很有用的操作")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);