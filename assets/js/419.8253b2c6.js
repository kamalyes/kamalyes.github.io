(window.webpackJsonp=window.webpackJsonp||[]).push([[419],{733:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"https证书获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#https证书获取"}},[s._v("#")]),s._v(" HTTPS证书获取")]),s._v(" "),a("p",[s._v("首先打开ssl证书服务控制台"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/83aa504c2274445994a276dc13f91afc.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n然后点击SSL证书—>免费证书—>立即购买")]),s._v(" "),a("p",[s._v("注意此证书只支持单域名，最多可免费申请20个，而且一个账号只有一次免费机会，证书有效期为一年"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/5b60c4e354324cc3a7f4786751c0cfcb.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n购买完免费证书后，然后创建自己域名的证书即可"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/f750683f77fb495db6193a8b2d12d75e.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"将证书上传到harbor私有仓库服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将证书上传到harbor私有仓库服务器"}},[s._v("#")]),s._v(" 将证书上传到Harbor私有仓库服务器")]),s._v(" "),a("p",[s._v("下载(下载类型选择其它)我们申请的证书"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/3cd3ff441be04d54bb906775f462b408.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n上传到harbor所在服务器"),a("br"),s._v("\n我们将文件放在/data/certs路径下"),a("br"),s._v("\n解压证书文件压缩包")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo unzip 8291320_repo.xxx.xxx_other.zip\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/4e0bed064feb4d418761c7a3db38da62.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n将默认的证书文件名修改下"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/13f394f1174f40989c42543427887208.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"下载harbor在线-离线-安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载harbor在线-离线-安装包"}},[s._v("#")]),s._v(" 下载Harbor在线(离线)安装包")]),s._v(" "),a("p",[s._v("服务器没联网的话可以选择下载离线包")]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://github.com/goharbor/harbor/releases/download/v2.8.2/harbor-online-installer-v2.8.2.tgz",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线安装包下载地址"),a("OutboundLink")],1),a("br"),s._v(" "),a("a",{attrs:{href:"https://github.com/goharbor/harbor/releases/download/v2.8.2/harbor-offline-installer-v2.8.2.tgz",target:"_blank",rel:"noopener noreferrer"}},[s._v("离线安装包下载地址"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"解压安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压安装包"}},[s._v("#")]),s._v(" 解压安装包")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@harbor harbor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xvf harbor-offline-installer-v2.8.2.tgz -C /usr/local")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@harbor harbor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/harbor")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编写service文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@harbor harbor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /lib/systemd/system/harbor.service <<EOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Docker Harbor\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker.service systemd-networkd.service systemd-resolved.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Requires")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://github.com/vmware/harbor\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simple\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/docker-compose "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /usr/local/harbor/docker-compose.yml up\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/docker-compose "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /usr/local/harbor/docker-compose.yml down\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\nEOF\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改用systemclt来启动Harbor")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@harbor harbor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable --now harbor.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"修改harbor配置文件-harbor-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改harbor配置文件-harbor-yml"}},[s._v("#")]),s._v(" 修改Harbor配置文件(harbor.yml)")]),s._v(" "),a("p",[s._v("首先将官方准备的模板文件cp到harbor.yml，程序读的配置文件是(harbor.yml)")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor.yml.tmpl harbor.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改harbor.yml配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hostname: xxx.xxx.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Change to your domain name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nharbor_admin_password: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1235678")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http related config")]),s._v("\nhttp:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# port for http, default is 80. If https enabled, this port will redirect to https port")]),s._v("\n  port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https related config")]),s._v("\nhttps:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https port for harbor, default is 443")]),s._v("\n  port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The path of cert and key files for nginx")]),s._v("\n  certificate: /data/certs/server.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("我们上传的https证书路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  private_key: /data/certs/server.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("我们上传的https证书路径"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里使用iharbor.cn作为harbor服务器域名。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为是本地使用，这里我们自己在hosts文件里面加上。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为了后续访问方便，本地机器最后也在hosts文件里添加一下。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@harbor certs.d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.59 iharbor.cn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("主要修改这些配置，其它的用默认的就可以了，当然可以把默认的登录harbor密码以及数据库密码修改下"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/41e48134ca064b9f9ef66dbbf8a8f817.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"安装harbor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装harbor"}},[s._v("#")]),s._v(" 安装Harbor")]),s._v(" "),a("p",[s._v("运行安装脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./install.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("安装完成会出现successful提示语，证明安装成功，做完dns映射之后就可以直接在浏览器访问了。"),a("br"),s._v("\n也可通过docker-compose指令查看应用运行状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nNAME                STATUS              CONFIG FILES\nharbor              running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          /opt/harbor/docker-compose.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\nNAME                COMMAND                  SERVICE             STATUS              PORTS\nharbor-core         "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/entrypoint.…"')]),s._v("   core                running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nharbor-db           "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/docker-entrypoint.…"')]),s._v("   postgresql          running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nharbor-jobservice   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/harbor/entrypoint.…"')]),s._v("   jobservice          running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nharbor-log          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh -c /usr/loc…"')]),s._v("   log                 running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:1514-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10514")]),s._v("/tcp\nharbor-portal       "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   portal              running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnginx               "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   proxy               running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::80-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:443-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("/tcp, :::443-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("/tcp\nredis               "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-server /etc/r…"')]),s._v("   redis               running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nregistry            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/harbor/entryp…"')]),s._v("   registry            running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nregistryctl         "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/harbor/start.…"')]),s._v("   registryctl         running "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"访问harbor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问harbor"}},[s._v("#")]),s._v(" 访问Harbor")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/47d820df843a45dfb53ae56689dbc77b.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"推送镜像测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像测试"}},[s._v("#")]),s._v(" 推送镜像测试")]),s._v(" "),a("h1",{attrs:{id:"我们先用docker登陆下测试下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#我们先用docker登陆下测试下"}},[s._v("#")]),s._v(" 我们先用docker登陆下测试下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" root@k8s-master01 ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker login https://iharbor.cn")]),s._v("\nUsername: admin\nPassword:\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your password will be stored unencrypted "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#credentials-store")]),s._v("\n\nLogin Succeeded\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("1.登录私有仓库")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login https://iharbor.cn --username devops --password xxxx")]),s._v("\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Using "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" via the CLI is insecure. Use --password-stdin.\nWARNING"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your password will be stored unencrypted "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#credentials-store")]),s._v("\n\nLogin Succeeded\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("2.推送镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker push repo.xxxx.cn/k8s-test/myapp:v1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/da2b0d3925b342c5a34848686026e25c.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n3.在Harbor私有仓库查看刚刚推送的镜像"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/8be3d6232d1448f09b3bb5b77e8ad31a.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"kubernetes使用harbor仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes使用harbor仓库"}},[s._v("#")]),s._v(" kubernetes使用harbor仓库")]),s._v(" "),a("p",[s._v("在所有节点的docker daemon.json文件中加入私有仓库地址"),a("br"),s._v(" "),a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/6f3dce50416245b0947e37e5de877e67.png",alt:"在这里插入图片描述"}}),a("br"),s._v("\n所有节点重启docker")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# systemctl daemon-reload && systemctl restart docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("使用私有仓库的镜像启动k8s容器")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kubectl create deployment myapp-dep --image=iharbor.cn/k8s-test/myapp:v1 --port=80 --replicas=3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看创建的容器组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kubectl get deployments.apps")]),s._v("\nNAME        READY   UP-TO-DATE   AVAILABLE   AGE\nmyapp-dep   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("           62s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("给创建的容器组创建下svc然后访问测试下"),a("br"),s._v("\n先查看下我们刚刚使用命令行创建的pod的标签")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kubectl get pods --show-labels")]),s._v("\nNAME                         READY   STATUS    RESTARTS   AGE     LABELS\nmyapp-dep-7cbcb546cb-46vtn   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m50s   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myapp-dep,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7cbcb546cb\nmyapp-dep-7cbcb546cb-nl4lx   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m50s   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myapp-dep,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7cbcb546cb\nmyapp-dep-7cbcb546cb-xfjlk   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3m50s   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myapp-dep,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7cbcb546cb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat myappsvc.yaml")]),s._v("\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-svc\nspec:\n  type: ClusterIP\n  selector:\n    app: myapp-dep\n  ports:\n  - name: http\n    port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    targetPort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("访问测试")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kubectl get svc")]),s._v("\nNAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes             ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   8d\nkubernetes-dashboard   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".132.230   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    7d18h\nmyapp-svc              ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.110")]),s._v(".183.182   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    3s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.yuyanqing.cn/oss/image-bed/col/automate/52798ee578d9481f9ada9a9bc28fb06b.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://goharbor.io/docs/2.5.0/install-config/",target:"_blank",rel:"noopener noreferrer"}},[s._v("harbor官方安装手册"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);