---
title: 基于Docker快速搭建Gitlab
date: 2023-02-18 13:19:00
permalink: /pages/8898f1/
categories:
  - 测试
  - 自动化测试
tags:
  - 
author: 
  name: kamalyes
  link: https://github.com/kamalyes
---
# **准备**

一台内存不小于4G，硬盘大小不低于20g的服务器。
硬件要求：​[​https://docs.gitlab.com/ee/install/requirements.html​](https://docs.gitlab.com/ee/install/requirements.html)​


# 使用`docker-compose`文件部署


1. 创建`.env`文件
```
BASE_PATH = "/opt/gitlab"
```

2. 宿主机创建文件
```
sudo mkdir -p $GITLAB_HOME/gitlab/{config,data,logs}
sudo mkdir -p $GITLAB_HOME/gitlab-runner/{config,data,logs}
cd $GITLAB_HOME
```

3. 创建`docker-compose`文件 `vim docker-compose.yaml`
```docker
 version: '3'
 services:
   gitlab:
    image: 'gitlab/gitlab-ee:latest'
    container_name: "gitlab"
    restart: unless-stopped
    privileged: true
    hostname: 'dev.gitlab.com'
    environment:
      TZ: 'Asia/Shanghai'
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://dev.gitlab.com:9999'
        gitlab_rails['time_zone'] = 'Asia/Shanghai'
        gitlab_rails['smtp_enable'] = true
        gitlab_rails['smtp_address'] = "smtp.163.com"
        gitlab_rails['smtp_port'] = 465
        gitlab_rails['smtp_user_name'] = "mryu168@163.com"
        gitlab_rails['smtp_password'] = "授权码"
        gitlab_rails['smtp_domain'] = "163.com"
        gitlab_rails['smtp_authentication'] = "login"
        gitlab_rails['smtp_enable_starttls_auto'] = true
        gitlab_rails['smtp_tls'] = true
        gitlab_rails['gitlab_email_from'] = 'mryu168@163.com'
        gitlab_rails['gitlab_shell_ssh_port'] = 2022
    ports:
     - '9999:80'
     - '8443:443'
     - '2022:22'
    volumes:
     - $GITLAB_HOME/config:/etc/gitlab
     - $GITLAB_HOME/data:/var/opt/gitlab
     - $GITLAB_HOME/logs:/var/log/gitlab
   runner:
    image: 'gitlab/gitlab-runner:latest'
    container_name: 'gitlab-runner'
    restart: always
    links:
      - gitlab:dev.gitlab.com
    volumes:
      - '$GITLAB_HOME/gitlab-runner/config:/etc/gitlab-runner'
      - '/var/run/docker.sock:/var/run/docker.sock'
      - '/usr/bin/docker:/bin/docker'
```
