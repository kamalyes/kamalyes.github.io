---
title: API测试怎么做
date: 2023-02-17 11:21:55
permalink: /pages/4345b5/
categories:
  - 测试
  - 接口测试
tags:
  - 
author: 
  name: kamalyes
  link: https://github.com/kamalyes
---

文章中还介绍了测试工具，比如cURL、postman，单API如何测试；但这些都是偏基础的东西，且网上教程各式各样，就不再赘述了；这里主要讲的就是关于复杂场景的API测试要如何应对

API测试的流程
--------

- 先介绍下STAR 法则

```bash
STAR 法则是回答问题的基本法则他把回答问题分为四个步骤,这个法则可以回答问题条理清晰,思路明确,面面俱到,希望大家掌握这个法则,来应对面试中的所有问题.

S-situation（情景）事情在什么情况下发生
T-target （目标）要完成什么样的目标
A-action（行动）为了完成目标所做的行动
R-result（结果）所得到的结果
```

- 细说流程

```bash
S-后端开发与数据层开发完成以后，可以开始接口测试  
T-测试逻辑层与数据层，确认业务是否能够正常使用  
A-具体怎么做
    1.接口文档-开发提供
        接口文档：
        接口URL地址，请求参数，请求方式，返回结果  
        接口文档格式：HTML（SwaggerUI、ApiFix、MeterSphere等）或Word
    2.接口分析-不同公司要求不同
        1.只测试接口是否能够跑通,只需要考虑正常场景  
        2.接口场景需要全面覆盖
            正常场景： 
            申请借款模块：
                不同的申请方式，还款方式，期数······  
                条件组合，测试不同组合下结果是否正确 
                判定表的方法-每个条件组合，测试结果是否正确 
                参数格式的校验、等价类、边界值等等 
                参数定义的int类型，传输的得是int类型  
                参数定义的是string类型，传输数据，正常得是string，但是在开发框架里面，输入int类型，也会被强行转成string类型  
             异常场景 
                 少一个必填参数  
                 多一个参数  
    3.接口用例  
    4.执行
        选择工具执行：
        1.Jmeter（主流） 
            1.打开jmeter（1.找到bat文件运行 2.cmd输入jmeter）  
            2.新建线程组  
            3.新建HTTP请求  
                请求方式-get、post  
                请求参数-表单格式、json格式、xml格式  
            4.建立查看结果树  
        2.requests  
        3.postman（主流）  
        4.swagger  
        5.soupui
        6.在线测试工具  
    5.检查对应的结果  
        Jmeter-建立监听器，查看结果树  
        requests print出来，打印结果
        1.检查返回结果是否正确  
        2.检查逻辑结果，保存的数据是否正确  
 R-完成对逻辑层和数据层的检查测试
```

如何应对复杂场景的API测试？
===============

测试场景一：被测业务操作是由多个API调用协作完成
-------------------------

### 背景

一个单一的前端操作可能会触发后端一系列的API调用，此时API的测试用例就不再是简单的单个API调用，而是一系列API的调用

### 存在的情况

* 存在后一个API需要使用前一个API返回结果的情况
* 需要根据前一个API的返回结果决定后面应该调用哪个API

### 存在问题

高效地获取单个前端操作所触发的API调用顺序

### 解决上述问题思路

1. 通过网络监控手段，捕获单个前端操作时所触发的API调用顺序，譬如Fiddler、Charles等抓包工具
2. 也可以通过用户行为日志，通过大数据手段来获取调用顺序

测试场景二：API 测试过程中的第三方依赖
---------------------

### 背景

* API 之间是存在依赖关系的，比如你的被测对象是 API A，但是 API A 的内部调用了 API B，此时如果由于某种原因，API B 在被测环境中处于不可用状态，那么 API A 的测试就会受到影响。
* 在单体架构下，通常只会在涉及到第三方 API 集成的场景中才会遇到这个问题，所以还不算严重。但是，在微服务架构下，API 间相互耦合的依赖问题就会非常严重。

### 解决问题的核心思路

启用 Mock Server 来代替真实的 API

测试场景三：异步 API 的测试
----------------

### 什么是异步API

调用后会立即返回，但是实际任务并没有真正完成，而是需要稍后去查询或者回调（Callback）的 API

### 对异步 API 的测试主要分为两个部分

1. 测试异步调用是否成功：检查返回值和后台工作线程是否被创建两个方面就可以了
2. 测试异步调用的业务逻辑处理是否正确

### 测试异步调用的业务逻辑复杂性

因为异步 API 通常发生在一些比较慢的操作上，比如数据库 I/O、消息队列 I/O 等，此时测试往往需要去验证数据库中的值、消息队列中的值等，这就需要测试代码具有访问和操作数据库或者消息队列的能力。在实际工程项目中，这些能力一般会在测试框架级别提供，也就是说要求 API 测试框架中包含对应的工具类去访问和操作数据库或者消息队列等
